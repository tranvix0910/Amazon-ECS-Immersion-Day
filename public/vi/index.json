[
{
	"uri": "http://localhost:1313/vi/7-networking/7.1-network_mode/",
	"title": "Amazon ECS Network Mode",
	"tags": [],
	"description": "",
	"content": "Khi ch·∫°y containers, vi·ªác xem x√©t c·∫•u h√¨nh m·∫°ng c·ªßa c√°c container ƒëang ch·∫°y tr√™n host l√† r·∫•t quan tr·ªçng. H√£y tham kh·∫£o AWS Documentation ƒë·ªÉ bi·∫øt th√™m th√¥ng tin v·ªÅ c√°ch l·ª±a ch·ªçn network mode ph√π h·ª£p.\nTrong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω c√≥ c√°i nh√¨n t·ªïng quan v·ªÅ c·∫•u h√¨nh m·∫°ng AWSVPC Mode cho Amazon ECS tr√™n Fargate.\nTrong AWSVPC Mode, Amazon ECS s·∫Ω t·∫°o v√† qu·∫£n l√Ω m·ªôt Elastic Network Interface (ENI) cho m·ªói task, v√† m·ªói task s·∫Ω nh·∫≠n m·ªôt private IP address ri√™ng trong VPC. C·∫•u h√¨nh n√†y mang l·∫°i s·ª± linh ho·∫°t cao, cho ph√©p ki·ªÉm so√°t vi·ªác giao ti·∫øp gi·ªØa c√°c task v√† service ·ªü m·ª©c ƒë·ªô chi ti·∫øt (granular level).\nAWSVPC Network Mode ƒë∆∞·ª£c h·ªó tr·ª£ cho c√°c Amazon ECS task ch·∫°y tr√™n c·∫£ Amazon EC2 v√† Fargate. Tham kh·∫£o AWS Documentation ƒë·ªÉ bi·∫øt th√™m chi ti·∫øt.\nKhi s·ª≠ d·ª•ng Amazon ECS tr√™n Fargate, AWSVPC Network Mode l√† b·∫Øt bu·ªôc.\nReview Network Mode M·ªü Amazon ECS console ƒë·ªÉ ki·ªÉm tra c√°c service.\nT·∫°i ƒë√¢y, c√≥ th·ªÉ ch·ªçn task ƒëang ch·∫°y ƒë·∫ßu ti√™n. K√©o xu·ªëng ph·∫ßn Configuration ƒë·ªÉ xem l·∫°i c√°c th√¥ng tin sau:\nNetwork mode\nENI ID\nPrivate IP ƒë∆∞·ª£c g·∫Øn v·ªõi task\nC√≥ th·ªÉ l·∫•y th√¥ng tin c·ªßa Task b·∫±ng AWS CLI:\naws ecs describe-tasks \\ --cluster retail-store-ecs-cluster \\ --tasks $(aws ecs list-tasks --cluster retail-store-ecs-cluster --service ui --query \u0026#39;taskArns[0]\u0026#39; --output text) K·∫øt qu·∫£:\n{ \u0026#34;tasks\u0026#34;: [ { \u0026#34;attachments\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;464044b3-626f-44da-86ec-fa20a064d408\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;ElasticNetworkInterface\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;ATTACHED\u0026#34;, \u0026#34;details\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;subnetId\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;subnet-08c4050330714ed3d\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;networkInterfaceId\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;eni-0a6c55131166f85c8\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;macAddress\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;06:39:15:1c:ae:1f\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;privateDnsName\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;ip-10-0-4-128.us-west-2.compute.internal\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;privateIPv4Address\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;10.0.4.128\u0026#34; } ] } ], \u0026#34;attributes\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;ecs.cpu-architecture\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;x86_64\u0026#34; } ], \u0026#34;availabilityZone\u0026#34;: \u0026#34;us-west-2b\u0026#34;, \u0026#34;clusterArn\u0026#34;: \u0026#34;arn:aws:ecs:us-west-2:XXXXXXXXXX:cluster/retail-store-ecs-cluster\u0026#34;, \u0026#34;connectivity\u0026#34;: \u0026#34;CONNECTED\u0026#34;, \u0026#34;connectivityAt\u0026#34;: \u0026#34;2024-04-10T08:09:33.968000+00:00\u0026#34;, \u0026#34;containers\u0026#34;: [ { \u0026#34;containerArn\u0026#34;: \u0026#34;arn:aws:ecs:us-west-2:XXXXXXXXXX:container/retail-store-ecs-cluster/70137dd0c1d14cf982e5a6b7446c5f54/db0fa651-1727-4215-b5a5-8a5577120942\u0026#34;, \u0026#34;taskArn\u0026#34;: \u0026#34;arn:aws:ecs:us-west-2:XXXXXXXXXX:task/retail-store-ecs-cluster/70137dd0c1d14cf982e5a6b7446c5f54\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/aws-containers/retail-store-sample-ui:1.2.3\u0026#34;, \u0026#34;imageDigest\u0026#34;: \u0026#34;sha256:6316a3c331c39c35798f3b1303f80494526c0a879fe5a3db3b0b9a85c22aab36\u0026#34;, \u0026#34;runtimeId\u0026#34;: \u0026#34;70137dd0c1d14cf982e5a6b7446c5f54-524788293\u0026#34;, \u0026#34;lastStatus\u0026#34;: \u0026#34;RUNNING\u0026#34;, \u0026#34;networkBindings\u0026#34;: [], \u0026#34;networkInterfaces\u0026#34;: [ { \u0026#34;attachmentId\u0026#34;: \u0026#34;464044b3-626f-44da-86ec-fa20a064d408\u0026#34;, \u0026#34;privateIpv4Address\u0026#34;: \u0026#34;10.0.4.128\u0026#34; } ], \u0026#34;healthStatus\u0026#34;: \u0026#34;HEALTHY\u0026#34;, \u0026#34;cpu\u0026#34;: \u0026#34;0\u0026#34; } ], \u0026#34;cpu\u0026#34;: \u0026#34;1024\u0026#34;, \u0026#34;createdAt\u0026#34;: \u0026#34;2024-04-10T08:09:29.943000+00:00\u0026#34;, \u0026#34;desiredStatus\u0026#34;: \u0026#34;RUNNING\u0026#34;, \u0026#34;enableExecuteCommand\u0026#34;: false, \u0026#34;group\u0026#34;: \u0026#34;service:ui\u0026#34;, \u0026#34;healthStatus\u0026#34;: \u0026#34;HEALTHY\u0026#34;, \u0026#34;lastStatus\u0026#34;: \u0026#34;RUNNING\u0026#34;, \u0026#34;launchType\u0026#34;: \u0026#34;FARGATE\u0026#34;, \u0026#34;memory\u0026#34;: \u0026#34;2048\u0026#34;, \u0026#34;overrides\u0026#34;: { \u0026#34;containerOverrides\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34; } ], \u0026#34;inferenceAcceleratorOverrides\u0026#34;: [] }, \u0026#34;platformVersion\u0026#34;: \u0026#34;1.4.0\u0026#34;, \u0026#34;platformFamily\u0026#34;: \u0026#34;Linux\u0026#34;, \u0026#34;pullStartedAt\u0026#34;: \u0026#34;2024-04-10T08:09:44.535000+00:00\u0026#34;, \u0026#34;pullStoppedAt\u0026#34;: \u0026#34;2024-04-10T08:09:52.398000+00:00\u0026#34;, \u0026#34;startedAt\u0026#34;: \u0026#34;2024-04-10T08:10:44.148000+00:00\u0026#34;, \u0026#34;startedBy\u0026#34;: \u0026#34;ecs-svc/8962710467093341990\u0026#34;, \u0026#34;tags\u0026#34;: [], \u0026#34;taskArn\u0026#34;: \u0026#34;arn:aws:ecs:us-west-2:XXXXXXXXXX:task/retail-store-ecs-cluster/70137dd0c1d14cf982e5a6b7446c5f54\u0026#34;, \u0026#34;taskDefinitionArn\u0026#34;: \u0026#34;arn:aws:ecs:us-west-2:XXXXXXXXXX:task-definition/retail-store-ecs-ui:8\u0026#34;, \u0026#34;version\u0026#34;: 4, \u0026#34;ephemeralStorage\u0026#34;: { \u0026#34;sizeInGiB\u0026#34;: 20 } } ], \u0026#34;failures\u0026#34;: [] } "
},
{
	"uri": "http://localhost:1313/vi/5-managed-instances/5.1-enable/",
	"title": "Enable ECS Managed Instances",
	"tags": [],
	"description": "",
	"content": "Trong ph·∫ßn n√†y, b·∫°n s·∫Ω th·ª±c hi·ªán thi·∫øt l·∫≠p ƒë·ªÉ tri·ªÉn khai workload tr√™n Amazon ECS Managed Instances.\nC·ª• th·ªÉ, ch√∫ng ta s·∫Ω thi·∫øt l·∫≠p Amazon ECS capacity providers m·∫∑c ƒë·ªãnh cho ECS Managed Instances.\nAmazon ECS capacity providers ch·ªãu tr√°ch nhi·ªám qu·∫£n l√Ω vi·ªác scale h·∫° t·∫ßng cho c√°c task trong ECS cluster.\nAmazon ECS hi·ªán cung c·∫•p ba lo·∫°i capacity provider cho cluster:\nFargate capacity providers: ƒê√¢y l√† c√°c capacity provider ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a s·∫µn cho AWS Fargate. ƒê√¢y c≈©ng l√† capacity provider m√† ch√∫ng ta ƒë√£ s·ª≠ d·ª•ng t·ª´ ƒë·∫ßu workshop.\nManaged Instances capacity providers: Cho ph√©p s·ª≠ d·ª•ng Amazon ECS Managed Instances ƒë·ªÉ ch·∫°y workload.\nüëâ ƒê√¢y l√† capacity provider s·∫Ω ƒë∆∞·ª£c c·∫•u h√¨nh trong ph·∫ßn n√†y. Auto Scaling group capacity providers: Cho ph√©p s·ª≠ d·ª•ng Amazon EC2 instances ƒë·ªÉ ch·∫°y workload th√¥ng qua Auto Scaling Group.\nInstance Profile l√† m·ªôt ƒë·ªëi t∆∞·ª£ng IAM ƒë∆∞·ª£c g·∫Øn tr·ª±c ti·∫øp v√†o EC2 instance, ƒë√≥ng vai tr√≤ c·∫ßu n·ªëi gi·ªØa EC2 v√† IAM Role.\nTh√¥ng qua Instance Profile, EC2 (v√† c√°c process/daemon ch·∫°y tr√™n EC2 nh∆∞ ECS Agent) c√≥ th·ªÉ assume IAM Role t∆∞∆°ng ·ª©ng v√† s·ª≠ d·ª•ng c√°c quy·ªÅn AWS ƒë√£ ƒë∆∞·ª£c c·∫•p m√† kh√¥ng c·∫ßn c·∫•u h√¨nh access key/secret key.\nT·∫°o ECS Managed Instances Capacity Provider Tr∆∞·ªõc khi t·∫°o capacity provider, ch√∫ng ta c·∫ßn hai IAM role (tham kh·∫£o AWS Documentation ƒë·ªÉ bi·∫øt th√™m chi ti·∫øt):\nInfrastructure Role: Cho ph√©p Amazon ECS qu·∫£n l√Ω ECS Managed Instances thay m·∫∑t b·∫°n.\nInstance profile: Cung c·∫•p quy·ªÅn cho Amazon ECS container agent ch·∫°y tr√™n c√°c managed instances.\nCh√∫ng ta s·∫Ω t·∫°o hai IAM role n√†y b·∫±ng c√°ch s·ª≠ d·ª•ng AWS CLI. V·ªõi Infrastructure Role ch√∫ng ta s·∫Ω ti·∫øn h√†nh t·∫°o role v·ªõi t√™n l√† ecsManagedInstanceInfrastructureRole. ƒê·∫ßu ti√™n ch√∫ng ta c·∫ßn t·∫°o trust policy cho role n√†y v·ªõi n·ªôi dung file json b√™n d∆∞·ªõi:\nECS Agent l√† m·ªôt daemon (process ch·∫°y n·ªÅn) tr√™n EC2 instance. Agent n√†y s·ª≠ d·ª•ng Instance Profile g·∫Øn v·ªõi EC2 ƒë·ªÉ assume IAM Role t∆∞∆°ng ·ª©ng, t·ª´ ƒë√≥ c√≥ th·ªÉ th·ª±c thi c√°c quy·ªÅn AWS ƒë√£ ƒë∆∞·ª£c c·∫•p (v√≠ d·ª•: g·ªçi ECS API, pull image t·ª´ ECR, g·ª≠i log l√™n CloudWatch).\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;ecs.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34; } ] } Ti·∫øn h√†nh ch·∫°y l·ªánh sau ƒë·ªÉ t·∫°o Role:\naws iam create-role \\ --role-name ecsManagedInstanceInfrastructureRole \\ --assume-role-policy-document file://ecs-managed-instance-infrastructure-role-trust.json Ti·∫øp theo ch√∫ng ta c·∫ßn Attach policy AWS-managed v√†o role v·ª´a t·∫°o:\nPolicy 1 - Qu·∫£n l√Ω Managed Instances: aws iam attach-role-policy \\ --role-name ecsManagedInstanceInfrastructureRole \\ --policy-arn arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForManagedInstances Policy 2 - Qu·∫£n l√Ω Volume (EBS): aws iam attach-role-policy \\ --role-name ecsManagedInstanceInfrastructureRole \\ --policy-arn arn:aws:iam::aws:policy/service-role/AmazonECSInfrastructureRolePolicyForVolumes Ki·ªÉm tra l·∫°i Role ƒë√£ ƒë∆∞·ª£c g·∫Øn policy ch∆∞a b·∫±ng l·ªánh:\naws iam list-attached-role-policies \\ --role-name ecsManagedInstanceInfrastructureRole Nh∆∞ v·∫≠y l√† ƒë√£ t·∫°o role Infrastructure Role th√†nh c√¥ng.\nTi·∫øp theo ch√∫ng ta s·∫Ω t·∫°o Instance Role b·∫±ng c√°ch t·∫°o t∆∞∆°ng t·ª± nh∆∞ tr√™n v·ªõi file json l√† ecs-managed-instance-role-trust.json v·ªõi n·ªôi dung file json b√™n d∆∞·ªõi:\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;ec2.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34; } ] } Ch·∫°y l·ªánh sau ƒë·ªÉ t·∫°o Role:\naws iam create-role \\ --role-name ecsInstanceRoleManagedInstance \\ --assume-role-policy-document file://ecs-managed-instance-role-trust.json Ti·∫øn h√†nh g√°n Policy ECS Agent:\naws iam attach-role-policy \\ --role-name ecsInstanceRoleManagedInstance \\ --policy-arn arn:aws:iam::aws:policy/AmazonECSInstanceRolePolicyForManagedInstances Ki·ªÉm tra l·∫°i Role:\naws iam list-attached-role-policies \\ --role-name ecsInstanceRoleManagedInstance T·∫°o Instance Profile Ti·∫øn h√†nh t·∫°o Instance Profile v·ªõi Instance Role v·ª´a t·∫°o:\naws iam create-instance-profile --instance-profile-name ecsInstanceRoleManagedInstanceProfile Ti·∫øn h√†nh g√°n Role v√†o Instance Profile:\naws iam add-role-to-instance-profile \\ --instance-profile-name ecsInstanceRoleManagedInstanceProfile \\ --role-name ecsInstanceRoleManagedInstance Ki·ªÉm tra l·∫°i Instance Profile:\naws iam list-instance-profiles Nh∆∞ v·∫≠y l√† ƒë√£ t·∫°o Instance Profile th√†nh c√¥ng.\nCu·ªëi c√πng, h√£y t·∫°o ECS Managed Instances capacity provider. Xem AWS Documentation ƒë·ªÉ bi·∫øt th√™m th√¥ng tin.\nCapacity provider b√™n d∆∞·ªõi s·∫Ω cung c·∫•p c√°c instance ch·∫°y trong 2 private subnets, s·ª≠ d·ª•ng UI_SG_ID security group, v√† c√≥ disk size 100GB. Xem AWS Documentation ƒë·ªÉ bi·∫øt th√™m v√≠ d·ª• v·ªÅ c√°ch c·∫•u h√¨nh capacity provider cho Amazon ECS Managed Instances.\nCh√∫ng ta s·∫Ω t·∫°o capacity provider v·ªõi n·ªôi dung file json b√™n d∆∞·ªõi v·ªõi t√™n l√† retail-store-managed-instances-cp.json:\n{ \u0026#34;name\u0026#34;: \u0026#34;retail-store-managed-instances-cp\u0026#34;, \u0026#34;cluster\u0026#34;: \u0026#34;retail-store-ecs-cluster\u0026#34;, \u0026#34;managedInstancesProvider\u0026#34;: { \u0026#34;infrastructureRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/ecsManagedInstanceInfrastructureRole\u0026#34;, \u0026#34;instanceLaunchTemplate\u0026#34;: { \u0026#34;ec2InstanceProfileArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:instance-profile/ecsInstanceRoleManagedInstanceProfile\u0026#34;, \u0026#34;networkConfiguration\u0026#34;: { \u0026#34;subnets\u0026#34;: [ \u0026#34;$PRIVATE_SUBNET1\u0026#34;, \u0026#34;$PRIVATE_SUBNET2\u0026#34; ], \u0026#34;securityGroups\u0026#34;: [ \u0026#34;${UI_SG_ID}\u0026#34; ] }, \u0026#34;storageConfiguration\u0026#34;: { \u0026#34;storageSizeGiB\u0026#34;: 100 } } } } S·ª≠ d·ª•ng CLI sau ƒë·ªÉ t·∫°o capacity provider:\naws ecs create-capacity-provider --cli-input-json file://retail-store-managed-instances-cp.json Ki·ªÉm tra l·∫°i capacity provider tr√™n AWS Console:\nECS Capacity Provider Details ƒë∆∞·ª£c hi·ªÉn th·ªã nh∆∞ sau:\nECS Managed Instances capacity provider m·ªõi c·ªßa m√¨nh v·ªõi c√°c ƒë·∫∑c ƒëi·ªÉm ch√≠nh sau:\nType: Managed Instances.\nInfrastructure Role: ƒê∆∞·ª£c c·∫•u h√¨nh cho vi·ªác qu·∫£n l√Ω instance t·ª± ƒë·ªông.\nInstance Profile: Cho ph√©p c√°c instance tham gia ECS cluster.\nNetwork Configuration: S·ª≠ d·ª•ng c√°c private subnets hi·ªán c√≥ c·ªßa b·∫°n.\nStorage: 100 GiB EBS storage cho m·ªói instance.\nMonitoring: B·∫≠t CloudWatch monitoring c∆° b·∫£n.\nSau khi ƒë√£ t·∫°o ECS Managed Instances capacity provider, h√£y ti·∫øp t·ª•c b∆∞·ªõc ti·∫øp theo ƒë·ªÉ tri·ªÉn khai ·ª©ng d·ª•ng b·∫±ng t√πy ch·ªçn compute m·ªõi n√†y.\n"
},
{
	"uri": "http://localhost:1313/vi/7-networking/7.2-service-connect/7.2.1-enable_service_connect/",
	"title": "Enable Service Connect",
	"tags": [],
	"description": "",
	"content": "Trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω k√≠ch ho·∫°t ECS Service Connect trong cluster b·∫±ng c√°ch tri·ªÉn khai ba microservices b·ªï sung m√† UI service s·∫Ω giao ti·∫øp c√πng:\nT·∫°o Security Group Cho C√°c Service T·∫°o Security Group cho c√°c service nh∆∞ sau:\nVPC ID ƒë∆∞·ª£c l·∫•y t·ª´ VPC m√† ch√∫ng ta ƒë√£ t·∫°o trong ph·∫ßn tr∆∞·ªõc.\nOrders Service: orders-sg\naws ec2 create-security-group \\ --group-name orders-sg \\ --description \u0026#34;Orders ECS Service SG\u0026#34; \\ --vpc-id ${VPC_ID} Checkout Service: checkout-sg aws ec2 create-security-group \\ --group-name checkout-sg \\ --description \u0026#34;Checkout ECS Service SG\u0026#34; \\ --vpc-id ${VPC_ID} Catalog Service: catalog-sg aws ec2 create-security-group \\ --group-name catalog-sg \\ --description \u0026#34;Catalog ECS Service SG\u0026#34; \\ --vpc-id ${VPC_ID} L·∫•y c√°c ID tr√™n v√† c·∫•u h√¨nh Inbound rules cho c√°c Security Group nh∆∞ sau:\nOrders Service nh·∫≠n traffic t·ª´ UI Service v√† Checkout Service. aws ec2 authorize-security-group-ingress \\ --group-id ${ORDERS_SG_ID} \\ --protocol tcp \\ --port 8080 \\ --source-group ${UI_SG_ID} aws ec2 authorize-security-group-ingress \\ --group-id ${ORDERS_SG_ID} \\ --protocol tcp \\ --port 8080 \\ --source-group ${CHECKOUT_SG_ID} Checkout Service nh·∫≠n traffic t·ª´ UI Service. aws ec2 authorize-security-group-ingress \\ --group-id ${CHECKOUT_SG_ID} \\ --protocol tcp \\ --port 8080 \\ --source-group ${UI_SG_ID} Catalog Service nh·∫≠n traffic t·ª´ UI Service. aws ec2 authorize-security-group-ingress \\ --group-id ${CATALOG_SG_ID} \\ --protocol tcp \\ --port 8080 \\ --source-group ${UI_SG_ID} Deploy Orders Service T·∫°o ECS task definition cho Orders service. Ch√∫ng ta s·∫Ω l√†m t∆∞∆°ng t·ª± v·ªõi UI Service b·∫±ng c√°ch s·ª≠ d·ª•ng file json retail-store-ecs-order-taskdef.json v·ªõi n·ªôi dung nh∆∞ sau:\n{ \u0026#34;family\u0026#34;: \u0026#34;retail-store-ecs-orders\u0026#34;, \u0026#34;executionRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/ordersEcsTaskExecutionRole\u0026#34;, \u0026#34;taskRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskRole\u0026#34;, \u0026#34;networkMode\u0026#34;: \u0026#34;awsvpc\u0026#34;, \u0026#34;requiresCompatibilities\u0026#34;: [ \u0026#34;FARGATE\u0026#34; ], \u0026#34;cpu\u0026#34;: \u0026#34;1024\u0026#34;, \u0026#34;memory\u0026#34;: \u0026#34;2048\u0026#34;, \u0026#34;runtimePlatform\u0026#34;: { \u0026#34;cpuArchitecture\u0026#34;: \u0026#34;X86_64\u0026#34;, \u0026#34;operatingSystemFamily\u0026#34;: \u0026#34;LINUX\u0026#34; }, \u0026#34;containerDefinitions\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/aws-containers/retail-store-sample-orders:1.2.3\u0026#34;, \u0026#34;cpu\u0026#34;: 0, \u0026#34;portMappings\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;containerPort\u0026#34;: 8080, \u0026#34;hostPort\u0026#34;: 8080, \u0026#34;protocol\u0026#34;: \u0026#34;tcp\u0026#34;, \u0026#34;appProtocol\u0026#34;: \u0026#34;http\u0026#34; } ], \u0026#34;essential\u0026#34;: true, \u0026#34;linuxParameters\u0026#34;: { \u0026#34;initProcessEnabled\u0026#34;: true }, \u0026#34;healthCheck\u0026#34;: { \u0026#34;command\u0026#34;: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -f http://localhost:8080/actuator/health || exit 1\u0026#34; ], \u0026#34;interval\u0026#34;: 10, \u0026#34;timeout\u0026#34;: 5, \u0026#34;retries\u0026#34;: 3, \u0026#34;startPeriod\u0026#34;: 60 }, \u0026#34;environment\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_ORDERS_PERSISTENCE_PROVIDER\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;postgres\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_ORDERS_MESSAGING_PROVIDER\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;in-memory\u0026#34; } ], \u0026#34;secrets\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_ORDERS_PERSISTENCE_ENDPOINT\u0026#34;, \u0026#34;valueFrom\u0026#34;: \u0026#34;arn:aws:ssm:${AWS_REGION}:${ACCOUNT_ID}:parameter/retail-store-ecs/orders/db-endpoint-postgres\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_ORDERS_PERSISTENCE_NAME\u0026#34;, \u0026#34;valueFrom\u0026#34;: \u0026#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-orders-db:dbname::\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_ORDERS_PERSISTENCE_USERNAME\u0026#34;, \u0026#34;valueFrom\u0026#34;: \u0026#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-orders-db:username::\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_ORDERS_PERSISTENCE_PASSWORD\u0026#34;, \u0026#34;valueFrom\u0026#34;: \u0026#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-orders-db:password::\u0026#34; } ], \u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;awslogs\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;awslogs-group\u0026#34;: \u0026#34;retail-store-ecs-tasks\u0026#34;, \u0026#34;awslogs-region\u0026#34;: \u0026#34;$AWS_REGION\u0026#34;, \u0026#34;awslogs-stream-prefix\u0026#34;: \u0026#34;orders-service\u0026#34; } } } ] } ƒêƒÉng k√Ω task definition:\naws ecs register-task-definition \\ --cli-input-json file://retail-store-ecs-order-taskdef.json D√πng l·ªánh sau ƒë·ªÉ t·∫°o Orders service:\naws ecs create-service \\ --cluster retail-store-ecs-cluster \\ --service-name orders \\ --task-definition retail-store-ecs-orders \\ --desired-count 1 \\ --launch-type FARGATE \\ --enable-execute-command \\ --network-configuration \u0026#34;awsvpcConfiguration={subnets=[subnet-0b742ee8bbf495219, subnet-0317d1d968b9963d0], securityGroups=[sg-069f1465934b99e2a],assignPublicIp=DISABLED}\u0026#34; \\ --service-connect-configuration \u0026#39;{ \u0026#34;enabled\u0026#34;: true, \u0026#34;namespace\u0026#34;: \u0026#34;retailstore.local\u0026#34;, \u0026#34;services\u0026#34;: [ { \u0026#34;portName\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;discoveryName\u0026#34;: \u0026#34;orders\u0026#34;, \u0026#34;clientAliases\u0026#34;: [ { \u0026#34;port\u0026#34;: 80, \u0026#34;dnsName\u0026#34;: \u0026#34;orders\u0026#34; } ] } ] }\u0026#39; L∆∞u √Ω: khi t·∫°o service, ta ch·ªâ ƒë·ªãnh --service-connect-configuration, thao t√°c n√†y s·∫Ω:\nK√≠ch ho·∫°t Service Connect.\nCh·ªâ ƒë·ªãnh namespace d√πng chung cho t·∫•t c·∫£ services.\nC·∫•u h√¨nh Service Connect services ƒë∆∞·ª£c cung c·∫•p b·ªüi ECS service n√†y, bao g·ªìm alias v√† port.\nTham kh·∫£o th√™m trong AWS Documentation.\nDeploy Checkout Service T·∫°o ECS task definition cho Checkout service. T∆∞∆°ng t·ª± nh∆∞ tr√™n ch√∫ng ta s·∫Ω t·∫°o task definition v·ªõi file json retail-store-ecs-checkout-taskdef.json v·ªõi n·ªôi dung nh∆∞ sau:\n{ \u0026#34;family\u0026#34;: \u0026#34;retail-store-ecs-checkout\u0026#34;, \u0026#34;executionRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/checkoutEcsTaskExecutionRole\u0026#34;, \u0026#34;taskRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskRole\u0026#34;, \u0026#34;networkMode\u0026#34;: \u0026#34;awsvpc\u0026#34;, \u0026#34;requiresCompatibilities\u0026#34;: [ \u0026#34;FARGATE\u0026#34; ], \u0026#34;cpu\u0026#34;: \u0026#34;1024\u0026#34;, \u0026#34;memory\u0026#34;: \u0026#34;2048\u0026#34;, \u0026#34;runtimePlatform\u0026#34;: { \u0026#34;cpuArchitecture\u0026#34;: \u0026#34;X86_64\u0026#34;, \u0026#34;operatingSystemFamily\u0026#34;: \u0026#34;LINUX\u0026#34; }, \u0026#34;containerDefinitions\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/aws-containers/retail-store-sample-checkout:1.2.3\u0026#34;, \u0026#34;portMappings\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;containerPort\u0026#34;: 8080, \u0026#34;hostPort\u0026#34;: 8080, \u0026#34;protocol\u0026#34;: \u0026#34;tcp\u0026#34;, \u0026#34;appProtocol\u0026#34;: \u0026#34;http\u0026#34; } ], \u0026#34;essential\u0026#34;: true, \u0026#34;linuxParameters\u0026#34;: { \u0026#34;initProcessEnabled\u0026#34;: true }, \u0026#34;environment\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_CHECKOUT_PERSISTENCE_PROVIDER\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;redis\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_CHECKOUT_ENDPOINTS_ORDERS\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;http://orders\u0026#34; } ], \u0026#34;secrets\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_CHECKOUT_PERSISTENCE_REDIS_URL\u0026#34;, \u0026#34;valueFrom\u0026#34;: \u0026#34;arn:aws:ssm:${AWS_REGION}:${ACCOUNT_ID}:parameter/retail-store-ecs/checkout/redis-endpoint\u0026#34; } ], \u0026#34;healthCheck\u0026#34;: { \u0026#34;command\u0026#34;: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -f http://localhost:8080/health || exit 1\u0026#34; ], \u0026#34;interval\u0026#34;: 10, \u0026#34;timeout\u0026#34;: 5, \u0026#34;retries\u0026#34;: 3, \u0026#34;startPeriod\u0026#34;: 60 }, \u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;awslogs\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;awslogs-group\u0026#34;: \u0026#34;retail-store-ecs-tasks\u0026#34;, \u0026#34;awslogs-region\u0026#34;: \u0026#34;$AWS_REGION\u0026#34;, \u0026#34;awslogs-stream-prefix\u0026#34;: \u0026#34;checkout-service\u0026#34; } } } ] } ƒêƒÉng k√Ω task definition:\naws ecs register-task-definition \\ --cli-input-json file://retail-store-ecs-checkout-taskdef.json D√πng l·ªánh sau ƒë·ªÉ t·∫°o Checkout Service:\naws ecs create-service \\ --cluster retail-store-ecs-cluster \\ --service-name checkout \\ --task-definition retail-store-ecs-checkout \\ --desired-count 1 \\ --launch-type FARGATE \\ --enable-execute-command \\ --network-configuration \u0026#34;awsvpcConfiguration={subnets=[subnet-0b742ee8bbf495219, subnet-0317d1d968b9963d0], securityGroups=[sg-037956d78913fda63],assignPublicIp=DISABLED}\u0026#34; \\ --service-connect-configuration \u0026#39;{ \u0026#34;enabled\u0026#34;: true, \u0026#34;namespace\u0026#34;: \u0026#34;retailstore.local\u0026#34;, \u0026#34;services\u0026#34;: [ { \u0026#34;portName\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;discoveryName\u0026#34;: \u0026#34;checkout\u0026#34;, \u0026#34;clientAliases\u0026#34;: [ { \u0026#34;port\u0026#34;: 80, \u0026#34;dnsName\u0026#34;: \u0026#34;checkout\u0026#34; } ] } ] }\u0026#39; Deploy Catalog Service T·∫°o Task Definition cho Catalog Service. T·∫°o task definition v·ªõi file json retail-store-ecs-catalog-taskdef.json v·ªõi n·ªôi dung nh∆∞ sau:\n{ \u0026#34;family\u0026#34;: \u0026#34;retail-store-ecs-catalog\u0026#34;, \u0026#34;executionRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/catalogEcsTaskExecutionRole\u0026#34;, \u0026#34;taskRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskRole\u0026#34;, \u0026#34;networkMode\u0026#34;: \u0026#34;awsvpc\u0026#34;, \u0026#34;requiresCompatibilities\u0026#34;: [ \u0026#34;FARGATE\u0026#34; ], \u0026#34;cpu\u0026#34;: \u0026#34;1024\u0026#34;, \u0026#34;memory\u0026#34;: \u0026#34;2048\u0026#34;, \u0026#34;runtimePlatform\u0026#34;: { \u0026#34;cpuArchitecture\u0026#34;: \u0026#34;X86_64\u0026#34;, \u0026#34;operatingSystemFamily\u0026#34;: \u0026#34;LINUX\u0026#34; }, \u0026#34;containerDefinitions\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/aws-containers/retail-store-sample-catalog:1.2.3\u0026#34;, \u0026#34;portMappings\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;containerPort\u0026#34;: 8080, \u0026#34;hostPort\u0026#34;: 8080, \u0026#34;protocol\u0026#34;: \u0026#34;tcp\u0026#34;, \u0026#34;appProtocol\u0026#34;: \u0026#34;http\u0026#34; } ], \u0026#34;essential\u0026#34;: true, \u0026#34;linuxParameters\u0026#34;: { \u0026#34;initProcessEnabled\u0026#34;: true }, \u0026#34;environment\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_CATALOG_PERSISTENCE_DB_NAME\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;catalog\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_CATALOG_PERSISTENCE_PROVIDER\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;mysql\u0026#34; } ], \u0026#34;secrets\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_CATALOG_PERSISTENCE_ENDPOINT\u0026#34;, \u0026#34;valueFrom\u0026#34;: \u0026#34;arn:aws:ssm:${AWS_REGION}:${ACCOUNT_ID}:parameter/retail-store-ecs/catalog/db-endpoint-mysql\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_CATALOG_PERSISTENCE_PASSWORD\u0026#34;, \u0026#34;valueFrom\u0026#34;: \u0026#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-catalog-db:password::\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_CATALOG_PERSISTENCE_USER\u0026#34;, \u0026#34;valueFrom\u0026#34;: \u0026#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-catalog-db:username::\u0026#34; } ], \u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;awslogs\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;awslogs-group\u0026#34;: \u0026#34;retail-store-ecs-tasks\u0026#34;, \u0026#34;awslogs-region\u0026#34;: \u0026#34;${AWS_REGION}\u0026#34;, \u0026#34;awslogs-stream-prefix\u0026#34;: \u0026#34;catalog-service\u0026#34; } }, \u0026#34;healthCheck\u0026#34;: { \u0026#34;command\u0026#34;: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -f http://localhost:8080/health || exit 1\u0026#34; ], \u0026#34;interval\u0026#34;: 10, \u0026#34;timeout\u0026#34;: 5, \u0026#34;retries\u0026#34;: 3, \u0026#34;startPeriod\u0026#34;: 60 } } ] } ƒêƒÉng k√Ω task definition:\naws ecs register-task-definition \\ --cli-input-json file://retail-store-ecs-catalog-taskdef.json D√πng l·ªánh sau ƒë·ªÉ t·∫°o Catalog Service:\naws ecs create-service \\ --cluster retail-store-ecs-cluster \\ --service-name catalog \\ --task-definition retail-store-ecs-catalog \\ --desired-count 2 \\ --launch-type FARGATE \\ --enable-execute-command \\ --network-configuration \u0026#34;awsvpcConfiguration={subnets=[${PRIVATE_SUBNET1}, ${PRIVATE_SUBNET2}], securityGroups=[$CATALOG_SG_ID],assignPublicIp=DISABLED}\u0026#34; \\ --service-connect-configuration \u0026#39;{ \u0026#34;enabled\u0026#34;: true, \u0026#34;namespace\u0026#34;: \u0026#34;retailstore.local\u0026#34;, \u0026#34;services\u0026#34;: [ { \u0026#34;portName\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;discoveryName\u0026#34;: \u0026#34;catalog\u0026#34;, \u0026#34;clientAliases\u0026#34;: [ { \u0026#34;port\u0026#34;: 80, \u0026#34;dnsName\u0026#34;: \u0026#34;catalog\u0026#34; } ] } ] }\u0026#39; Ch·ªù c√°c Service ƒë∆∞·ª£c t·∫°o xong, ti·∫øp theo, c·∫≠p nh·∫≠t c·∫•u h√¨nh UI Service ƒë·ªÉ n√≥ c√≥ th·ªÉ t∆∞∆°ng t√°c v·ªõi c√°c microservices v·ª´a tri·ªÉn khai. C√°c environment variables sau c·∫ßn ƒë∆∞·ª£c th√™m v√†o UI Task Definition:\n\u0026#34;environment\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_UI_ENDPOINTS_ORDERS\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;http://orders\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_UI_ENDPOINTS_CHECKOUT\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;http://checkout\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_UI_ENDPOINTS_CATALOG\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;http://catalog\u0026#34; } ] Ch·∫°y script sau ƒë·ªÉ in ra UI Task Definition:\ncat retail-store-ecs-ui-connect-taskdef.json | jq ƒêƒÉng k√Ω Task Definition m·ªõi cho UI:\naws ecs register-task-definition --cli-input-json file://retail-store-ecs-ui-connect-taskdef.json C·∫≠p nh·∫≠t UI Service v·ªõi Task Definition m·ªõi v√† Service Connect configuration. ƒê·ªìng th·ªùi b·∫≠t Service Connect access logs ƒë·ªÉ thu th·∫≠p telemetry chi ti·∫øt cho t·ª´ng request.\naws ecs update-service \\ --cluster retail-store-ecs-cluster \\ --service ui \\ --task-definition retail-store-ecs-ui \\ --force-new-deployment \\ --desired-count 2 \\ --service-connect-configuration \u0026#39;{ \u0026#34;enabled\u0026#34;: true, \u0026#34;namespace\u0026#34;: \u0026#34;retailstore.local\u0026#34;, \u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;awslogs\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;awslogs-group\u0026#34;: \u0026#34;\u0026#39;$SERVICE_CONNECT_LOG_GROUP_NAME\u0026#39;\u0026#34;, \u0026#34;awslogs-region\u0026#34;: \u0026#34;\u0026#39;$AWS_REGION\u0026#39;\u0026#34;, \u0026#34;awslogs-stream-prefix\u0026#34;: \u0026#34;ui-service-connect-logs\u0026#34; } }, \u0026#34;accessLogConfiguration\u0026#34;: { \u0026#34;format\u0026#34;: \u0026#34;JSON\u0026#34;, \u0026#34;includeQueryParameters\u0026#34;: \u0026#34;ENABLED\u0026#34; }, \u0026#34;services\u0026#34;: [ { \u0026#34;portName\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;discoveryName\u0026#34;: \u0026#34;ui\u0026#34;, \u0026#34;clientAliases\u0026#34;: [ { \u0026#34;port\u0026#34;: 80, \u0026#34;dnsName\u0026#34;: \u0026#34;ui\u0026#34; } ] } ] }\u0026#39; "
},
{
	"uri": "http://localhost:1313/vi/4-express-mode/4.1-setup_deploy/",
	"title": "Express Mode Setup &amp; Deployment",
	"tags": [],
	"description": "",
	"content": "Tr∆∞·ªõc khi c√≥ th·ªÉ tri·ªÉn khai ·ª©ng d·ª•ng b·∫±ng Express Mode, ch√∫ng ta c·∫ßn m·ªôt Infrastructure Role c√≥ t√™n ecsExpressInfrastructureRole.\nIAM role n√†y cho ph√©p Amazon ECS Express Mode thay m·∫∑t b·∫°n qu·∫£n l√Ω c√°c th√†nh ph·∫ßn h·∫° t·∫ßng, bao g·ªìm:\nLoad balancers\nAuto-scaling\nC·∫•u h√¨nh networking\nT·∫°o Infrastructure Role ƒê·∫ßu ti√™n ch√∫ng ta c·∫ßn t·∫°o trust policy cho role n√†y v·ªõi n·ªôi dung file json b√™n d∆∞·ªõi:\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;ecs.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34; } ] } Ti·∫øn h√†nh ch·∫°y l·ªánh sau ƒë·ªÉ t·∫°o Role:\naws iam create-role \\ --role-name ecsExpressInfrastructureRole \\ --assume-role-policy-document file://ecs-express-trust.json Ti·∫øp theo ti·∫øn h√†nh Attach policy AWS-managed v√†o role v·ª´a t·∫°o:\naws iam attach-role-policy \\ --role-name ecsExpressInfrastructureRole \\ --policy-arn arn:aws:iam::aws:policy/service-role/AmazonECSInfrastructureRoleforExpressGatewayServices Ki·ªÉm tra Managed Policy c·ªßa Infrastructure Role\naws iam list-attached-role-policies \\ --role-name ecsExpressInfrastructureRole Nh∆∞ v·∫≠y ch√∫ng ta ƒë√£ t·∫°o ƒë∆∞·ª£c Infrastructure Role v√† Attach policy AWS-managed v√†o role v·ª´a t·∫°o.\nExpress Mode Deployment Ch√∫ng ta s·∫Ω tri·ªÉn khai UI service t∆∞∆°ng t·ª± nh∆∞ ·ªü ph·∫ßn Fundamentals, nh∆∞ng s·ª≠ d·ª•ng Amazon ECS Express Mode.\nService Express Mode ch·ªâ c·∫ßn ba th√†nh ph·∫ßn ƒë·ªÉ b·∫Øt ƒë·∫ßu:\nContainer image Task execution role Infrastructure role ƒê·ªÉ ch·∫°y ·ª©ng d·ª•ng m·∫´u, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng m·ªôt s·ªë tham s·ªë t√πy ch·ªânh ƒë∆∞·ª£c m√¥ t·∫£ trong b·∫£ng d∆∞·ªõi ƒë√¢y:\nTham s·ªë B·∫Øt bu·ªôc M√¥ t·∫£ execution-role-arn C√≥ IAM role d√πng cho task execution infrastructure-role-arn C√≥ IAM role d√πng ƒë·ªÉ qu·∫£n l√Ω h·∫° t·∫ßng primary-container C√≥ X√°c ƒë·ªãnh container ch√≠nh v√† port cluster, service-name Kh√¥ng T√™n ECS cluster v√† t√™n Express service cpu, memory Kh√¥ng T√†i nguy√™n c·∫•p ph√°t cho service health-check-path Kh√¥ng Endpoint d√πng cho health check network-configuration Kh√¥ng X√°c ƒë·ªãnh VPC subnets v√† security groups cho task scaling-target Kh√¥ng X√°c ƒë·ªãnh c√°ch service t·ª± ƒë·ªông scale s·ªë l∆∞·ª£ng task theo nhu c·∫ßu monitor-resources Kh√¥ng B·∫≠t gi√°m s√°t t√†i nguy√™n trong qu√° tr√¨nh create, update v√† delete Ch·∫°y c√¢u l·ªánh b√™n d∆∞·ªõi ƒë·ªÉ tri·ªÉn khai Service ui-express-mode tr√™n ECS cluster hi·ªán c√≥ retail-store-ecs-cluster.\naws ecs create-express-gateway-service \\ --execution-role-arn arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskExecutionRole \\ --infrastructure-role-arn arn:aws:iam::${ACCOUNT_ID}:role/ecsExpressInfrastructureRole \\ --service-name ui-express-mode \\ --cpu \u0026#34;1024\u0026#34; \\ --memory \u0026#34;2048\u0026#34; \\ --health-check-path \u0026#34;/actuator/health\u0026#34; \\ --cluster retail-store-ecs-cluster \\ --network-configuration \u0026#39;{ \u0026#34;subnets\u0026#34;: [\u0026#34;\u0026#39;$PUBLIC_SUBNET1\u0026#39;\u0026#34;,\u0026#34;\u0026#39;$PUBLIC_SUBNET2\u0026#39;\u0026#34;] }\u0026#39; \\ --scaling-target \u0026#39;{ \u0026#34;minTaskCount\u0026#34;: 2, \u0026#34;maxTaskCount\u0026#34;: 5, \u0026#34;autoScalingMetric\u0026#34;: \u0026#34;REQUEST_COUNT_PER_TARGET\u0026#34;, \u0026#34;autoScalingTargetValue\u0026#34;: 50 }\u0026#39; \\ --primary-container \u0026#39;{ \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/aws-containers/retail-store-sample-ui:1.2.3\u0026#34;, \u0026#34;containerPort\u0026#34;: 8080 }\u0026#39; --monitor-resources Sau khi ch·∫°y l·ªánh tr√™n, ECS Express Mode s·∫Ω t·ª± ƒë·ªông:\nT·∫°o task definition\nC·∫•u h√¨nh load balancer\nThi·∫øt l·∫≠p service\nThi·∫øt l·∫≠p auto-scaling\nC·∫•u h√¨nh c√°c th√†nh ph·∫ßn networking c·∫ßn thi·∫øt\nT√πy ch·ªçn --monitor-resources s·∫Ω hi·ªÉn th·ªã t·ªïng quan t·∫•t c·∫£ c√°c t√†i nguy√™n ƒëang ƒë∆∞·ª£c t·∫°o nh∆∞ ·∫£nh b√™n d∆∞·ªõi:\nƒê·ªÉ ƒë√≥ng ƒë·ªô gi√°m s√°t, c√≥ th·ªÉ ·∫•n q.\nTrong khi ECS Express Mode ƒëang t·∫°o t√†i nguy√™n, h√£y truy c·∫≠p Amazon ECS Console ƒë·ªÉ xem:\nC√°c service ƒëang ho·∫°t ƒë·ªông\nC√°c task ƒëang ch·∫°y\nC√°c Task v√† t√†i nguy√™n sau khi ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nTi·∫øn h√†nh l·∫•y DNS c·ªßa Application Load Balancer v√† truy c·∫≠p v√†o ·ª©ng d·ª•ng.\nECS_ALB_DNS=$(aws ecs describe-express-gateway-service \\ --service-arn arn:aws:ecs:${AWS_REGION}:${ACCOUNT_ID}:service/retail-store-ecs-cluster/ui-express-mode \\ --query service.activeConfigurations[0].ingressPaths[0].endpoint \\ --output text) echo \u0026#34;https://${ECS_ALB_DNS}\u0026#34; Ti·∫øn h√†nh truy c·∫≠p v√†o ·ª©ng d·ª•ng b·∫±ng DNS:\nExpress Mode Review Service Overview hi·ªÉn th·ªã t·ªïng quan service, c√≥ th·ªÉ:\nTheo d√µi tr·∫°ng th√°i service\nXem c√°c task ƒëang ch·∫°y\nGi√°m s√°t ti·∫øn tr√¨nh deployment\nL∆∞u √Ω Application URL ƒë∆∞·ª£c hi·ªÉn th·ªã tr√™n trang n√†y ‚Äî c√≥ th·ªÉ s·ª≠ d·ª•ng URL ƒë√≥ ƒë·ªÉ truy c·∫≠p ·ª©ng d·ª•ng ƒë√£ tri·ªÉn khai.\nƒê·ªÉ gi√°m s√°t ·ª©ng d·ª•ng, c√≥ th·ªÉ xem c√°c metrics c·ªßa service ui-express-mode trong c√°c tab:\nObservability\nLogs\nTrong ph·∫ßn Logs, c√≥ th·ªÉ xem log ·ª©ng d·ª•ng, l·ªçc c√°c th√¥ng ƒëi·ªáp c·ª• th·ªÉ v√† theo d√µi h√†nh vi ·ª©ng d·ª•ng theo th·ªùi gian th·ª±c.\nTab Resources cung c·∫•p t·ªïng quan t·∫•t c·∫£ t√†i nguy√™n AWS ƒë∆∞·ª£c Express Mode t·ª± ƒë·ªông provision.\nDanh s√°ch n√†y bao g·ªìm ƒë·∫ßy ƒë·ªß c√°c th√†nh ph·∫ßn h·∫° t·∫ßng ƒë∆∞·ª£c t·∫°o v√† qu·∫£n l√Ω cho b·∫°n, ch·∫≥ng h·∫°n nh∆∞:\nSecurity Groups\nLoad Balancers\nTarget Groups\nKi·ªÉm tra c·∫•u h√¨nh Express Mode cho revision m·ªõi nh·∫•t c·ªßa service ui-express-mode b·∫±ng l·ªánh sau:\nSERVICE_REVISION_ARN=$(aws ecs list-service-deployments \\ --service arn:aws:ecs:${AWS_REGION}:${ACCOUNT_ID}:service/retail-store-ecs-cluster/ui-express-mode \\ --max-results 1 \\ --query serviceDeployments[0].targetServiceRevisionArn \\ --output text) aws ecs describe-service-revisions \\ --service-revision-arn $SERVICE_REVISION_ARN Trong qu√° tr√¨nh t·∫°o service, Express Mode ƒë√£ t·ª± ƒë·ªông t·∫°o Task Definition cho ·ª©ng d·ª•ng. C√≥ th·ªÉ li·ªát k√™ c√°c revision c·ªßa Task Definition b·∫±ng l·ªánh sau:\naws ecs list-task-definitions --family-prefix retail-store-ecs-cluster-ui-express-mode --sort DESC --max-items 2 Ki·ªÉm tra Load Balancer b·∫±ng c√°ch m·ªü Amazon Load Balancer Console v√† ch·ªçn load balancer c√≥ t√™n d·∫°ng ecs-express-gateway-alb-XXXXXXXX ƒë·ªÉ xem chi ti·∫øt c·∫•u h√¨nh.\nC√≥ th·ªÉ th·∫•y:\nHTTPS listener Certificate h·ª£p l·ªá ƒê√£ ƒë∆∞·ª£c ECS Express Mode t·ª± ƒë·ªông c·∫•u h√¨nh.\n"
},
{
	"uri": "http://localhost:1313/vi/1-introduction/",
	"title": "Gi·ªõi thi·ªáu",
	"tags": [],
	"description": "",
	"content": "Amazon ECS Amazon Elastic Container Service (ECS) l√† m·ªôt d·ªãch v·ª• container orchestration service ƒë∆∞·ª£c qu·∫£n l√Ω ho√†n to√†n b·ªüi AWS, gi√∫p ƒë∆°n gi·∫£n h√≥a vi·ªác tri·ªÉn khai, qu·∫£n l√Ω v√† m·ªü r·ªông c√°c ·ª©ng d·ª•ng ƒë∆∞·ª£c ƒë√≥ng g√≥i b·∫±ng container. D·ªãch v·ª• n√†y t√≠ch h·ª£p ch·∫∑t ch·∫Ω v·ªõi c√°c d·ªãch v·ª• AWS kh√°c, cung c·∫•p m·ªôt gi·∫£i ph√°p an to√†n, d·ªÖ s·ª≠ d·ª•ng ƒë·ªÉ ch·∫°y c√°c workload container tr√™n m√¥i tr∆∞·ªùng ƒë√°m m√¢y v√† c·∫£ h·∫° t·∫ßng on-premises th√¥ng qua Amazon ECS Anywhere.\nAWS Fargate AWS Fargate l√† m·ªôt compute engine d·∫°ng serverless, ho·∫°t ƒë·ªông theo m√¥ h√¨nh tr·∫£ ti·ªÅn theo m·ª©c s·ª≠ d·ª•ng (pay-as-you-go), cho ph√©p b·∫°n t·∫≠p trung x√¢y d·ª±ng ·ª©ng d·ª•ng m√† kh√¥ng c·∫ßn qu·∫£n l√Ω m√°y ch·ªß. AWS Fargate t∆∞∆°ng th√≠ch v·ªõi c·∫£ Amazon Elastic Container Service (Amazon ECS) v√† Amazon Elastic Kubernetes Service (Amazon EKS).\nL·ª£i √≠ch c·ªßa AWS Fargate T·∫≠p trung v√†o ·ª©ng d·ª•ng, kh√¥ng ph·∫£i h·∫° t·∫ßng: Tri·ªÉn khai v√† qu·∫£n l√Ω ·ª©ng d·ª•ng m√† kh√¥ng ph·∫£i g√°nh c√°c c√¥ng vi·ªác v·∫≠n h√†nh nh∆∞ m·ªü r·ªông quy m√¥ (scaling), v√° l·ªói (patching), b·∫£o m·∫≠t v√† qu·∫£n l√Ω m√°y ch·ªß.\nC√≥ c√°i nh√¨n to√†n di·ªán th√¥ng qua gi√°m s√°t chi ti·∫øt: Gi√°m s√°t ·ª©ng d·ª•ng b·∫±ng c√°c t√≠ch h·ª£p s·∫µn v·ªõi d·ªãch v·ª• AWS nh∆∞ Amazon CloudWatch Container Insights, ho·∫∑c thu th·∫≠p metrics v√† logs th√¥ng qua c√°c c√¥ng c·ª• c·ªßa b√™n th·ª© ba.\nTƒÉng c∆∞·ªùng b·∫£o m·∫≠t nh·ªù c√°ch ly workload: N√¢ng cao b·∫£o m·∫≠t ngay t·ª´ thi·∫øt k·∫ø v·ªõi c∆° ch·∫ø c√°ch ly workload. M·ªói workload ch·∫°y tr√™n AWS Fargate ƒë·ªÅu s·ª≠ d·ª•ng m·ªôt compute instance ri√™ng bi·ªát, d√πng m·ªôt l·∫ßn, d√†nh ri√™ng cho m·ªôt tenant, v√† ƒë∆∞·ª£c c√°ch ly b·∫±ng l·ªõp ·∫£o h√≥a. M·ªói Amazon ECS task ho·∫∑c Kubernetes pod s·∫Ω ch·∫°y tr√™n m·ªôt instance m·ªõi ƒë∆∞·ª£c c·∫•p ph√°t. ƒê·ªÉ t√¨m hi·ªÉu chi ti·∫øt h∆°n v·ªÅ ki·∫øn tr√∫c AWS Fargate, tham kh·∫£o AWS Fargate Security Whitepaper.\nT·ªëi ∆∞u chi ph√≠ hi·ªáu qu·∫£: Ch·ªâ tr·∫£ ti·ªÅn cho t√†i nguy√™n compute th·ª±c s·ª± s·ª≠ d·ª•ng, kh√¥ng c√≥ chi ph√≠ tr·∫£ tr∆∞·ªõc. C√≥ th·ªÉ gi·∫£m chi ph√≠ h∆°n n·ªØa b·∫±ng c√°ch s·ª≠ d·ª•ng Savings Plans, Fargate Spot ho·∫∑c b·ªô x·ª≠ l√Ω AWS Graviton.\nT·ªïng quan v·ªÅ ·ª©ng d·ª•ng Microservices ƒë∆∞·ª£c tri·ªÉn khai H·∫ßu h·∫øt c√°c lab trong workshop n√†y s·ª≠ d·ª•ng m·ªôt ·ª©ng d·ª•ng Microservices nh·∫±m cung c·∫•p c√°c th√†nh ph·∫ßn container cho c√°c b√†i th·ª±c h√†nh. ·ª®ng d·ª•ng m·∫´u m√¥ ph·ªèng m·ªôt c·ª≠a h√†ng web ƒë∆°n gi·∫£n, n∆°i kh√°ch h√†ng c√≥ th·ªÉ duy·ªát danh m·ª•c s·∫£n ph·∫©m, th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng v√† ho√†n t·∫•t ƒë∆°n h√†ng th√¥ng qua quy tr√¨nh thanh to√°n.\n·ª®ng d·ª•ng bao g·ªìm c√°c th√†nh ph·∫ßn v√† c√°c dependency nh∆∞ sau:\nTh√†nh ph·∫ßn M√¥ t·∫£ UI Cung c·∫•p giao di·ªán ng∆∞·ªùi d√πng ph√≠a front-end v√† t·ªïng h·ª£p c√°c API call t·ªõi c√°c Services kh√°c Catalog API cung c·∫•p danh s√°ch v√† chi ti·∫øt s·∫£n ph·∫©m Cart API qu·∫£n l√Ω gi·ªè h√†ng c·ªßa kh√°ch h√†ng Checkout API ƒëi·ªÅu ph·ªëi to√†n b·ªô quy tr√¨nh thanh to√°n Orders API ti·∫øp nh·∫≠n v√† x·ª≠ l√Ω ƒë∆°n h√†ng c·ªßa kh√°ch h√†ng ƒê√≥ng g√≥i ·ª©ng d·ª•ng th√†nh Container Tr∆∞·ªõc khi tri·ªÉn khai m·ªôt workload l√™n Amazon ECS, workload ƒë√≥ c·∫ßn ƒë∆∞·ª£c ƒë√≥ng g√≥i d∆∞·ªõi d·∫°ng container image v√† ƒë·∫©y (publish) l√™n m·ªôt container registry.\nC√°c ki·∫øn th·ª©c container c∆° b·∫£n nh∆∞ v·∫≠y kh√¥ng n·∫±m trong ph·∫°m vi c·ªßa workshop n√†y, v√† ·ª©ng d·ª•ng ƒë√£ c√≥ s·∫µn c√°c container image trong Amazon Elastic Container Registry (Amazon ECR) ƒë·ªÉ s·ª≠ d·ª•ng cho c√°c b√†i lab.\nB·∫£ng d∆∞·ªõi ƒë√¢y cung c·∫•p ƒë∆∞·ªùng d·∫´n t·ªõi ECR Public repository cho t·ª´ng th√†nh ph·∫ßn, c≈©ng nh∆∞ Dockerfile ƒë∆∞·ª£c d√πng ƒë·ªÉ build m·ªói component.\nTh√†nh ph·∫ßn ECR Public repository Dockerfile UI Repository Dockerfile Catalog Repository Dockerfile Shopping cart Repository Dockerfile Checkout Repository Dockerfile Orders Repository Dockerfile "
},
{
	"uri": "http://localhost:1313/vi/6-auto-scaling/6.1-sas/",
	"title": "Service Auto Scaling",
	"tags": [],
	"description": "",
	"content": "Service Auto Scaling Amazon ECS t√≠ch h·ª£p v·ªõi Amazon CloudWatch ƒë·ªÉ cho ph√©p scale ECS services m·ªôt c√°ch hi·ªáu qu·∫£ d·ª±a tr√™n c√°c real-time metrics. C√°c metric n√†y ƒë∆∞·ª£c truy·ªÅn t·ª´ Amazon ECS sang CloudWatch theo chu k·ª≥ m·ªói m·ªôt ph√∫t, cho ph√©p gi√°m s√°t ch√≠nh x√°c v√† ƒë∆∞a ra c√°c quy·∫øt ƒë·ªãnh scale k·ªãp th·ªùi.\nKhi c√°c metric v∆∞·ª£t qu√° thresholds ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong scaling policy, CloudWatch s·∫Ω k√≠ch ho·∫°t m·ªôt alarm ƒë·ªÉ ƒëi·ªÅu ch·ªânh desired number of tasks trong service c·ªßa b·∫°n. Qu√° tr√¨nh ƒëi·ªÅu ch·ªânh ƒë·ªông n√†y s·∫Ω tƒÉng desired capacity trong c√°c s·ª± ki·ªán scale-out v√† gi·∫£m trong c√°c s·ª± ki·ªán scale-in, ƒë·∫£m b·∫£o vi·ªác s·ª≠ d·ª•ng t√†i nguy√™n t·ªëi ∆∞u.\nAmazon ECS cung c·∫•p ba chi·∫øn l∆∞·ª£c service scaling n√¢ng cao:\nTarget Tracking Scaling:\nPh∆∞∆°ng ph√°p n√†y nh·∫±m duy tr√¨ m·ªôt scaling metric ·ªü m·ªôt target value x√°c ƒë·ªãnh b·∫±ng c√°ch t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng task. Target tracking scaling ƒë∆∞·ª£c ∆∞u ti√™n nh·ªù t√≠nh ƒë∆°n gi·∫£n v√† y√™u c·∫ßu b·∫£o tr√¨ th·∫•p, khi·∫øn n√≥ tr·ªü th√†nh l·ª±a ch·ªçn l√Ω t∆∞·ªüng cho c√°c doanh nghi·ªáp mu·ªën ƒë·∫°t hi·ªáu qu·∫£ v·∫≠n h√†nh m√† kh√¥ng c·∫ßn can thi·ªáp th·ªß c√¥ng th∆∞·ªùng xuy√™n. Step Scaling:\nChi·∫øn l∆∞·ª£c n√†y cung c·∫•p kh·∫£ nƒÉng ki·ªÉm so√°t chi ti·∫øt h∆°n ƒë·ªëi v·ªõi c√°c h√†nh ƒë·ªông scaling. Ng∆∞·ªùi d√πng c√≥ th·ªÉ ch·ªçn metric, thi·∫øt l·∫≠p threshold values, v√† ƒë·ªãnh nghƒ©a step adjustments ƒë·ªÉ ch·ªâ ƒë·ªãnh s·ªë l∆∞·ª£ng t√†i nguy√™n c·∫ßn th√™m ho·∫∑c b·ªõt. N√≥ c≈©ng cho ph√©p t√πy ch·ªânh breach evaluation periods cho c√°c metric alarm, mang l·∫°i c√°ch ti·∫øp c·∫≠n linh ho·∫°t ƒë·ªÉ x·ª≠ l√Ω c√°c workload bi·∫øn ƒë·ªông hi·ªáu qu·∫£. Scheduled Scaling:\nPh∆∞∆°ng ph√°p n√†y ph√π h·ª£p nh·∫•t khi c√°c h√†nh ƒë·ªông scaling c√≥ th·ªÉ ƒë∆∞·ª£c d·ª± ƒëo√°n tr∆∞·ªõc d·ª±a tr√™n c√°c known demand patterns. N√≥ l√Ω t∆∞·ªüng cho c√°c ·ª©ng d·ª•ng c√≥ s·ª± bi·∫øn ƒë·ªông traffic c√≥ th·ªÉ d·ª± ƒëo√°n, cho ph√©p qu·∫£n l√Ω t√†i nguy√™n m·ªôt c√°ch ch·ªß ƒë·ªông nh·∫±m ƒë·∫£m b·∫£o t√≠nh ·ªïn ƒë·ªãnh v√† hi·ªáu nƒÉng c·ªßa service trong c√°c th·ªùi ƒëi·ªÉm peak. Target Tracking Scaling T·ª± ƒë·ªông gi·ªØ metric quanh m·ªôt gi√° tr·ªã m·ª•c ti√™u. ECS kh√¥ng quan t√¢m c·∫ßn th√™m bao nhi√™u task, m√† ch·ªâ quan t√¢m:\n‚ÄúMetric hi·ªán t·∫°i c√≥ ƒëang l·ªách kh·ªèi target value kh√¥ng?‚Äù\nN·∫øu l·ªách ‚Üí ECS t·ª± t√≠nh to√°n s·ªë task c·∫ßn scale.\ndesiredTasks = currentTasks √ó (currentMetric / targetMetric) V√≠ d·ª•: CPU-based scaling\nMetric: ECSServiceAverageCPUUtilization Target value: 50% Hi·ªán t·∫°i: 2 tasks CPU = 90% desiredTasks = 2 √ó (90 / 50) = 3.6 ‚âà 4 tasks -\u0026gt; ECS scale 2 ‚Üí 4 tasks.\n∆Øu ƒëi·ªÉm: D·ªÖ c·∫•u h√¨nh Kh√¥ng c·∫ßn tuning ph·ª©c t·∫°p √çt b·∫£o tr√¨ Tr√°nh scale qu√° ƒë√† Nh∆∞·ª£c ƒëi·ªÉm: √çt ki·ªÉm so√°t chi ti·∫øt Kh√¥ng ph√π h·ª£p workload c√≥ spike c·ª±c nhanh Khi n√†o n√™n d√πng?\n80‚Äì90% ECS service. Web service, API, microservices. Load tƒÉng d·∫ßn ho·∫∑c t∆∞∆°ng ƒë·ªëi ·ªïn ƒë·ªãnh. Step Scaling Scale theo ‚Äúb·∫≠c‚Äù (step) d·ª±a tr√™n threshold.\nCh·ªß ƒë·ªông ƒë·ªãnh nghƒ©a:\nMetric n√†o Khi v∆∞·ª£t ng∆∞·ª°ng bao nhi√™u Th√¨ scale bao nhi√™u task ECS kh√¥ng t·ª± t√≠nh, m√† l√†m ƒë√∫ng theo rule ƒë∆∞·ª£c thi·∫øt l·∫≠p.\nV√≠ d·ª•: CPU-based Step Scaling\nMetric: CPUUtilization CPU H√†nh ƒë·ªông ‚â• 60% +1 task ‚â• 75% +2 tasks ‚â• 90% +4 tasks ‚â§ 30% -1 task Service c√≥ 2 task v√† CPU tƒÉng l√™n 85% -\u0026gt; ECS tƒÉng l√™n 2 tasks. Step scaling d√πng CloudWatch Alarm:\nV√≠ d·ª•:\nCPU ‚â• 75% Duy tr√¨ 2 ph√∫t li√™n t·ª•c ‚Üí Trigger scale action Tr√°nh scale do spike ng·∫Øn h·∫°n ( tƒÉng trong t·ªùi gian ng·∫Øn r·ªìi gi·∫£m ).\n∆Øu ƒëi·ªÉm\nKi·ªÉm so√°t r·∫•t chi ti·∫øt Ph√π h·ª£p workload bi·∫øn ƒë·ªông m·∫°nh D√πng ƒë∆∞·ª£c metric kh√¥ng proportional Nh∆∞·ª£c ƒëi·ªÉm\nC·∫•u h√¨nh ph·ª©c t·∫°p D·ªÖ sai n·∫øu tuning k√©m C·∫ßn theo d√µi \u0026amp; ƒëi·ªÅu ch·ªânh th∆∞·ªùng xuy√™n Khi n√†o n√™n d√πng?\nWorkload spike m·∫°nh, kh√¥ng tuy·∫øn t√≠nh Batch processing Legacy system Khi c·∫ßn ki·ªÉm so√°t ch√≠nh x√°c s·ªë task tƒÉng/gi·∫£m Scheduled Scaling Scale theo l·ªãch tr√¨nh (schedule).\nNg∆∞·ªùi c·∫•u h√¨nh bi·∫øt tr∆∞·ªõc: Khi n√†o load cao, khi n√†o load th·∫•p.\nECS scale theo th·ªùi gian ƒë·ªãnh s·∫µn, kh√¥ng c·∫ßn metric.\nV√≠ d·ª•: Website gi·ªù h√†nh ch√≠nh c√≥ gi·ªù ho·∫°t ƒë·ªông t·ª´ 8:00 ƒë·∫øn 18:00.\nTh·ªùi gian Tasks 08:00 ‚Äì 18:00 6 18:00 ‚Äì 08:00 2 ∆Øu ƒëi·ªÉm\nR·∫•t ·ªïn ƒë·ªãnh Kh√¥ng ph·ª• thu·ªôc metric Tr√°nh cold start Nh∆∞·ª£c ƒëi·ªÉm\nKh√¥ng ph·∫£n ·ª©ng ƒë∆∞·ª£c traffic b·∫•t ng·ªù Ph·∫£i d·ª± ƒëo√°n ƒë√∫ng Khi n√†o n√™n d√πng?\nTraffic c√≥ pattern r√µ r√†ng Business hours Event c·ªë ƒë·ªãnh (sale, livestream, exam system) "
},
{
	"uri": "http://localhost:1313/vi/3-prepare/3.1-user_accesskey/",
	"title": "T·∫°o User &amp; Access Key",
	"tags": [],
	"description": "",
	"content": "C√†i ƒë·∫∑t AWS CLI Linux: sudo apt update sudo apt install -y unzip curl curl \u0026#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\u0026#34; -o awscliv2.zip unzip awscliv2.zip sudo ./aws/install MacOS: curl \u0026#34;https://awscli.amazonaws.com/AWSCLIV2.pkg\u0026#34; -o AWSCLIV2.pkg sudo installer -pkg AWSCLIV2.pkg -target / Windows: msiexec.exe /i https://awscli.amazonaws.com/AWSCLIV2.msi T·∫°o User v√† t·∫°o Access Key Truy c·∫≠p AWS Console v√† t·∫°o m·ªõi m·ªôt User v·ªõi quy·ªÅn AdministratorAccess.\nTr√™n thanh t√¨m ki·∫øm c·ªßa AWS Console, nh·∫≠p \u0026ldquo;IAM\u0026rdquo; v√† ch·ªçn \u0026ldquo;IAM\u0026rdquo;.\nCh·ªçn Users trong menu b√™n tr√°i.\nTi·∫øp theo ch·ªçn Add user ƒë·ªÉ t·∫°o m·ªõi m·ªôt User.\nNh·∫≠p t√™n cho User: ecs-workshop\nCh·ªçn Custom Password ƒë·ªÉ t·∫°o m·∫≠t kh·∫©u cho User.\nCh·ªçn Next.\nC·∫•u h√¨nh quy·ªÅn cho User:\nAttach policies directly: Ch·ªçn AdministratorAccess ƒë·ªÉ c·∫•u h√¨nh quy·ªÅn cho User. Ch·ªçn Next.\nCh·ªçn Create user.\nNh∆∞ v·∫≠y User ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nTi·∫øn h√†nh quay l·∫°i IAM Console v√† ch·ªçn Users trong menu b√™n tr√°i.\nCh·ªçn User v·ª´a t·∫°o.\nCh·ªçn Security credentials tab.\nCh·ªçn Create access key.\nCh·ªçn Command Line Interface (CLI). ·∫§n x√°c nh·∫≠n v√† qua b∆∞·ªõc ti·∫øp theo\nDescription: Amazon ECS Immersion Day v√† ti·∫øn h√†nh t·∫°o access key.\nNh∆∞ v·∫≠y access key ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng v√† c√≥ th·ªÉ ·∫•n Download .csv ƒë·ªÉ t·∫£i v·ªÅ file credentials.csv.\nC·∫•u h√¨nh AWS CLI Truy c·∫≠p CLI ƒë·ªÉ ti·∫øn h√†nh c·∫•u h√¨nh AWS CLI.\nKi·ªÉm tra version c·ªßa AWS CLI.\naws --version C·∫•u h√¨nh AWS CLI.\naws configure Nh∆∞ v·∫≠y AWS CLI ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh th√†nh c√¥ng.\nKi·ªÉm tra ho·∫°t ƒë·ªông c·ªßa AWS CLI.\naws ec2 describe-instances Nh∆∞ v·∫≠y AWS CLI ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh th√†nh c√¥ng v√† ho·∫°t ƒë·ªông t·ªët.\n"
},
{
	"uri": "http://localhost:1313/vi/",
	"title": "Workshop Amazon Elastic Container Service &amp; AWS Fargate",
	"tags": [],
	"description": "",
	"content": "Workshop Amazon Elastic Container Service \u0026amp; AWS Fargate Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Amazon Elastic Container Service Immersion Day!\nAmazon Elastic Container Service (ECS) l√† m·ªôt d·ªãch v·ª• Container Orchestration Service ƒë∆∞·ª£c qu·∫£n l√Ω ho√†n to√†n b·ªüi AWS. N√≥ cho ph√©p b·∫°n Deploy, Qu·∫£n l√Ω v√† m·ªü r·ªông quy m√¥ ·ª©ng d·ª•ng Container m·ªôt c√°ch nhanh ch·ªëng v√† hi·ªáu qu·∫£.\nECS c√≥ th·ªÉ t√≠ch h·ª£p v·ªõi h·ªá sinh th√°i AWS, cung c·∫•p m·ªôt gi·∫£i ph√°p d·ªÖ s·ª≠ d·ª•ng ƒë·ªÉ ch·∫°y c√°c workload container tr√™n m√¥i tr∆∞·ªùng Cloud, ƒë·ªìng th·ªùi h·ªó tr·ª£ c√°c kh·∫£ nƒÉng b·∫£o m·∫≠t n√¢ng cao th√¥ng qua Amazon ECS Anywhere.\nAWS Fargate l√† m·ªôt d·ªãch v·ª• Serverless, tr·∫£ ph√≠ theo m·ª©c s·ª≠ d·ª•ng ( pay-as-you-go ), cho ph√©p x√¢y d·ª±ng ·ª©ng d·ª•ng m√† kh√¥ng c·∫ßn quan t√¢m ƒë·∫øn h·∫° t·∫ßng. B·∫±ng c√°ch giao vi·ªác qu·∫£n l√Ω m√°y ch·ªß, ph√¢n b·ªï t√†i nguy√™n v√† scaling cho AWS, ƒëi·ªÅu n√†y gi√∫p n√¢ng cao nƒÉng l·ª±c v·∫≠n h√†nh, tƒÉng t·ªëc qu√° tr√¨nh ƒë∆∞a √Ω t∆∞·ªüng v√†o production v√† t·ªëi ∆∞u TCO (Total Cost of Ownership).\nB·∫°n s·∫Ω h·ªçc ƒë∆∞·ª£c g√¨ th√¥ng qua workshop n√†y? Hi·ªÉu c√°c kh√°i ni·ªám n·ªÅn t·∫£ng c·ªßa Amazon ECS v√† AWS Fargate: cluster, task v√† service. Tri·ªÉn khai autoscaling cho workload nh·∫±m ƒë√°p ·ª©ng c√°c m·ª©c t·∫£i thay ƒë·ªïi. Gi√°m s√°t h√†nh vi c·ªßa workload th√¥ng qua log, metric v√† trace. N·∫Øm b·∫Øt networking trong AWS Fargate v√† c√°c kh√°i ni·ªám networking n√¢ng cao. Kh√°m ph√° c√°c kh√≠a c·∫°nh b·∫£o m·∫≠t, bao g·ªìm qu·∫£n l√Ω credential v√† secret m·ªôt c√°ch an to√†n. T√¨m hi·ªÉu c√°c chi·∫øn l∆∞·ª£c tri·ªÉn khai workload kh√°c nhau tr√™n Amazon ECS. ƒê·ªëi t∆∞·ª£ng tham gia Workshop ·ªü c·∫•p ƒë·ªô 200+, ph√π h·ª£p v·ªõi c√°c b·∫°n mu·ªën Hands-on v·ªõi Amazon ECS, l√†m quen v·ªõi c√°c th√†nh ph·∫ßn c·ªët l√µi c·ªßa ECS, c≈©ng nh∆∞ c√°ch √°p d·ª•ng th·ª±c t·∫ø trong vi·ªác tri·ªÉn khai v√† qu·∫£n l√Ω c√°c workload container h√≥a. Pre-requisites ƒê√¢y kh√¥ng ph·∫£i l√† workshop nh·∫≠p m√¥n v·ªÅ container. Ng∆∞·ªùi tham gia c·∫ßn c√≥ ki·∫øn th·ª©c n·ªÅn t·∫£ng v·ªÅ Container, c·ª• th·ªÉ:\nHi·ªÉu v·ªÅ Container, bao g·ªìm kh·∫£ nƒÉng build container b·∫±ng Dockerfile. C√≥ ki·∫øn th·ª©c c∆° b·∫£n v√† quen thu·ªôc v·ªõi AWS Management Console, AWS APIs. N·ªôi dung ch√≠nh Gi·ªõi thi·ªáu Chu·∫©n b·ªã Express Mode Managed Instances Auto Scaling Networking Observability Security Deployments Storage Cost Optimizations Clean Up "
},
{
	"uri": "http://localhost:1313/vi/4-express-mode/4.2-update/",
	"title": "Express Mode Update",
	"tags": [],
	"description": "",
	"content": "Update Service Trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω c·∫≠p nh·∫≠t service ui-express-mode b·∫±ng c√°ch thay ƒë·ªïi giao di·ªán m·∫∑c ƒë·ªãnh c·ªßa ·ª©ng d·ª•ng sang m√†u cam th√¥ng qua vi·ªác c·∫≠p nh·∫≠t environment variable.\n\u0026#34;environment\u0026#34;: [{ \u0026#34;name\u0026#34;: \u0026#34;RETAIL_UI_THEME\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;orange\u0026#34; }] Ch·∫°y l·ªánh sau ƒë·ªÉ c·∫≠p nh·∫≠t Service ui-express-mode.\naws ecs update-express-gateway-service \\ --service-arn arn:aws:ecs:${AWS_REGION}:${ACCOUNT_ID}:service/retail-store-ecs-cluster/ui-express-mode \\ --primary-container \u0026#39;{ \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/aws-containers/retail-store-sample-ui:1.2.3\u0026#34;, \u0026#34;environment\u0026#34;: [{ \u0026#34;name\u0026#34;: \u0026#34;RETAIL_UI_THEME\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;orange\u0026#34; }] }\u0026#39; M·ªü Amazon ECS Console:\nCh·ªçn tab Deployments.\nCh·ªçn deployment ƒëang di·ªÖn ra (in progress).\nXem chi ti·∫øt qu√° tr√¨nh Deployment.\nAmazon ECS Express Mode s·ª≠ d·ª•ng ECS canary deployment strategy.\nC∆° ch·∫ø n√†y ho·∫°t ƒë·ªông nh∆∞ sau:\nBan ƒë·∫ßu, m·ªôt t·ª∑ l·ªá nh·ªè traffic s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn revision m·ªõi ƒë·ªÉ ki·ªÉm th·ª≠.\nSau khi giai ƒëo·∫°n canary ho√†n t·∫•t th√†nh c√¥ng, to√†n b·ªô traffic c√≤n l·∫°i s·∫Ω ƒë∆∞·ª£c chuy·ªÉn sang revision m·ªõi trong m·ªôt l·∫ßn.\nKi·ªÉm tra ·ª©ng d·ª•ng L·∫•y DNS c·ªßa Application Load Balancer:\nECS_ALB_DNS=$(aws ecs describe-express-gateway-service \\ --service-arn arn:aws:ecs:${AWS_REGION}:${ACCOUNT_ID}:service/retail-store-ecs-cluster/ui-express-mode \\ --query service.activeConfigurations[0].ingressPaths[0].endpoint \\ --output text) echo \u0026#34;https://${ECS_ALB_DNS}\u0026#34; Ti·∫øn h√†nh truy c·∫≠p v√†o ·ª©ng d·ª•ng b·∫±ng DNS:\n"
},
{
	"uri": "http://localhost:1313/vi/2-fundamentals/2.1-ecs_cluster/",
	"title": "Amazon ECS Cluster",
	"tags": [],
	"description": "",
	"content": "Amazon ECS Cluster ECS Cluster l√† m·ªôt m√¥i tr∆∞·ªùng ch·∫°y Container, l√† logical group ƒë·ªÉ qu·∫£n l√Ω t√†i nguy√™n compute.\nB√™n trong ECS Cluster s·∫Ω c√≥ EC2 instances ho·∫∑c Fargate capacity ƒë·ªÉ ch·∫°y container.\nT·∫•t c·∫£ Tasks v√† Services s·∫Ω ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi ECS Cluster.\nCluster KH√îNG ph·∫£i l√† m√°y, n√≥ ch·ªâ l√† v√πng qu·∫£n l√Ω.\nSo s√°nh 2 ki·ªÉu Launch Type trong ECS: ECS on EC2 ECS on Fargate B·∫°n qu·∫£n l√Ω server ‚úî ‚úó Control instance type ‚úî ‚úó Tr·∫£ ti·ªÅn theo instance ‚úî ‚úó Serverless ‚úó ‚úî Ph√π h·ª£p workload l·ªõn, ·ªïn ƒë·ªãnh microservice, startup "
},
{
	"uri": "http://localhost:1313/vi/2-fundamentals/2.2-ecs_service/",
	"title": "Amazon ECS Service",
	"tags": [],
	"description": "",
	"content": "Amazon ECS Service ECS Service l√† m·ªôt c√¥ng c·ª• qu·∫£n l√Ω cho ph√©p b·∫°n ch·∫°y v√† duy tr√¨ m·ªôt s·ªë l∆∞·ª£ng task nh·∫•t ƒë·ªãnh li√™n t·ª•c trong m·ªôt ECS cluster. N√≥ l√† m·ªôt ph·∫ßn thi·∫øt y·∫øu c·ªßa ECS d√†nh cho c√°c ·ª©ng d·ª•ng d√†i h·∫°n, kh√¥ng gi·ªëng nh∆∞ standalone tasks d√πng cho c√°c batch jobs ng·∫Øn h·∫°n.\nN·∫øu m·ªôt trong c√°c task b·ªã l·ªói ho·∫∑c d·ª´ng, ECS Service Scheduler s·∫Ω kh·ªüi ch·∫°y m·ªôt instance kh√°c c·ªßa Task Definition ƒë·ªÉ thay th·∫ø.\nƒêi·ªÅu n√†y gi√∫p duy tr√¨ ƒë√∫ng s·ªë l∆∞·ª£ng task mong mu·ªën (desired number of tasks) cho service.\nNgo√†i ra, ch·ªâ Service m·ªõi c√≥ th·ªÉ ƒë∆∞·ª£c c·∫•u h√¨nh v·ªõi Load Balancer. N·∫øu c·∫ßn ph√¢n ph·ªëi traffic ƒë·∫øn c√°c container, b·∫Øt bu·ªôc ph·∫£i s·ª≠ d·ª•ng Service, kh√¥ng ph·∫£i standalone Task. LB gi√∫p:\nHigh availability Scale Health check Khi n√†o n√™n d√πng Service Scheduler? AWS khuy·∫øn ngh·ªã s·ª≠ d·ª•ng Service Scheduler cho:\nC√°c service ·ª®ng d·ª•ng stateless Workload ch·∫°y d√†i h·∫°n (long-running) Service Scheduler ƒë·∫£m b·∫£o:\nChi·∫øn l∆∞·ª£c scheduling b·∫°n c·∫•u h√¨nh ƒë∆∞·ª£c tu√¢n th·ªß Task ƒë∆∞·ª£c reschedule khi b·ªã l·ªói V√≠ d·ª•: N·∫øu h·∫° t·∫ßng b√™n d∆∞·ªõi g·∫∑p s·ª± c·ªë, Service Scheduler s·∫Ω ch·∫°y l·∫°i task.\nC√°c Th√†nh Ph·∫ßn C·∫•u H√¨nh c·ªßa ECS Service Service Name: T√™n c·ªßa service ƒë·ªÉ nh·∫≠n di·ªán n√≥ trong cluster\nTask Definition: Task Definition n√†o s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ kh·ªüi ch·∫°y tasks. Service s·∫Ω tham chi·∫øu Task Definition n√†y.\nDesired Count: S·ªë l∆∞·ª£ng task m√† b·∫°n mu·ªën Service gi·ªØ ch·∫°y li√™n t·ª•c. N·∫øu b·∫°n ch·ªâ ƒë·ªãnh desired count l√† 3, Service s·∫Ω lu√¥n c·ªë g·∫Øng duy tr√¨ 3 tasks ƒëang ch·∫°y. N·∫øu m·ªôt task b·ªã d·ª´ng, Service s·∫Ω kh·ªüi ch·∫°y task m·ªõi ƒë·ªÉ thay th·∫ø.‚Äã\nScheduling Strategy: C√≥ hai l·ª±a ch·ªçn:\nREPLICA: Service ch·∫°y m·ªôt s·ªë l∆∞·ª£ng mong mu·ªën c·ªßa tasks\nDAEMON: Service ch·∫°y m·ªôt task tr√™n m·ªói container instance trong cluster (kh√¥ng c√≥ desired count)‚Äã\nDeployment Type: C√°ch th·ª©c tri·ªÉn khai c√°c phi√™n b·∫£n m·ªõi:‚Äã\nECS: S·ª≠ d·ª•ng ECS Scheduler (rolling update m·∫∑c ƒë·ªãnh)\nCODE_DEPLOY: S·ª≠ d·ª•ng AWS CodeDeploy (h·ªó tr·ª£ blue-green deployments)\nEXTERNAL: Cho ph√©p tri·ªÉn khai th·ªß c√¥ng qua TaskSets (d√πng v·ªõi CloudFormation, Jenkins, v.v.)\nLoad Balancer Configuration: N·∫øu b·∫°n mu·ªën ph√¢n ph·ªëi traffic:\nLo·∫°i Load Balancer: Application Load Balancer (ALB) ho·∫∑c Network Load Balancer (NLB)\nTarget Group: X√°c ƒë·ªãnh nh·ªØng container n√†o s·∫Ω nh·∫≠n traffic\nPort Mapping: √Ånh x·∫° t·ª´ port load balancer ƒë·∫øn port container\nHealth Check: C·∫•u h√¨nh ki·ªÉm tra s·ª©c kh·ªèe ƒë·ªÉ x√°c ƒë·ªãnh task c√≥ ho·∫°t ƒë·ªông kh√¥ng‚Äã\nV√≤ng ƒê·ªùi c·ªßa ECS Service Service ho·∫°t ƒë·ªông theo chu tr√¨nh sau:\nKh·ªüi t·∫°o: B·∫°n t·∫°o Service v√† ch·ªâ ƒë·ªãnh desired count (v√≠ d·ª•: 3 tasks)\nKh·ªüi ch·∫°y Tasks: Service scheduler kh·ªüi ch·∫°y 3 instances c·ªßa Task Definition\nƒêƒÉng k√Ω v·ªõi Load Balancer: N·∫øu c√≥ load balancer, c√°c tasks ƒë∆∞·ª£c t·ª± ƒë·ªông ƒëƒÉng k√Ω v·ªõi target group\nGi√°m s√°t li√™n t·ª•c: Service li√™n t·ª•c ki·ªÉm tra tr·∫°ng th√°i c·ªßa c√°c tasks\nThay th·∫ø Tasks l·ªói: N·∫øu m·ªôt task g·∫∑p s·ª± c·ªë, Service kh·ªüi ch·∫°y task m·ªõi ƒë·ªÉ duy tr√¨ desired count\nM·ªü r·ªông/Thu nh·ªè: N·∫øu auto scaling ƒë∆∞·ª£c k√≠ch ho·∫°t, desired count s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh d·ª±a tr√™n metrics\nDeployment Configuration cho Rolling Updates Khi b·∫°n tri·ªÉn khai phi√™n b·∫£n m·ªõi c·ªßa ·ª©ng d·ª•ng (c·∫≠p nh·∫≠t Task Definition), ECS s·ª≠ d·ª•ng deployment configuration ƒë·ªÉ ki·ªÉm so√°t qu√° tr√¨nh:\nMinimumHealthyPercent: Ph·∫ßn trƒÉm t·ªëi thi·ªÉu c·ªßa tasks ph·∫£i duy tr√¨ ·ªü tr·∫°ng th√°i RUNNING trong su·ªët qu√° tr√¨nh deployment. V√≠ d·ª•, n·∫øu desired count l√† 4 v√† MinimumHealthyPercent l√† 50%, ECS ƒë·∫£m b·∫£o √≠t nh·∫•t 2 tasks (50% c·ªßa 4) v·∫´n ƒëang ch·∫°y khi tri·ªÉn khai c√°c phi√™n b·∫£n m·ªõi.‚Äã\nMaximumPercent: T·ªïng s·ªë maximum tasks c√≥ th·ªÉ ch·∫°y ƒë·ªìng th·ªùi trong su·ªët qu√° tr√¨nh deployment, t√≠nh d∆∞·ªõi d·∫°ng ph·∫ßn trƒÉm c·ªßa desired count. V√≠ d·ª•, n·∫øu desired count l√† 4 v√† MaximumPercent l√† 200%, ECS cho ph√©p t·ªëi ƒëa 8 tasks ch·∫°y c√πng l√∫c - 4 tasks c≈© + 4 tasks m·ªõi. ƒêi·ªÅu n√†y cho ph√©p tri·ªÉn khai nhanh h∆°n nh∆∞ng y√™u c·∫ßu nhi·ªÅu t√†i nguy√™n h∆°n.‚Äã‚Äã\nV√≠ d·ª• qu√° tr√¨nh deployment:\nB·∫°n c√≥ 4 tasks ƒëang ch·∫°y version v1.\nB·∫°n c·∫≠p nh·∫≠t Task Definition th√†nh version v2.\nMinimumHealthyPercent: 100%\nMaximumPercent: 200%\nECS kh·ªüi ch·∫°y 4 tasks m·ªõi (v2) tr∆∞·ªõc khi d·ª´ng 4 tasks c≈© (v1).\nL√∫c n√†y b·∫°n c√≥ 8 tasks ch·∫°y ƒë·ªìng th·ªùi.\nSau ƒë√≥, ECS d·ª´ng 4 tasks v1 c≈©.\nK·∫øt qu·∫£: 4 tasks v2 ƒëang ch·∫°y.\nService Auto Scaling‚Äã Service Auto Scaling cho ph√©p ECS t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng tasks d·ª±a tr√™n c√°c metrics nh∆∞ CPU, memory, ho·∫∑c custom metrics. C√≥ b·ªën lo·∫°i scaling:\nTarget Tracking Scaling: Duy tr√¨ m·ªôt metric c·ª• th·ªÉ ·ªü m·ª©c target. V√≠ d·ª•, b·∫°n c√≥ th·ªÉ n√≥i \u0026ldquo;duy tr√¨ CPU ·ªü 70%\u0026rdquo;. ECS s·∫Ω t·ª± ƒë·ªông th√™m tasks khi CPU v∆∞·ª£t 70% v√† x√≥a tasks khi CPU d∆∞·ªõi 70%.‚Äã\nStep Scaling: S·ª≠ d·ª•ng CloudWatch alarms v·ªõi c√°c thang b·∫≠c (steps). V√≠ d·ª•, khi CPU \u0026gt; 80%, th√™m 2 tasks; khi CPU \u0026gt; 90%, th√™m 4 tasks.‚Äã\nScheduled Scaling: ƒêi·ªÅu ch·ªânh desired count d·ª±a tr√™n l·ªãch th·ªùi gian. V√≠ d·ª•, m·ªü r·ªông v√†o l√∫c 9 s√°ng khi c√¥ng ty m·ªü c·ª≠a, thu nh·ªè v√†o 6 t·ªëi khi ƒë√≥ng c·ª≠a.‚Äã\nPredictive Scaling: S·ª≠ d·ª•ng machine learning ƒë·ªÉ ph√¢n t√≠ch c√°c pattern l·ªãch s·ª≠ v√† d·ª± b√°o traffic trong t∆∞∆°ng lai.‚Äã\nC∆° Ch·∫ø Duy Tr√¨ Desired Count ƒêi·ªÅu quan tr·ªçng c·∫ßn hi·ªÉu l√† desired count v√† s·ªë tasks th·ª±c t·∫ø ƒëang ch·∫°y c√≥ th·ªÉ kh√°c nhau t·∫°m th·ªùi:\nDesired Count: S·ªë l∆∞·ª£ng tasks m√† b·∫°n mu·ªën Service duy tr√¨. N√≥ l√† m·ªôt gi√° tr·ªã m·ª•c ti√™u m√† ECS c·ªë g·∫Øng ƒë·∫°t ƒë∆∞·ª£c.‚Äã Running Tasks: S·ªë tasks th·ª±c t·∫ø ƒëang ch·∫°y t·∫°i th·ªùi ƒëi·ªÉm hi·ªán t·∫°i. Khi b·∫°n thay ƒë·ªïi desired count, ECS c·∫ßn th·ªùi gian ƒë·ªÉ kh·ªüi ch·∫°y ho·∫∑c d·ª´ng tasks ƒë·ªÉ ph√π h·ª£p v·ªõi desired count m·ªõi.‚Äã V√≠ d·ª•:\nB·∫°n ƒë·∫∑t desired count = 3 Hi·ªán t·∫°i c√≥ 1 task ƒëang ch·∫°y ECS s·∫Ω kh·ªüi ch·∫°y 2 tasks m·ªõi Trong qu√° tr√¨nh kh·ªüi ch·∫°y, running tasks = 1 nh∆∞ng desired count = 3 Sau v√†i gi√¢y, running tasks = 3 (kh·ªõp v·ªõi desired count) Tri·ªÉn Khai So V·ªõi Auto Scaling‚Äã Service Auto Scaling Min/Max l√† d·∫£i cho ph√©p m√† Service Auto Scaling c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh desired count trong n√≥.\nN·∫øu b·∫°n ƒë·∫∑t Min = 2 v√† Max = 10:\nService Auto Scaling s·∫Ω kh√¥ng bao gi·ªù ƒë·ªÉ desired count xu·ªëng d∆∞·ªõi 2\nService Auto Scaling s·∫Ω kh√¥ng bao gi·ªù ƒë·ªÉ desired count v∆∞·ª£t qu√° 10\nDeployment Configuration Min/Max Percent ch·ªâ √°p d·ª•ng trong su·ªët qu√° tr√¨nh deployment (khi c·∫≠p nh·∫≠t Task Definition). N√≥ ki·ªÉm so√°t s·ªë tasks c√≥ th·ªÉ ch·∫°y trong l√∫c tri·ªÉn khai, kh√¥ng li√™n quan ƒë·∫øn auto scaling b√¨nh th∆∞·ªùng.\n"
},
{
	"uri": "http://localhost:1313/vi/2-fundamentals/2.3-ecs_task/",
	"title": "Amazon ECS Task",
	"tags": [],
	"description": "",
	"content": "Amazon ECS Task Task ƒë·∫°i di·ªán cho m·ªôt instance ƒëang ch·∫°y c·ªßa Task Definition trong m·ªôt ECS cluster. Task l√† k·∫øt qu·∫£ khi ta kh·ªüi ch·∫°y m·ªôt Task Definition t·∫°i m·ªôt th·ªùi ƒëi·ªÉm c·ª• th·ªÉ trong m·ªôt cluster. N·∫øu ta ch·ªâ ƒë·ªãnh ch·∫°y 3 task t·ª´ m·ªôt Task Definition, AWS ECS s·∫Ω kh·ªüi ch·∫°y 3 instance ri√™ng bi·ªát c·ªßa Task Definition ƒë√≥.\nV√≤ng ƒê·ªùi Task (Task Lifecycle) Khi m·ªôt task ƒë∆∞·ª£c kh·ªüi ch·∫°y (ho·∫∑c nh∆∞ m·ªôt ph·∫ßn c·ªßa service, ho·∫∑c nh∆∞ m·ªôt standalone task), n√≥ s·∫Ω tr·∫£i qua nhi·ªÅu tr·∫°ng th√°i kh√°c nhau:\nPROVISIONING ‚Üí PENDING ‚Üí ACTIVATING ‚Üí RUNNING ‚Üí DEACTIVATING ‚Üí STOPPING ‚Üí DEPROVISIONING ‚Üí STOPPED\rM·ªói tr·∫°ng th√°i c√≥ √Ω nghƒ©a:\nPROVISIONING: ECS ƒëang c·∫•p ph√°t c√°c t√†i nguy√™n c·∫ßn thi·∫øt (ch·ªâ v·ªõi Fargate).\nPENDING: Task ƒëang ch·ªù ƒë·ªÉ c√°c t√†i nguy√™n (CPU, b·ªô nh·ªõ) ƒë∆∞·ª£c ph√¢n b·ªï t·ª´ cluster.\nACTIVATING: Container ƒëang kh·ªüi ch·∫°y v√† c√°c health check ƒëang di·ªÖn ra.\nRUNNING: Container ƒëang ch·∫°y b√¨nh th∆∞·ªùng.\nDEACTIVATING: Task ƒëang chu·∫©n b·ªã d·ª´ng.\nSTOPPING: Task ƒëang ƒë∆∞·ª£c d·ª´ng.\nDEPROVISIONING: T√†i nguy√™n ƒëang ƒë∆∞·ª£c gi·∫£i ph√≥ng (ch·ªâ v·ªõi Fargate).\nSTOPPED: Task ƒë√£ d·ª´ng ho√†n to√†n.\nECS theo d√µi hai tr·∫°ng th√°i kh√°c nhau:\nlastStatus: Tr·∫°ng th√°i th·ª±c t·∫ø hi·ªán t·∫°i c·ªßa task.\ndesiredStatus: Tr·∫°ng th√°i m·ª•c ti√™u m√† ta mu·ªën task ƒë·∫°t ƒë∆∞·ª£c.\nV√≠ d·ª•, n·∫øu ta y√™u c·∫ßu d·ª´ng m·ªôt task, lastStatus c√≥ th·ªÉ l√† RUNNING c√≤n desiredStatus s·∫Ω l√† STOPPED.\nTask Execution Role vs Task Role C√≥ hai lo·∫°i IAM roles trong ECS task:\nTask Execution Role: l√† vai tr√≤ ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi ECS Container Agent (kh√¥ng ph·∫£i container application). N√≥ c·∫•p quy·ªÅn cho ECS agent th·ª±c hi·ªán c√°c h√†nh ƒë·ªông nh∆∞:\nK√©o (pull) Docker images t·ª´ Amazon ECR Truy c·∫≠p Secrets Manager ho·∫∑c Parameter Store ƒë·ªÉ l·∫•y c·∫•u h√¨nh G·ª≠i logs ƒë·∫øn CloudWatch Logs K√©o t·ªáp t·ª´ S3 ƒë·ªÉ kh·ªüi ch·∫°y Task Role: l√† vai tr√≤ ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi ·ª©ng d·ª•ng b√™n trong container. N√≥ cho ph√©p ·ª©ng d·ª•ng g·ªçi c√°c d·ªãch v·ª• AWS kh√°c nh∆∞:\nS3 (ƒë·ªÉ ƒë·ªçc/ghi files) DynamoDB (ƒë·ªÉ truy c·∫≠p c∆° s·ªü d·ªØ li·ªáu) SNS/SQS (ƒë·ªÉ g·ª≠i messages) RDS (ƒë·ªÉ truy c·∫≠p database) C√°ch ECS ƒê·∫∑t (Placement) Tasks Tr√™n Container Instances Khi ta ch·∫°y m·ªôt task tr√™n EC2-based cluster, ECS ph·∫£i quy·∫øt ƒë·ªãnh n√≥ s·∫Ω ch·∫°y tr√™n instance n√†o. Qu√° tr√¨nh n√†y ƒë∆∞·ª£c g·ªçi l√† task placement, v√† n√≥ c√≥ th·ªÉ ƒë∆∞·ª£c ki·ªÉm so√°t b·∫±ng Placement Strategies v√† Placement Constraints.\nPlacement Strategies:\nspread: Ph√¢n t√°n tasks tr√™n nhi·ªÅu instances d·ª±a tr√™n m·ªôt thu·ªôc t√≠nh (v√≠ d·ª•: ecs.availability-zone, ecs.instance-type). T·ªët cho high availability\nbinpack: ƒê√≥ng g√≥i tasks v√†o √≠t instances nh·∫•t c√≥ th·ªÉ ƒë·ªÉ ti·∫øt ki·ªám chi ph√≠\nrandom: ƒê·∫∑t tasks ng·∫´u nhi√™n (√≠t ƒë∆∞·ª£c s·ª≠ d·ª•ng)\nPlacement Constraints:\ndistinctInstance: ƒê·∫£m b·∫£o m·ªói task ch·∫°y tr√™n m·ªôt instance kh√°c nhau\nmemberOf: Ch·ªâ ƒë·∫∑t tasks tr√™n c√°c instances c√≥ thu·ªôc t√≠nh/tag c·ª• th·ªÉ\nTasks - Standalone vs Service Standalone Task: D√πng cho c√°c job ng·∫Øn h·∫°n (batch jobs, one-off tasks). Task s·∫Ω ch·∫°y ƒë·∫øn khi ho√†n th√†nh ho·∫∑c g·∫∑p l·ªói, r·ªìi d·ª´ng l·∫°i. Kh√¥ng c√≥ c∆° ch·∫ø t·ª± ƒë·ªông restart.\nService Task: D√πng cho c√°c ·ª©ng d·ª•ng d√†i h·∫°n. Service scheduler t·ª± ƒë·ªông duy tr√¨ s·ªë l∆∞·ª£ng desired tasks b·∫±ng c√°ch kh·ªüi ch·∫°y l·∫°i b·∫•t k·ª≥ task n√†o b·ªã d·ª´ng.\n"
},
{
	"uri": "http://localhost:1313/vi/2-fundamentals/2.4-ecs_task_definition/",
	"title": "Amazon ECS Task Definition",
	"tags": [],
	"description": "",
	"content": "Amazon ECS Task Definition Task Definition l√† m·ªôt b·∫£n thi·∫øt k·∫ø (blueprint) JSON m√¥ t·∫£ c√°ch m·ªôt ho·∫∑c nhi·ªÅu Docker containers s·∫Ω ch·∫°y trong AWS ECS. N√≥ gi·ªëng nh∆∞ m·ªôt c√¥ng th·ª©c ho·∫∑c template ch·ª©a t·∫•t c·∫£ c√°c c·∫•u h√¨nh c·∫ßn thi·∫øt ƒë·ªÉ kh·ªüi ch·∫°y containers, bao g·ªìm Docker image, CPU, memory, port mappings, environment variables, logging, v√† nhi·ªÅu h∆°n n·ªØa.\nC√°c Th√†nh Ph·∫ßn Ch√≠nh C·ªßa Task Definition Task Definition chia th√†nh hai m·ª©c ƒë·ªô c·∫•u h√¨nh: Task-level parameters (c·∫•p ƒë·ªô task) v√† Container definitions (c·∫•p ƒë·ªô container).\nTask-Level Parameters (C·∫•p ƒê·ªô Task)\nFamily: T√™n c·ªßa Task Definition family. ƒê√¢y l√† t√™n s·∫Ω s·ª≠ d·ª•ng ƒë·ªÉ nh·∫≠n di·ªán task definition. V√≠ d·ª•: \u0026ldquo;my-web-app\u0026rdquo;, \u0026ldquo;data-processor\u0026rdquo;. Khi c·∫≠p nh·∫≠t task definition, m·ªôt revision m·ªõi ƒë∆∞·ª£c t·∫°o nh∆∞ng family name v·∫´n gi·ªØ nguy√™n.‚Äã\nTask Size (CPU \u0026amp; Memory): T·ªïng l∆∞·ª£ng CPU v√† memory ƒë∆∞·ª£c c·∫•p ph√°t cho to√†n b·ªô task. ƒêi·ªÅu n√†y kh√°c bi·ªát v·ªõi CPU/memory ·ªü m·ª©c container. V·ªõi Fargate, c√°c gi√° tr·ªã n√†y l√† b·∫Øt bu·ªôc v√† ph·∫£i l√† nh·ªØng gi√° tr·ªã h·ªó tr·ª£ c·ª• th·ªÉ (v√≠ d·ª•: 0.25 vCPU v·ªõi 0.5GB-1GB memory). V·ªõi EC2, c√°c gi√° tr·ªã n√†y l√† t√πy ch·ªçn.‚Äã\nNetwork Mode: C√°ch containers s·∫Ω k·∫øt n·ªëi v·ªõi network:‚Äã\nawsvpc: M·ªói task nh·∫≠n m·ªôt Elastic Network Interface (ENI) ri√™ng v·ªõi IP address ri√™ng t·ª´ VPC. ƒêi·ªÅu n√†y cho ph√©p task ho·∫°t ƒë·ªông nh∆∞ m·ªôt EC2 instance trong VPC. ƒê√¢y l√† mode duy nh·∫•t ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi Fargate v√† khuy·∫øn ngh·ªã cho EC2.‚Äã\nbridge: Containers k·∫øt n·ªëi qua Docker bridge network. C√°c containers tr√™n c√πng host c√≥ th·ªÉ giao ti·∫øp v·ªõi nhau. Port mapping ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ expose ports.‚Äã\nhost: Containers chia s·∫ª network namespace v·ªõi host. Container ports ƒë∆∞·ª£c map tr·ª±c ti·∫øp v·ªõi host ports. Kh√¥ng khuy·∫øn ngh·ªã v√¨ n√≥ gi·∫£m isolation.\nnone: Containers kh√¥ng c√≥ network connectivity.‚Äã\nLaunch Type: N∆°i task s·∫Ω ch·∫°y:\nEC2: Task ch·∫°y tr√™n EC2 instances ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi b·∫°n.\nFargate: AWS qu·∫£n l√Ω infrastructure, ch·ªâ c·∫ßn ƒë·ªãnh nghƒ©a requirements\nExecution Role (Task Execution Role ARN): IAM role cho ECS Container Agent. Role n√†y cho ph√©p agent k√©o Docker images t·ª´ ECR, ƒë·∫©y logs ƒë·∫øn CloudWatch, l·∫•y secrets t·ª´ Secrets Manager.‚Äã\nTask Role: IAM role cho ·ª©ng d·ª•ng b√™n trong container. Role n√†y c·∫•p quy·ªÅn cho code truy c·∫≠p c√°c d·ªãch v·ª• AWS nh∆∞ S3, DynamoDB, SNS, v.v.‚Äã\nPlatform: Lo·∫°i CPU architecture (x86_64 ho·∫∑c ARM64). V·ªõi ARM64, c√≥ th·ªÉ s·ª≠ d·ª•ng AWS Graviton processors ti·∫øt ki·ªám chi ph√≠ h∆°n.‚Äã\nContainer Definitions (C·∫•p ƒê·ªô Container)\nTask Definition c√≥ th·ªÉ ch·ª©a m·ªôt ho·∫∑c nhi·ªÅu container definitions. M·ªói container definition m√¥ t·∫£ m·ªôt container ri√™ng bi·ªát s·∫Ω ch·∫°y nh∆∞ m·ªôt ph·∫ßn c·ªßa task.\nName: T√™n c·ªßa container (v√≠ d·ª•: web-server, database-client). B·∫Øt bu·ªôc ph·∫£i c√≥.‚Äã\nImage: Docker image URI ƒë·ªÉ s·ª≠ d·ª•ng. C√≥ th·ªÉ l√† t·ª´ Docker Hub (v√≠ d·ª•: nginx:latest) ho·∫∑c t·ª´ Amazon ECR (v√≠ d·ª•: 123456789012.dkr.ecr.us-east-1.amazonaws.com/my-app:1.0.0). B·∫Øt bu·ªôc ph·∫£i c√≥.‚Äã\nCPU: S·ªë CPU units ƒë∆∞·ª£c c·∫•p ph√°t cho container n√†y. 1 vCPU = 1024 CPU units. N·∫øu c√≥ task size l√† 1 vCPU v√† 2 containers, c√≥ th·ªÉ c·∫•p ph√°t 512 units cho m·ªói container. N·∫øu ƒë·ªÉ 0, container s·∫Ω s·ª≠ d·ª•ng CPU units c√≤n l·∫°i kh√¥ng ƒë∆∞·ª£c c·∫•p ph√°t cho containers kh√°c.‚Äã\nMemory: B·ªô nh·ªõ t√≠nh b·∫±ng MB. N√≥ c√≥ th·ªÉ l√†:\nhard limit (memory): Memory t·ªëi ƒëa m√† container c√≥ th·ªÉ s·ª≠ d·ª•ng. N·∫øu v∆∞·ª£t qu√°, container b·ªã d·ª´ng.\nsoft limit (memoryReservation): Memory ƒë∆∞·ª£c ƒë·∫£m b·∫£o s·∫µn s√†ng cho container.‚Äã\nV√≠ d·ª•: containerPort 8080 ‚Üí hostPort 0 c√≥ nghƒ©a container ch·∫°y tr√™n port 8080, nh∆∞ng expose qua dynamic port mapping tr√™n host.‚Äã\nEssential: Boolean flag. N·∫øu true, n·∫øu container n√†y g·∫∑p s·ª± c·ªë, c·∫£ task s·∫Ω b·ªã d·ª´ng. √çt nh·∫•t m·ªôt container ph·∫£i c√≥ essential=true. N·∫øu false, task s·∫Ω ti·∫øp t·ª•c ch·∫°y ngay c·∫£ khi container n√†y d·ª´ng.‚Äã\nEnvironment Variables: C√°c bi·∫øn m√¥i tr∆∞·ªùng ƒë∆∞·ª£c truy·ªÅn v√†o container. V√≠ d·ª•: SERVER_PORT=8080, DATABASE_HOST=db.example.com.‚Äã\nLogging Configuration: C√°ch logs s·∫Ω ƒë∆∞·ª£c ghi. C√°c t√πy ch·ªçn bao g·ªìm:\nawslogs: Logs ƒë·∫©y ƒë·∫øn AWS CloudWatch\nsplunk: Logs ƒë·∫©y ƒë·∫øn Splunk\ndatadog: Logs ƒë·∫©y ƒë·∫øn Datadog\nawsfirelens: S·ª≠ d·ª•ng Fluent Bit ho·∫∑c Fluentd\nV√≠ d·ª• c·∫•u h√¨nh CloudWatch:\n\u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;awslogs\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;awslogs-group\u0026#34;: \u0026#34;/ecs/my-task\u0026#34;, \u0026#34;awslogs-region\u0026#34;: \u0026#34;us-east-1\u0026#34;, \u0026#34;awslogs-stream-prefix\u0026#34;: \u0026#34;ecs\u0026#34; } } Mount Points: √Ånh x·∫° volumes v√†o container. G·ªìm:\nsourceVolume: T√™n c·ªßa volume ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ·ªü task-level\ncontainerPath: ƒê∆∞·ªùng d·∫´n b√™n trong container n∆°i volume ƒë∆∞·ª£c mount (v√≠ d·ª•: /data)\nreadOnly: C√≥ l√† read-only kh√¥ng‚Äã\nHealth Check: C·∫•u h√¨nh ki·ªÉm tra s·ª©c kh·ªèe c·ªßa container:\n\u0026#34;healthCheck\u0026#34;: { \u0026#34;command\u0026#34;: [\u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -f http://localhost:8080/health || exit 1\u0026#34;], \u0026#34;interval\u0026#34;: 30, \u0026#34;timeout\u0026#34;: 5, \u0026#34;retries\u0026#34;: 3, \u0026#34;startPeriod\u0026#34;: 0 } Volumes (L∆∞u Tr·ªØ D·ªØ Li·ªáu)‚Äã\nVolumes: Volumes ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ·ªü task-level nh∆∞ng ƒë∆∞·ª£c mount v√†o containers th√¥ng qua mount points. C√°c lo·∫°i volumes bao g·ªìm:\nEBS Volumes: Amazon Elastic Block Store volumes cho persistent storage (ch·ªâ EC2)\nEFS Volumes: Amazon Elastic File System cho shared persistent storage gi·ªØa nhi·ªÅu tasks/instances\nFSx Volumes: FSx for Windows File Server volumes\nBind Mounts: Mount m·ªôt ƒë∆∞·ªùng d·∫´n t·ª´ host EC2 instance v√†o container\nDocker Volumes: Docker-managed volumes\nV√≠ d·ª• ƒë·ªãnh nghƒ©a volume:\n\u0026#34;volumes\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;my-efs\u0026#34;, \u0026#34;efsVolumeConfiguration\u0026#34;: { \u0026#34;fileSystemId\u0026#34;: \u0026#34;fs-1234567\u0026#34;, \u0026#34;transitEncryption\u0026#34;: \u0026#34;ENABLED\u0026#34; } }, { \u0026#34;name\u0026#34;: \u0026#34;my-bind-volume\u0026#34;, \u0026#34;host\u0026#34;: { \u0026#34;sourcePath\u0026#34;: \u0026#34;/mnt/data\u0026#34; } } ] Versioning v√† Revisions‚Äã\nTask Definitions l√† b·∫•t bi·∫øn (immutable). ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n kh√¥ng th·ªÉ ch·ªânh s·ª≠a m·ªôt task definition hi·ªán c√≥. Thay v√†o ƒë√≥, b·∫°n ph·∫£i t·∫°o m·ªôt revision m·ªõi.‚Äã\nRevision l√† m·ªôt b·∫£n sao c·ªßa task definition hi·ªán t·∫°i v·ªõi nh·ªØng thay ƒë·ªïi ƒë∆∞·ª£c √°p d·ª•ng. M·ªói task definition family c√≥ th·ªÉ c√≥ nhi·ªÅu revisions:\nmy-app:1 (revision 1).\nmy-app:2 (revision 2).\nmy-app:3 (revision 3).\nKhi c·∫≠p nh·∫≠t m·ªôt service ho·∫∑c ch·∫°y m·ªôt task, ch·ªâ ƒë·ªãnh family:revision ƒë·ªÉ s·ª≠ d·ª•ng (v√≠ d·ª•: \u0026ldquo;my-app:3\u0026rdquo;). ƒêi·ªÅu n√†y cho ph√©p d·ªÖ d√†ng rollback ƒë·∫øn revision c≈© n·∫øu c√≥ v·∫•n ƒë·ªÅ b·∫±ng c√°ch ch·ªâ c·∫≠p nh·∫≠t service ƒë·ªÉ s·ª≠ d·ª•ng revision tr∆∞·ªõc ƒë√≥.‚Äã\n∆Øu ƒëi·ªÉm c·ªßa ki·∫øn tr√∫c n√†y:\nAudit trail: C√≥ th·ªÉ xem t·∫•t c·∫£ c√°c thay ƒë·ªïi ƒë√£ ƒë∆∞·ª£c th·ª±c hi·ªán.\nEasy rollback: Quay l·∫°i revision c≈© n·∫øu c·∫ßn.\nVersion control: Gi·ªëng nh∆∞ version control cho infrastructure.\nTask Definition JSON\n{ \u0026#34;family\u0026#34;: \u0026#34;my-web-app\u0026#34;, \u0026#34;cpu\u0026#34;: \u0026#34;256\u0026#34;, \u0026#34;memory\u0026#34;: \u0026#34;512\u0026#34;, \u0026#34;networkMode\u0026#34;: \u0026#34;awsvpc\u0026#34;, \u0026#34;requiresCompatibilities\u0026#34;: [\u0026#34;FARGATE\u0026#34;], \u0026#34;executionRoleArn\u0026#34;: \u0026#34;arn:aws:iam::123456789012:role/ecsTaskExecutionRole\u0026#34;, \u0026#34;taskRoleArn\u0026#34;: \u0026#34;arn:aws:iam::123456789012:role/ecsTaskRole\u0026#34;, \u0026#34;containerDefinitions\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;web-server\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;123456789012.dkr.ecr.us-east-1.amazonaws.com/my-app:1.0.0\u0026#34;, \u0026#34;cpu\u0026#34;: 256, \u0026#34;memory\u0026#34;: 512, \u0026#34;essential\u0026#34;: true, \u0026#34;portMappings\u0026#34;: [ { \u0026#34;containerPort\u0026#34;: 8080, \u0026#34;hostPort\u0026#34;: 8080, \u0026#34;protocol\u0026#34;: \u0026#34;tcp\u0026#34; } ], \u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;awslogs\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;awslogs-group\u0026#34;: \u0026#34;/ecs/my-web-app\u0026#34;, \u0026#34;awslogs-region\u0026#34;: \u0026#34;us-east-1\u0026#34;, \u0026#34;awslogs-stream-prefix\u0026#34;: \u0026#34;ecs\u0026#34; } }, \u0026#34;environment\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;ENVIRONMENT\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;production\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;DATABASE_HOST\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;db.example.com\u0026#34; } ] } ] } "
},
{
	"uri": "http://localhost:1313/vi/2-fundamentals/",
	"title": "C√°c kh√°i ni·ªám c∆° b·∫£n",
	"tags": [],
	"description": "",
	"content": "Amazon ECS Core Components Amazon ECS c√≥ 4 th√†nh ph·∫ßn ch√≠nh:\nCluster: L√† kh√¥ng gian qu·∫£n l√Ω trung t√¢m trong Amazon ECS, n∆°i t·ªï ch·ª©c v√† v·∫≠n h√†nh to√†n b·ªô service v√† task c·ªßa ·ª©ng d·ª•ng.\nService: ƒê·∫°i di·ªán cho m·ªôt nh√≥m c√°c task gi·ªëng h·ªát nhau, c√≥ nhi·ªám v·ª• duy tr√¨ s·ªë l∆∞·ª£ng task lu√¥n ch·∫°y ƒë√∫ng nh∆∞ mong mu·ªën, ƒë·ªìng th·ªùi h·ªó tr·ª£ t·ª± ƒë·ªông kh·ªüi ƒë·ªông l·∫°i ho·∫∑c m·ªü r·ªông khi c·∫ßn.\nTask: L√† ƒë∆°n v·ªã th·ª±c thi trong ECS, bao g·ªìm m·ªôt ho·∫∑c nhi·ªÅu container ph·ªëi h·ª£p v·ªõi nhau ƒë·ªÉ th·ª±c hi·ªán m·ªôt ch·ª©c nƒÉng c·ª• th·ªÉ c·ªßa ·ª©ng d·ª•ng.\nTask Definition: L√† b·∫£n m√¥ t·∫£ chi ti·∫øt c√°ch m·ªôt task ƒë∆∞·ª£c ch·∫°y, bao g·ªìm c√°c th√¥ng tin nh∆∞ CPU, b·ªô nh·ªõ, container image, c·∫•u h√¨nh m·∫°ng, IAM role, v√† c√°c thi·∫øt l·∫≠p c·∫ßn thi·∫øt kh√°c.\nVi·ªác hi·ªÉu r√µ c√°c th√†nh ph·∫ßn n√†y l√† r·∫•t quan tr·ªçng ƒë·ªÉ s·ª≠ d·ª•ng Amazon ECS m·ªôt c√°ch hi·ªáu qu·∫£ trong vi·ªác qu·∫£n l√Ω c√°c ·ª©ng d·ª•ng container. M·ªói th√†nh ph·∫ßn ƒë·ªÅu ƒë√≥ng vai tr√≤ then ch·ªët trong ki·∫øn tr√∫c t·ªïng th·ªÉ v√† c√°ch v·∫≠n h√†nh c·ªßa c√°c ECS deployment.\nLayers C√≥ 3 Layers trong ECS:\nCapacity: Infrastructure n∆°i Container ch·∫°y.\nController: Deploy v√† qu·∫£n l√Ω ·ª©ng d·ª•ng ch·∫°y tr√™n Container.\nProvisioning: C√¥ng c·ª• ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi scheduler ƒë·ªÉ deploy v√† qu·∫£n l√Ω ·ª©ng d·ª•ng v√† container.\nCapacity Capacity (nƒÉng l·ª±c t√≠nh to√°n) l√† h·∫° t·∫ßng n∆°i c√°c container c·ªßa ch·∫°y. D∆∞·ªõi ƒë√¢y l√† t·ªïng quan v·ªÅ c√°c t√πy ch·ªçn capacity:\nAmazon ECS Managed Instances Amazon ECS Managed Instances l√† m·ªôt t√πy ch·ªçn compute cho Amazon ECS, cho ph√©p ch·∫°y c√°c workload container h√≥a tr√™n nhi·ªÅu lo·∫°i Amazon EC2 instance, ƒë·ªìng th·ªùi chuy·ªÉn ph·∫ßn l·ªõn vi·ªác qu·∫£n l√Ω h·∫° t·∫ßng cho AWS.\nV·ªõi Amazon ECS Managed Instances, c√≥ th·ªÉ:\nGPU acceleration. Ki·∫øn tr√∫c CPU c·ª• th·ªÉ. Hi·ªáu nƒÉng m·∫°ng cao. C√°c lo·∫°i instance chuy√™n d·ª•ng. Trong khi ƒë√≥, AWS s·∫Ω ch·ªãu tr√°ch nhi·ªám:\nC·∫•p ph√°t h·∫° t·∫ßng. V√° l·ªói h·ªá ƒëi·ªÅu h√†nh. Scale. B·∫£o tr√¨ v√† v·∫≠n h√†nh h·∫° t·∫ßng b√™n d∆∞·ªõi. Amazon EC2 Instances C√≥ th·ªÉ t·ª± ch·ªçn lo·∫°i Instance, s·ªë l∆∞·ª£ng Instance. T·ª± qu·∫£n l√Ω Capacity (Auto Scaling, patching, lifecycle, etc.). Serverless AWS Fargate l√† m·ªôt compute engine serverless, tr·∫£ ti·ªÅn theo m·ª©c s·ª≠ d·ª•ng. V·ªõi Fargate: Kh√¥ng c·∫ßn qu·∫£n l√Ω server. Kh√¥ng c·∫ßn l·∫≠p k·∫ø ho·∫°ch capacity. Kh√¥ng c·∫ßn t·ª± c√°ch ly workload container v√¨ AWS ƒë√£ x·ª≠ l√Ω v·∫•n ƒë·ªÅ b·∫£o m·∫≠t. Server/VM On-Premises Amazon ECS Anywhere ƒëƒÉng k√Ω c√°c instance b√™n ngo√†i (on-premises server ho·∫∑c VM). K·∫øt n·ªëi ch√∫ng v√†o ECS cluster. Amazon ECS Scheduler Amazon ECS Scheduler l√† ph·∫ßn m·ªÅm ch·ªãu tr√°ch nhi·ªám qu·∫£n l√Ω v√† ƒëi·ªÅu ph·ªëi ·ª©ng d·ª•ng c·ªßa b·∫°n, bao g·ªìm: Quy·∫øt ƒë·ªãnh task ch·∫°y ·ªü ƒë√¢u. Qu·∫£n l√Ω v√≤ng ƒë·ªùi task. ƒê·∫£m b·∫£o desired state c·ªßa service. "
},
{
	"uri": "http://localhost:1313/vi/7-networking/7.2-service-connect/",
	"title": "ECS Service Connect",
	"tags": [],
	"description": "",
	"content": "ECS Service Connect l√† ph∆∞∆°ng ph√°p ƒë∆∞·ª£c khuy·∫øn ngh·ªã ƒë·ªÉ x·ª≠ l√Ω vi·ªác giao ti·∫øp gi·ªØa c√°c service (service-to-service communication), cung c·∫•p c√°c t√≠nh nƒÉng nh∆∞ service discovery, connectivity v√† traffic monitoring.\nV·ªõi Service Connect, c√°c ·ª©ng d·ª•ng c·ªßa b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng short names v√† standard ports ƒë·ªÉ k·∫øt n·ªëi t·ªõi c√°c ECS services trong c√πng m·ªôt cluster, kh√°c cluster, kh√°c VPC, v√† th·∫≠m ch√≠ gi·ªØa c√°c AWS Accounts trong c√πng m·ªôt AWS Region. ƒê·ªÉ bi·∫øt th√™m th√¥ng tin chi ti·∫øt, h√£y tham kh·∫£o AWS Documentation.\nC√°c l·ª±a ch·ªçn thay th·∫ø ƒë·ªÉ c·∫•u h√¨nh inter-service communication trong Amazon ECS Services bao g·ªìm:\nInternal Load Balancer\nService Discovery\nAmazon VPC Lattice\n"
},
{
	"uri": "http://localhost:1313/vi/3-prepare/3.2-cluster-task_definitions/",
	"title": "T·∫°o Cluster &amp; Task Definition",
	"tags": [],
	"description": "",
	"content": "T·∫°o Cluster Ti·∫øn h√†nh t·∫°o Amazon ECS Cluster c√≥ t√™n retail-store-ecs-cluster v·ªõi CloudWatch Container Insights.\nContainer Insight thu th·∫≠p, t·ªïng h·ª£p v√† t√≥m t·∫Øt c√°c ch·ªâ s·ªë (metrics) v√† nh·∫≠t k√Ω (logs) t·ª´ c√°c ·ª©ng d·ª•ng Container.\naws ecs create-cluster --cluster-name retail-store-ecs-cluster --capacity-providers FARGATE FARGATE_SPOT --default-capacity-provider-strategy capacityProvider=FARGATE,weight=1 --settings name=containerInsights,value=enhanced Sau khi ch·∫°y l·ªánh s·∫Ω ƒë∆∞·ª£c k·∫øt qu·∫£ sau v√† c√≥ th·ªÉ th·∫•y CloudWatch Container Insights ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh th√†nh c√¥ng.\n{ \u0026#34;cluster\u0026#34;: { \u0026#34;clusterArn\u0026#34;: \u0026#34;arn:aws:ecs:ap-northeast-2:111111111111:cluster/retail-store-ecs-cluster\u0026#34;, \u0026#34;clusterName\u0026#34;: \u0026#34;retail-store-ecs-cluster\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;ACTIVE\u0026#34;, \u0026#34;registeredContainerInstancesCount\u0026#34;: 0, \u0026#34;runningTasksCount\u0026#34;: 0, \u0026#34;pendingTasksCount\u0026#34;: 0, \u0026#34;activeServicesCount\u0026#34;: 0, \u0026#34;statistics\u0026#34;: [], \u0026#34;tags\u0026#34;: [], \u0026#34;settings\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;containerInsights\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;enhanced\u0026#34; } ], \u0026#34;capacityProviders\u0026#34;: [], \u0026#34;defaultCapacityProviderStrategy\u0026#34;: [] } } Ki·ªÉm tra tr√™n AWS Console ƒë·ªÉ x√°c nh·∫≠n cluster ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nT·∫°o Role T·∫°o hai IAM Role c·∫ßn thi·∫øt cho ECS Task:\nretailStoreEcsTaskExecutionRole: cho ph√©p ECS pull image, ghi log, truy c·∫≠p secrets.\nretailStoreEcsTaskRole: c·∫•p quy·ªÅn cho ·ª©ng d·ª•ng b√™n trong container.\naws iam create-role --role-name retailStoreEcsTaskExecutionRole --assume-role-policy-document file://ecs-task-trust.json N·ªôi dung file ecs-task-trust.json:\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;ecs-tasks.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34; } ] } G√°n quy·ªÅn cho retailStoreEcsTaskExecutionRole:\naws iam attach-role-policy --role-name retailStoreEcsTaskExecutionRole --policy-arn arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy T·∫°o retailStoreEcsTaskRole:\naws iam create-role --role-name retailStoreEcsTaskRole --assume-role-policy-document file://ecs-task-trust.json T·∫°o Task Definition T·∫°o Task Definition v·ªõi t√™n retail-store-ecs-ui ƒë∆∞·ª£c s·ª≠ d·ª•ng cho UI Service v√† c·∫•u h√¨nh nh∆∞ sau:\n{ \u0026#34;family\u0026#34;: \u0026#34;retail-store-ecs-ui\u0026#34;, \u0026#34;networkMode\u0026#34;: \u0026#34;awsvpc\u0026#34;, \u0026#34;requiresCompatibilities\u0026#34;: [ \u0026#34;FARGATE\u0026#34; ], \u0026#34;cpu\u0026#34;: \u0026#34;1024\u0026#34;, \u0026#34;memory\u0026#34;: \u0026#34;2048\u0026#34;, \u0026#34;runtimePlatform\u0026#34;: { \u0026#34;cpuArchitecture\u0026#34;: \u0026#34;X86_64\u0026#34;, \u0026#34;operatingSystemFamily\u0026#34;: \u0026#34;LINUX\u0026#34; }, \u0026#34;containerDefinitions\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/aws-containers/retail-store-sample-ui:1.2.3\u0026#34;, \u0026#34;portMappings\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;containerPort\u0026#34;: 8080, \u0026#34;hostPort\u0026#34;: 8080, \u0026#34;protocol\u0026#34;: \u0026#34;tcp\u0026#34;, \u0026#34;appProtocol\u0026#34;: \u0026#34;http\u0026#34; } ], \u0026#34;essential\u0026#34;: true, \u0026#34;linuxParameters\u0026#34;: { \u0026#34;initProcessEnabled\u0026#34;: true }, \u0026#34;healthCheck\u0026#34;: { \u0026#34;command\u0026#34;: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -f http://localhost:8080/actuator/health || exit 1\u0026#34; ], \u0026#34;interval\u0026#34;: 10, \u0026#34;timeout\u0026#34;: 5, \u0026#34;retries\u0026#34;: 3, \u0026#34;startPeriod\u0026#34;: 60 }, \u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;awslogs\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;awslogs-group\u0026#34;: \u0026#34;retail-store-ecs-tasks\u0026#34;, \u0026#34;awslogs-region\u0026#34;: \u0026#34;$AWS_REGION\u0026#34;, \u0026#34;awslogs-stream-prefix\u0026#34;: \u0026#34;ui-service\u0026#34; } } } ], \u0026#34;executionRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskExecutionRole\u0026#34;, \u0026#34;taskRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskRole\u0026#34; } Ch√∫ √Ω ACCOUNT_ID l√† ID c·ªßa t√†i kho·∫£n AWS, AWS_REGION l√† region c·ªßa b·∫°n.\nT·∫°o file json v·ªõi n·ªôi dung nh∆∞ tr√™n v√† ƒë·∫∑t t√™n file l√† retail-store-ecs-ui-taskdef.json.\nCh·∫°y l·ªánh sau ƒë·ªÉ t·∫°o Task Definition.\naws ecs register-task-definition --cli-input-json file://retail-store-ecs-ui-taskdef.json Ki·ªÉm tra tr√™n AWS Console ƒë·ªÉ x√°c nh·∫≠n Task Definition ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nC√≥ th·ªÉ truy xu·∫•t Task Definition ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng b·∫±ng c√°ch ch·∫°y l·ªánh sau:\naws ecs describe-task-definition --task-definition retail-store-ecs-ui "
},
{
	"uri": "http://localhost:1313/vi/6-auto-scaling/6.2-target_tracking_scaling/",
	"title": "Target Tracking Scaling",
	"tags": [],
	"description": "",
	"content": "Register Scalable Target Trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω c·∫•u h√¨nh ECS Service Auto Scaling b·∫±ng c√°ch s·ª≠ d·ª•ng Target Tracking Scaling.\nTr∆∞·ªõc ti√™n, Register UI service nh∆∞ m·ªôt scalable target v·ªõi Application Auto Scaling. L·ªánh sau thi·∫øt l·∫≠p scaling range cho UI Service t·ª´ minimum 2 ƒë·∫øn maximum 10 tasks.\nL·ªánh register-scalable-target d√πng ƒë·ªÉ cho ph√©p ECS Service ƒë∆∞·ª£c auto scale v√† gi·ªõi h·∫°n ph·∫°m vi scale (min/max task); n·∫øu kh√¥ng c√≥ b∆∞·ªõc n√†y th√¨ m·ªçi scaling policy ƒë·ªÅu v√¥ hi·ªáu.\naws application-autoscaling register-scalable-target \\ --service-namespace ecs \\ --scalable-dimension ecs:service:DesiredCount \\ --resource-id service/retail-store-ecs-cluster/ui \\ --min-capacity 2 \\ --max-capacity 10 Scalable Target l√† m·ªôt ƒë·ªëi t∆∞·ª£ng c√≥ th·ªÉ b·ªã Auto Scaling. Vi·ªác khai b√°o n√†y v·ªõi Application Auto Scaling r·∫±ng: ‚ÄúECS Service n√†y ƒê∆Ø·ª¢C PH√âP auto scale, v√† ch·ªâ ƒë∆∞·ª£c scale trong m·ªôt kho·∫£ng x√°c ƒë·ªãnh.‚Äù\nT·∫°o Scaling Policy Scaling policy l√† t·∫≠p c√°c quy t·∫Øc x√°c ƒë·ªãnh khi n√†o v√† b·∫±ng c√°ch n√†o Amazon ECS Service s·∫Ω tƒÉng ho·∫∑c gi·∫£m s·ªë l∆∞·ª£ng task, d·ª±a tr√™n c√°c metric ƒë∆∞·ª£c theo d√µi.\nScaling policy kh√¥ng tr·ª±c ti·∫øp th·ª±c hi·ªán vi·ªác scale t√†i nguy√™n, m√†:\nTheo d√µi c√°c metric t·ª´ CloudWatch So s√°nh metric v·ªõi c√°c ƒëi·ªÅu ki·ªán ho·∫∑c target ƒë√£ c·∫•u h√¨nh G·ª≠i y√™u c·∫ßu t·ªõi Application Auto Scaling ƒë·ªÉ ƒëi·ªÅu ch·ªânh DesiredCount c·ªßa ECS Service Trong Amazon ECS:\nScaling policy ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi Application Auto Scaling ƒê·ªëi t∆∞·ª£ng ƒë∆∞·ª£c scale l√† DesiredCount c·ªßa ECS Service Ti·∫øp theo, ch√∫ng ta s·∫Ω t·∫°o m·ªôt scaling policy cho scalable target n√†y.\nƒê·∫ßu ti√™n, t·∫°o m·ªôt file c·∫•u h√¨nh JSON cho scaling policy. C·∫•u h√¨nh n√†y s·ª≠ d·ª•ng predefined metric type l√† request count per target li√™n quan ƒë·∫øn Application Load Balancer (ALB) ƒë·ªãnh tuy·∫øn request t·ªõi ECS service. Trong tr∆∞·ªùng h·ª£p n√†y, m·ª•c ti√™u c·ªßa ch√∫ng ta l√† 1.500 requests cho m·ªói ECS task (ho·∫∑c target).\nScaling policy n√†y ch·ªâ mang t√≠nh v√≠ d·ª•. C·∫ßn hi·ªÉu r√µ scaling profile c·ªßa workload c·ª• th·ªÉ ƒë·ªÉ x√°c ƒë·ªãnh c√°c scaling metrics v√† thresholds ph√π h·ª£p tr∆∞·ªõc khi b·∫≠t autoscaling.\nFile c·∫•u h√¨nh JSON ui-scaling-policy.json:\n{ \u0026#34;TargetValue\u0026#34;: 1500, \u0026#34;PredefinedMetricSpecification\u0026#34;: { \u0026#34;PredefinedMetricType\u0026#34;: \u0026#34;ALBRequestCountPerTarget\u0026#34;, \u0026#34;ResourceLabel\u0026#34;: \u0026#34;$UI_ALB_PREFIX/$UI_TG_PREFIX\u0026#34; } } L∆∞u √Ω r·∫±ng ch√∫ng ta ƒëang s·ª≠ d·ª•ng c√°c environment variables l√† $UI_ALB_PREFIX v√† $UI_TG_PREFIX ƒë·ªÉ ch·ªâ ƒë·ªãnh ƒë√∫ng ALB v√† Target Group cho UI service.\n$UI_ALB_PREFIX: ARN c·ªßa ALB, tuy nhi√™n ch·ªâ c·∫ßn ph·∫ßn prefix l√† ƒë·ªß. V√≠ d·ª•: app/ecs-workshop-alb/07eeccd166f4ef38 $UI_TG_PREFIX: Target Group prefix cho UI service. V√≠ d·ª•: targetgroup/ui-tg/2feb79f68add27c7 B√¢y gi·ªù, ph·∫ßn ResourceLabel trong file c·∫•u h√¨nh JSON nh∆∞ sau: app/ecs-workshop-alb/07eeccd166f4ef38/targetgroup/ui-tg/2feb79f68add27c7\naws application-autoscaling put-scaling-policy \\ --service-namespace ecs \\ --scalable-dimension ecs:service:DesiredCount \\ --resource-id service/retail-store-ecs-cluster/ui \\ --policy-name ui-scaling-policy \\ --policy-type TargetTrackingScaling \\ --target-tracking-scaling-policy-configuration file://ui-scaling-policy.json Ki·ªÉm tra target tracking scaling policy trong Amazon ECS console.\nCloudWatch Alarm Tr·∫°ng th√°i alarm c√≥ th·ªÉ thay ƒë·ªïi t√πy theo s·ªë l∆∞·ª£ng request. V√≠ d·ª•, UI-AlarmLow s·∫Ω trigger khi s·ªë request gi·∫£m xu·ªëng d∆∞·ªõi 1350.\nC·∫•u h√¨nh High Alarm (Scale-out):\nMetric: ALBRequestCountPerTarget \u0026gt; 1500\nEvaluation: 3 data points trong 3 ph√∫t\nAction: Khi ·ªü tr·∫°ng th√°i ALARM, s·∫Ω th√™m task v√†o ECS service\nBehavior: Ti·∫øp t·ª•c th√™m task trong c√°c evaluation period ti·∫øp theo n·∫øu alarm v·∫´n t·ªìn t·∫°i, t·ªëi ƒëa ƒë·∫øn gi·ªõi h·∫°n ƒë√£ ch·ªâ ƒë·ªãnh trong scaling policy\nC·∫•u h√¨nh Low Alarm (Scale-in):\nMetric: ALBRequestCountPerTarget \u0026lt; 1350\nEvaluation: 15 data points trong 15 ph√∫t\nAction: Khi ·ªü tr·∫°ng th√°i ALARM, s·∫Ω gi·∫£m s·ªë l∆∞·ª£ng task\nBehavior: Scale-in ch·∫≠m h∆°n ƒë·ªÉ ∆∞u ti√™n high availability\nTrigger Auto Scaling Ti·∫øn h√†nh t·∫°o synthetic load ƒë·ªÉ trigger auto scaling.\nƒê·∫ßu ti√™n ch√∫ng ta c·∫ßn l·∫•y DNS Name c·ªßa Application Load Balancer ƒë∆∞·ª£c g·∫Øn cho UI service.\nexport RETAIL_ALB=$(aws elbv2 describe-load-balancers --name ecs-workshop-alb \\ --query \u0026#39;LoadBalancers[0].DNSName\u0026#39; --output text) echo \u0026#34;Retail ALB: ${RETAIL_ALB}\u0026#34; Ti·∫øp theo, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng hey tool ƒë·ªÉ g·ª≠i request ƒë·∫øn path /home c·ªßa UI service:\nC√≥ th·ªÉ c√†i ƒë·∫∑t hey tool b·∫±ng l·ªánh sau:\nsudo apt update sudo apt install hey -y hey -n 1000000 -c 5 -q 40 http://$RETAIL_ALB/home \u0026amp; Ho·∫°t ƒë·ªông scaling s·∫Ω ƒë∆∞·ª£c k√≠ch ho·∫°t khi high alarm cho scaling metric b·ªã breach trong 3 chu k·ª≥ li√™n ti·∫øp, m·ªói chu k·ª≥ 1 ph√∫t. N·∫øu b·∫°n mu·ªën t·ª± ƒë·ªông ch·ªù cho ƒë·∫øn khi alarm ƒë∆∞·ª£c k√≠ch ho·∫°t, b·∫°n c√≥ th·ªÉ ch·∫°y l·ªánh sau (kho·∫£ng ~ 4 ph√∫t):\nsleep 90 \u0026amp;\u0026amp; aws cloudwatch wait alarm-exists --alarm-name-prefix \\ TargetTracking-service/retail-store-ecs-cluster/ui-AlarmHigh --state-value ALARM Khi alarm ƒë∆∞·ª£c k√≠ch ho·∫°t, b·∫°n s·∫Ω th·∫•y task count c·ªßa service scale out t·ª´ 2 l√™n con s·ªë cao h∆°n:\naws ecs describe-tasks \\ --cluster retail-store-ecs-cluster \\ --tasks $(aws ecs list-tasks --cluster retail-store-ecs-cluster --query \u0026#39;taskArns[]\u0026#39; --output text) \\ --query \u0026#34;tasks[*].[group, launchType, lastStatus, healthStatus, taskArn]\u0026#34; --output table C√≥ th·ªÉ quan s√°t high alarm li√™n quan ƒë·∫øn scaling policy chuy·ªÉn sang tr·∫°ng th√°i ALARM trong CloudWatch console, nh∆∞ h√¨nh b√™n d∆∞·ªõi.\nB·∫°n c≈©ng c√≥ th·ªÉ ki·ªÉm tra tab Events trong trang UI Service ƒë·ªÉ xem ho·∫°t ƒë·ªông scaling, n∆°i desired count tƒÉng l√™n v∆∞·ª£t qu√° s·ªë task ban ƒë·∫ßu.\nTi·∫øp theo ch√∫ng ta s·∫Ω ti·∫øn h√†nh gi·∫£m s·ªë l∆∞·ª£ng c√°c task trong ECS service.\nD·ª´ng ti·∫øn tr√¨nh Hey:\npkill -9 hey Th√¥ng th∆∞·ªùng, sau v√†i ph√∫t, s·ªë l∆∞·ª£ng task s·∫Ω scale back v·ªÅ m·ª©c t·ªëi thi·ªÉu l√† 2. Tuy nhi√™n, ƒë·ªÉ ti·∫øt ki·ªám th·ªùi gian, ch√∫ng ta c√≥ th·ªÉ force scale down service b·∫±ng c√°ch ch·∫°y c√°c l·ªánh sau:\naws ecs wait services-stable --cluster retail-store-ecs-cluster --services ui aws ecs update-service \\ --cluster retail-store-ecs-cluster \\ --service ui \\ --task-definition retail-store-ecs-ui \\ --desired-count 2 "
},
{
	"uri": "http://localhost:1313/vi/5-managed-instances/5.2-deploy/",
	"title": "Tri·ªÉn khai v·ªõi Managed Instances",
	"tags": [],
	"description": "",
	"content": "Register Task Definition Ch√∫ng ta s·∫Ω tri·ªÉn khai UI service (ui-managed-instance) b·∫±ng c√°ch s·ª≠ d·ª•ng ECS Managed Instances m√† ch√∫ng ta ƒë√£ t·∫°o trong b∆∞·ªõc tr∆∞·ªõc.\nTi·∫øn h√†nh register m·ªôt task definition m·ªõi v·ªõi t√™n l√† retail-store-ecs-ui-managed b·∫±ng c√°ch s·ª≠ d·ª•ng file json retail-store-ecs-ui-managed-taskdef.json b√™n d∆∞·ªõi:\n{ \u0026#34;family\u0026#34;: \u0026#34;retail-store-ecs-ui-managed\u0026#34;, \u0026#34;networkMode\u0026#34;: \u0026#34;awsvpc\u0026#34;, \u0026#34;requiresCompatibilities\u0026#34;: [ \u0026#34;MANAGED_INSTANCES\u0026#34; ], \u0026#34;cpu\u0026#34;: \u0026#34;1024\u0026#34;, \u0026#34;memory\u0026#34;: \u0026#34;2048\u0026#34;, \u0026#34;runtimePlatform\u0026#34;: { \u0026#34;cpuArchitecture\u0026#34;: \u0026#34;X86_64\u0026#34;, \u0026#34;operatingSystemFamily\u0026#34;: \u0026#34;LINUX\u0026#34; }, \u0026#34;containerDefinitions\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/aws-containers/retail-store-sample-ui:1.2.3\u0026#34;, \u0026#34;portMappings\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;containerPort\u0026#34;: 8080, \u0026#34;hostPort\u0026#34;: 8080, \u0026#34;protocol\u0026#34;: \u0026#34;tcp\u0026#34;, \u0026#34;appProtocol\u0026#34;: \u0026#34;http\u0026#34; } ], \u0026#34;versionConsistency\u0026#34;: \u0026#34;disabled\u0026#34;, \u0026#34;essential\u0026#34;: true, \u0026#34;linuxParameters\u0026#34;: { \u0026#34;initProcessEnabled\u0026#34;: true }, \u0026#34;healthCheck\u0026#34;: { \u0026#34;command\u0026#34;: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -f http://localhost:8080/actuator/health || exit 1\u0026#34; ], \u0026#34;interval\u0026#34;: 10, \u0026#34;timeout\u0026#34;: 5, \u0026#34;retries\u0026#34;: 3, \u0026#34;startPeriod\u0026#34;: 60 }, \u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;awslogs\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;awslogs-group\u0026#34;: \u0026#34;retail-store-ecs-tasks\u0026#34;, \u0026#34;awslogs-region\u0026#34;: \u0026#34;$AWS_REGION\u0026#34;, \u0026#34;awslogs-stream-prefix\u0026#34;: \u0026#34;ui-managed-service\u0026#34; } } } ], \u0026#34;executionRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskExecutionRole\u0026#34;, \u0026#34;taskRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskRole\u0026#34; } Ch·∫°y l·ªánh sau ƒë·ªÉ register task definition m·ªõi:\naws ecs register-task-definition --cli-input-json file://retail-store-ecs-ui-managed-taskdef.json T·∫°o Target Group \u0026amp; Application Load Balancer Truy c·∫≠p EC2 Console:\nCh·ªçn ph·∫ßn Target Groups v√† ch·ªçn Create Target Group.\nC·∫•u h√¨nh c√°c th√¥ng s·ªë sau:\nTarget Group Name: ui-managed-tg Target Type: IP Addresses Protocol: HTTP Port: 8080 VPC: VPC ch√∫ng ta ƒë√£ t·∫°o trong b∆∞·ªõc tr∆∞·ªõc. Health Check Protocol: HTTP Health Check Path: /actuator/health Sau khi c·∫•u h√¨nh xong ch·ªçn Next.\nKi·ªÉm tra l·∫°i c√°c th√¥ng s·ªë v√† ch·ªçn Create Target Group.\nNh∆∞ v·∫≠y ch√∫ng ta ƒë√£ t·∫°o xong Target Group. Ti·∫øp theo ch√∫ng ta s·∫Ω t·∫°o Application Load Balancer.\nTi·∫øp t·ª•c truy c·∫≠p v√†o EC2 Console v√† ch·ªçn Load Balancers v√† ch·ªçn Create Load Balancer.\nCh·ªçn Type l√† Application Load Balancer.\nC·∫•u h√¨nh c√°c th√¥ng s·ªë sau:\nLoad Balancer Name: ui-managed-alb Scheme: Internet-facing VPC: VPC ch√∫ng ta ƒë√£ t·∫°o trong b∆∞·ªõc tr∆∞·ªõc. C·∫•u h√¨nh 2 Publib Subnet cho ALB. Ch·ªçn alb-sg v·ª´a t·∫°o v√† ch·ªçn Target Group ui-managed-tg. Review v√† ch·ªçn Create Load Balancer.\nNh∆∞ v·∫≠y ch√∫ng ta ƒë√£ t·∫°o xong Application Load Balancer.\nT·∫°o Service ECS B√¢y gi·ªù, h√£y t·∫°o m·ªôt UI service m·ªõi ƒë·ªÉ s·ª≠ d·ª•ng Amazon ECS Managed Instances capacity provider.\nCh√∫ √Ω c√°c bi·∫øn nh∆∞:\nUI_TG_ARN: ARN c·ªßa Target Group v·ª´a t·∫°o.\nPRIVATE_SUBNET1: ID c·ªßa Private Subnet th·ª© nh·∫•t ch√∫ng ta ƒë√£ t·∫°o trong b∆∞·ªõc tr∆∞·ªõc.\nPRIVATE_SUBNET2: ID c·ªßa Private Subnet th·ª© hai ch√∫ng ta ƒë√£ t·∫°o trong b∆∞·ªõc tr∆∞·ªõc.\nUI_SG_ID: ID c·ªßa Security Group ui-sg.\naws ecs create-service \\ --cluster retail-store-ecs-cluster \\ --service-name ui-managed-instance \\ --desired-count 2 \\ --task-definition retail-store-ecs-ui-managed \\ --load-balancers targetGroupArn=arn:aws:elasticloadbalancing:ap-northeast-2:${ACCOUNT_ID}:targetgroup/ui-managed-tg/57dad0b464a5ef76,containerName=application,containerPort=8080 \\ --capacity-provider-strategy capacityProvider=retail-store-managed-instances-cp,weight=1 \\ --network-configuration \u0026#34;awsvpcConfiguration={subnets=[${PRIVATE_SUBNET1}, ${PRIVATE_SUBNET2}], securityGroups=[${UI_SG_ID}],assignPublicIp=DISABLED}\u0026#34; Ki·ªÉm tra th√¥ng tin Service tr√™n ECS Console:\nCh·∫°y l·ªánh sau ƒë·ªÉ xem l·∫°i c·∫•u h√¨nh c·ªßa c√°c task ƒëang ch·∫°y. S·∫Ω th·∫•y CapacityProviderName b√¢y gi·ªù l√† retail-store-managed-instances-cp thay v√¨ FARGATE:\naws ecs describe-tasks \\ --cluster retail-store-ecs-cluster \\ --tasks $(aws ecs list-tasks --cluster retail-store-ecs-cluster --service ui-managed-instance --query \u0026#39;taskArns[]\u0026#39; --output text) \\ --query \u0026#34;tasks[*].{Group:group, CapacityProviderName:capacityProviderName, LastStatus:lastStatus, HealthStatus:healthStatus, TaskArn:taskArn}\u0026#34; --output table C√≥ th·ªÉ l·∫•y load balancer URL tr√™n AWS Console nh∆∞ sau:\nTruy c·∫≠p v√†o load balancer URL ƒë·ªÉ ki·ªÉm tra th√¨ c√≥ th·ªÉ th·∫•y website ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai th√†nh c√¥ng.\n"
},
{
	"uri": "http://localhost:1313/vi/3-prepare/",
	"title": "Chu·∫©n b·ªã",
	"tags": [],
	"description": "",
	"content": "Trong ph·∫ßn n√†y, b·∫°n s·∫Ω th·ª±c hi·ªán c√°c b∆∞·ªõc chu·∫©n b·ªã c·∫ßn thi·∫øt ƒë·ªÉ s·∫µn s√†ng cho c√°c ph·∫ßn th·ª±c h√†nh ti·∫øp theo. C√°c b∆∞·ªõc chu·∫©n b·ªã n√†y s·∫Ω gi√∫p b·∫°n thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng v√† c·∫•u h√¨nh c∆° b·∫£n ƒë·ªÉ tri·ªÉn khai v√† qu·∫£n l√Ω c√°c ·ª©ng d·ª•ng containerized tr√™n Amazon ECS.\nTrong ph·∫ßn Chu·∫©n b·ªã n√†y, b·∫°n s·∫Ω:\n3.1 - T·∫°o User \u0026amp; Access Key\nC√†i ƒë·∫∑t v√† c·∫•u h√¨nh AWS CLI T·∫°o IAM User v·ªõi quy·ªÅn AdministratorAccess T·∫°o Access Key ƒë·ªÉ x√°c th·ª±c v·ªõi AWS services 3.2 - T·∫°o Cluster \u0026amp; Task Definition\nT·∫°o Amazon ECS Cluster v·ªõi CloudWatch Container Insights ƒê·ªãnh nghƒ©a Task Definitions v·ªõi c√°c th√¥ng s·ªë CPU, memory v√† container specifications 3.3 - Services\nT·∫°o VPC v√† c·∫•u h√¨nh networking (subnets, NAT Gateway) Tri·ªÉn khai v√† qu·∫£n l√Ω ECS Services ƒë·ªÉ duy tr√¨ s·ªë l∆∞·ª£ng tasks mong mu·ªën 3.4 - C·∫≠p nh·∫≠t Services\nC·∫≠p nh·∫≠t services v·ªõi c·∫•u h√¨nh m·ªõi v√† deployments S·ª≠ d·ª•ng environment variables ƒë·ªÉ c·∫•u h√¨nh ·ª©ng d·ª•ng "
},
{
	"uri": "http://localhost:1313/vi/5-managed-instances/5.3-managed/",
	"title": "Managed Instances Infrastructure",
	"tags": [],
	"description": "",
	"content": "Managed Instances Infrastructure Trong ph·∫ßn n√†y, s·∫Ω ƒëi s√¢u t√¨m hi·ªÉu c√°c EC2 instances m√† Amazon ECS Managed Instances ƒë√£ t·∫°o ra ƒë·ªÉ h·ªó tr·ª£ UI service m√† ch√∫ng ta ƒë√£ tri·ªÉn khai ·ªü ph·∫ßn tr∆∞·ªõc.\nCh·∫°y l·ªánh sau ƒë·ªÉ xem c√°c EC2 instances:\naws ec2 describe-instances \\ --filters \\ \u0026#34;Name=tag:aws:ec2:managed-launch,Values=ecs-managed-instances\u0026#34; \\ \u0026#34;Name=instance-state-name,Values=running\u0026#34; \\ --query \u0026#39;Reservations[*].Instances[*].{InstanceId:InstanceId,InstanceType:InstanceType,State:State.Name,PrivateIpAddress:PrivateIpAddress}\u0026#39; \\ --output table V√¨ UI service ƒë∆∞·ª£c tri·ªÉn khai theo m√¥ h√¨nh high-availability (HA) v·ªõi 2 running tasks, v√† Amazon ECS Managed Instance capacity provider ƒë∆∞·ª£c g·∫Øn v·ªõi 2 subnets (·ªü c√°c AZ kh√°c nhau), s·∫Ω th·∫•y 2 EC2 instances kh√°c nhau ƒëang ch·∫°y.\nC√≥ th·ªÉ th·∫•y c√°c EC2 instance types kh√°c nhau ƒëang ch·∫°y trong cluster, v√¨ ch√∫ng ta kh√¥ng ch·ªâ ƒë·ªãnh b·∫•t k·ª≥ ƒëi·ªÅu ki·ªán n√†o trong capacity provider cho Amazon ECS Managed Instances.\n------------------------------------------------------------------------\r| DescribeInstances |\r+----------------------+---------------+--------------------+----------+\r| InstanceId | InstanceType | PrivateIpAddress | State |\r+----------------------+---------------+--------------------+----------+\r| i-056556a991639db3c | c5a.large | 10.0.145.243 | running |\r| i-08b1aa2b2ec697a12 | c5a.large | 10.0.135.156 | running |\r+----------------------+---------------+--------------------+----------+ C√≥ th·ªÉ xem c√°c Instances tr√™n ECS Console:\nB√¢y gi·ªù, h√£y ki·ªÉm tra c√°ch Amazon ECS Managed Instance x·ª≠ l√Ω workload b·ªï sung b·∫±ng c√°ch tƒÉng s·ªë running tasks c·ªßa UI service t·ª´ 2 l√™n 6. Trong tr∆∞·ªùng h·ª£p n√†y, s·∫Ω nh·∫≠n th·∫•y r·∫±ng v√¨ c√°c EC2 instances hi·ªán t·∫°i kh√¥ng ƒë·ªß t√†i nguy√™n ƒë·ªÉ tri·ªÉn khai c√°c running tasks, n√™n c√°c EC2 instances b·ªï sung s·∫Ω ƒë∆∞·ª£c tri·ªÉn khai ƒë·ªÉ h·ªó tr·ª£ workload m·ªü r·ªông. Xem AWS Documentation ƒë·ªÉ bi·∫øt th√™m th√¥ng tin v·ªÅ instance selection.\naws ecs update-service \\ --cluster retail-store-ecs-cluster \\ --service ui-managed-instance \\ --desired-count 6 \\ --placement-constraints \\ --task-definition retail-store-ecs-ui-managed Sau khi qu√° tr√¨nh tri·ªÉn khai ho√†n t·∫•t, h√£y xem c√°ch c√°c task ƒë∆∞·ª£c ph√¢n b·ªë tr√™n c√°c EC2 instances.\nC√≥ th·ªÉ th·∫•y c√≥ 2 task ƒëang ch·∫°y tr√™n m7i-flex.large v√† 2 task ƒëang ch·∫°y tr√™n m5.large c√≤n l·∫°i 2 task chia ƒë·ªÅu cho c5a.large.\nKi·ªÉm tra instance types b·∫±ng c√°ch m·ªü EC2 console ƒë·ªÉ xem c√°c EC2 instances m·ªõi. Amazon ECS Managed Instance s·∫Ω kh·ªüi t·∫°o th√™m c√°c instance ƒë·ªÉ ƒë√°p ·ª©ng y√™u c·∫ßu capacity m·ªõi.\nCu·ªëi c√πng, h√£y scale down s·ªë l∆∞·ª£ng task c·ªßa UI service v·ªÅ 2.\naws ecs update-service \\ --cluster retail-store-ecs-cluster \\ --service ui-managed-instance \\ --desired-count 2 \\ --task-definition retail-store-ecs-ui-managed \\ --placement-constraints type=\u0026#34;distinctInstance\u0026#34; 4 tasks ƒë√£ ƒë∆∞·ª£c g·ª° b·ªè v√† hi·ªán c√≥ 2 instances ƒëang ·ªü tr·∫°ng th√°i idle.\nSau v√†i ph√∫t n·ªØa, c√°c idle instances s·∫Ω ƒë∆∞·ª£c capacity provider deregister v√† terminate. Th·ª±c thi l·ªánh sau, sau v√†i ph√∫t s·∫Ω ch·ªâ th·∫•y c√≤n 2 EC2 instances ƒëang ch·∫°y:\naws ec2 describe-instances \\ --filters \\ \u0026#34;Name=tag:aws:ec2:managed-launch,Values=ecs-managed-instances\u0026#34; \\ \u0026#34;Name=instance-state-name,Values=running\u0026#34; \\ --query \u0026#39;Reservations[*].Instances[*].{InstanceId:InstanceId,InstanceType:InstanceType,State:State.Name,PrivateIpAddress:PrivateIpAddress}\u0026#39; \\ --output table "
},
{
	"uri": "http://localhost:1313/vi/6-auto-scaling/6.3-scheduled_scaling/",
	"title": "Scheduled Scaling",
	"tags": [],
	"description": "",
	"content": "\rPh·∫£i ho√†n th√†nh ph·∫ßn Target Tracking Scaling tr∆∞·ªõc khi l√†m ph·∫ßn n√†y.\nTrong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω c·∫•u h√¨nh ECS Service Auto Scaling b·∫±ng Scheduled Scaling. ƒêi·ªÅu n√†y bao g·ªìm vi·ªác thi·∫øt l·∫≠p c√°c quy t·∫Øc scale theo th·ªùi gian c·ªë ƒë·ªãnh, ph√π h·ª£p cho c√°c service c√≥ m√¥ h√¨nh t·∫£i d·ªÖ d·ª± ƒëo√°n.\nCh√∫ng ta s·∫Ω t·∫°o m·ªôt scheduled scaling cho UI service b·∫±ng c√°ch s·ª≠ d·ª•ng cron expression (l·ªãch auto scaling) ƒë·ªÉ ki·ªÉm tra vi·ªác scale-out v√† scale-in th√¥ng qua vi·ªác ƒëi·ªÅu ch·ªânh gi√° tr·ªã minimum.\nTi·∫øn h√†nh ch·∫°y l·ªánh sau ƒë·ªÉ tƒÉng minimum capacity t·ª´ 2 l√™n 5 sau 1 ph√∫t k·ªÉ t·ª´ th·ªùi ƒëi·ªÉm hi·ªán t·∫°i.\naws application-autoscaling put-scheduled-action \\ --service-namespace ecs \\ --scalable-dimension ecs:service:DesiredCount \\ --resource-id service/retail-store-ecs-cluster/ui \\ --scheduled-action-name \u0026#34;test-scale-up\u0026#34; \\ --schedule \u0026#34;at($(date -u -d \u0026#34;+1 minutes\u0026#34; \u0026#34;+%Y-%m-%dT%H:%M:%S\u0026#34;))\u0026#34; \\ --scalable-target-action MinCapacity=5,MaxCapacity=10 C·∫ßn ph·∫£i register scalable target tr∆∞·ªõc khi t·∫°o scheduled scaling.\nKi·ªÉm tra Event:\nCh·∫°y l·ªánh sau ƒë·ªÉ quan s√°t scheduled action. S·∫Ω th·∫•y danh s√°ch g·ªìm 5 ECS tasks.\naws ecs describe-tasks \\ --cluster retail-store-ecs-cluster \\ --tasks $(aws ecs list-tasks --cluster retail-store-ecs-cluster --service-name ui --query \u0026#39;taskArns[]\u0026#39; --output text) \\ --query \u0026#34;tasks[*].[group, launchType, lastStatus, healthStatus, taskArn]\u0026#34; --output table Ki·ªÉm tra tr√™n ECS Consle:\nB√¢y gi·ªù h√£y ch·∫°y l·ªánh sau ƒë·ªÉ scale back. L·ªánh n√†y s·∫Ω ƒë·∫∑t desired capacity v·ªÅ 2, l√† m·ª©c task ban ƒë·∫ßu.\naws ecs update-service \\ --cluster retail-store-ecs-cluster \\ --service ui \\ --task-definition retail-store-ecs-ui \\ --desired-count 2 Ki·ªÉm tra tr√™n ECS Consle:\nTri·ªÉn khai Scheduled Scaling trong th·ª±c t·∫ø C√°c l·ªánh c√≥ th·ªÉ ƒë∆∞·ª£c ƒëi·ªÅu ch·ªânh ƒë·ªÉ l√™n l·ªãch scale trong c√°c khung th·ªùi gian c·∫ßn thi·∫øt d·ª±a tr√™n y√™u c·∫ßu c·ªßa ·ª©ng d·ª•ng. V√≠ d·ª•, scheduled scaling c√≥ th·ªÉ ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·ªÉ k√≠ch ho·∫°t v√†o 9 gi·ªù s√°ng UTC v√† 6 gi·ªù t·ªëi UTC m·ªói ng√†y, ph√π h·ª£p v·ªõi th·ªùi gian cao ƒëi·ªÉm c·ªßa m·ªôt ·ª©ng d·ª•ng to√†n c·∫ßu.\nV√≠ d·ª• sau c√≥ th·ªÉ √°p d·ª•ng trong th·ª±c t·∫ø.\nL·ªánh sau s·∫Ω k√≠ch ho·∫°t scale-out, tƒÉng s·ªë l∆∞·ª£ng task l√™n 5 m·ªói ng√†y l√∫c 9:00 s√°ng UTC ƒë·ªÉ ƒë√°p ·ª©ng l∆∞u l∆∞·ª£ng truy c·∫≠p d·ª± ki·∫øn tƒÉng cao trong ng√†y:\naws application-autoscaling put-scheduled-action \\ --service-namespace ecs \\ --scalable-dimension ecs:service:DesiredCount \\ --resource-id service/retail-store-ecs-cluster/ui \\ --scheduled-action-name \u0026#34;week-day-scale-out\u0026#34; \\ --schedule \u0026#34;cron(0 9 ? * MON-FRI *)\u0026#34; \\ --scalable-target-action MinCapacity=5,MaxCapacity=10 L·ªánh sau s·∫Ω k√≠ch ho·∫°t scale-in, gi·∫£m s·ªë l∆∞·ª£ng task trong c√°c khung gi·ªù th·∫•p ƒëi·ªÉm. V√≠ d·ª•, ch√∫ng ta s·∫Ω scale down UI service l√∫c 6 gi·ªù t·ªëi m·ªói ng√†y.\naws application-autoscaling put-scheduled-action \\ --service-namespace ecs \\ --scalable-dimension ecs:service:DesiredCount \\ --resource-id service/retail-store-ecs-cluster/ui \\ --scheduled-action-name \u0026#34;week-day-scale-in\u0026#34; \\ --schedule \u0026#34;cron(0 18 ? * MON-FRI *)\u0026#34; \\ --scalable-target-action MinCapacity=2,MaxCapacity=10 "
},
{
	"uri": "http://localhost:1313/vi/3-prepare/3.3-services/",
	"title": "Services",
	"tags": [],
	"description": "",
	"content": "T·∫°o VPC Truy c·∫≠p VPC tr√™n AWS Console:\nCh·ªçn Create VPC.\nCh·ªçn VPC and more v√† c·∫•u h√¨nh c√°c th√¥ng s·ªë sau:\nVPC Name: ecs-workshop VPC CIDR Block: 10.0.0.0/16 Number of Availability Zones: 2 Number of Public Subnets: 2 Number of Private Subnets: 2 NAT Gateway: None (NAT s·∫Ω ƒë∆∞·ª£c t·∫°o th·ªß c√¥ng sau) VPC Endpoint: None Sau khi c·∫•u h√¨nh xong, ch·ªçn Create VPC.\nNh∆∞ v·∫≠y VPC ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nT·∫°o NAT Gateway Tr√™n giao di·ªán VPC Console, ch·ªçn NAT Gateways v√† ch·ªçn Create NAT Gateway.\nC·∫•u h√¨nh c√°c th√¥ng s·ªë sau:\nNAT Gateway Name: ecs-workshop-nat Availability mode: Regional VPC: VPC v·ª´a m·ªõi t·∫°o. Method of Elastic IP (EIP) allocation: Automatic Sau khi ƒë√£ c·∫•u h√¨nh xong ti·∫øn h√†nh ch·ªçn Create NAT Gateway\nTi·∫øn h√†nh t·∫°o Elastic IP tr√™n giao di·ªán VPC Console.\nChon Allocation Elastic IP address Ch·ªçn Allocate\nNh∆∞ v·∫≠y Elastic IP ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nNAT Gateway s·∫Ω t·ª± ƒë·ªông l·∫•y Elastic IP ƒë√£ t·∫°o.\nSau khi t·∫°o NAT Gateway, ti·∫øn h√†nh c·∫•u h√¨nh Route Table cho Private Subnet.\nTruy c·∫≠p Route Table:\nCh·ªçn Private Subnet. Ch·ªçn Routes Ch·ªçn Edit Routes C·∫•u h√¨nh c√°c th√¥ng s·ªë sau:\nDestination: 0.0.0.0/0 Target: NAT Gateway v√† ch·ªçn ID c·ªßa NAT Gateway v·ª´a t·∫°o. Nh∆∞ v·∫≠y Route Table ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh th√†nh c√¥ng.\nL√†m t∆∞∆°ng t·ª± v·ªõi Private Subnet th·ª© hai.\nT·∫°o Security Group Truy c·∫≠p v√†o EC2 Console:\nCh·ªçn Security Groups v√† ch·ªçn Create Security Group.\nCh√∫ng ta s·∫Ω ti·∫øn h√†nh t·∫°o alb-sg ƒë·ªÉ cho ph√©p truy c·∫≠p v√†o ALB.\nSecurity Group Name: alb-sg Description: Security Group for ALB VPC: VPC v·ª´a m·ªõi t·∫°o. Inbound rules:\nType: HTTP Port: 80 Source: 0.0.0.0/0 Type: HTTPS Port: 443 Source: 0.0.0.0/0 Outbound rules:\nType: All traffic Source: 0.0.0.0/0 Sau khi ƒë√£ c·∫•u h√¨nh xong ti·∫øn h√†nh ch·ªçn Create Security Group\nSau khi t·∫°o xong Security Group cho ALB, ti·∫øn h√†nh t·∫°o Security Group cho ·ª©ng d·ª•ng.\nSecurity Group Name: ui-sg Description: Security Group for UI VPC: VPC v·ª´a m·ªõi t·∫°o. Inbound rules:\nType: Custom TCP Rule Port: 8080 Source: alb-sg Sau khi ƒë√£ c·∫•u h√¨nh xong ti·∫øn h√†nh ch·ªçn Create Security Group\nNh∆∞ v·∫≠y Security Group ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nT·∫°o Target Group Truy c·∫≠p EC2 Console:\nCh·ªçn ph·∫ßn Target Groups v√† ch·ªçn Create Target Group.\nC·∫•u h√¨nh c√°c th√¥ng s·ªë sau:\nTarget Group Name: ui-tg Target Type: IP Addresses Protocol: HTTP Port: 8080 VPC: VPC v·ª´a m·ªõi t·∫°o. Health Check Protocol: HTTP Health Check Path: /actuator/health Sau khi c·∫•u h√¨nh xong ch·ªçn Next.\nCh·ªçn Next.\nKi·ªÉm tra l·∫°i c√°c th√¥ng s·ªë v√† ch·ªçn Create Target Group.\nNh∆∞ v·∫≠y Target Group ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nT·∫°o Application Load Balancer T·∫°i giao di·ªán EC2 Console, ch·ªçn Load Balancers v√† ch·ªçn Create Load Balancer.\nCh·ªçn Type l√† Application Load Balancer.\nC·∫•u h√¨nh c√°c th√¥ng s·ªë sau:\nLoad Balancer Name: ecs-workshop-alb Scheme: Internet-facing VPC: VPC v·ª´a m·ªõi t·∫°o. C·∫•u h√¨nh 2 Publib Subnet cho ALB. Ch·ªçn alb-sg v·ª´a t·∫°o. Review v√† ch·ªçn Create Load Balancer.\nT·∫°o Service ECS Sau khi t·∫°o xong c√°c th√†nh ph·∫ßn ·ªü tr√™n, ti·∫øn h√†nh t·∫°o Service ECS.\nS·ª≠ d·ª•ng CLI sau ƒë·ªÉ ti·∫øn h√†nh t·∫°o Service ECS.\nCh√∫ √Ω c√°c tham s·ªë sau:\nUI_TG_ARN: ARN c·ªßa Target Group c·ªßa ·ª©ng d·ª•ng. PRIVATE_SUBNET1: ID c·ªßa Private Subnet th·ª© nh·∫•t. PRIVATE_SUBNET2: ID c·ªßa Private Subnet th·ª© hai. UI_SG_ID: ID c·ªßa Security Group c·ªßa ·ª©ng d·ª•ng. aws ecs create-service \\ --cluster retail-store-ecs-cluster \\ --service-name ui \\ --task-definition retail-store-ecs-ui \\ --desired-count 2 \\ --launch-type FARGATE \\ --load-balancers targetGroupArn=${UI_TG_ARN},containerName=application,containerPort=8080 \\ --network-configuration \u0026#34;awsvpcConfiguration={subnets=[${PRIVATE_SUBNET1},${PRIVATE_SUBNET2}],securityGroups=[${UI_SG_ID}],assignPublicIp=DISABLED}\u0026#34; Truy c·∫≠p v√†o Cluster ki·ªÉm tra th√¨ c√≥ th·ªÉ th·∫•y Service ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nKi·ªÉm tra th√¥ng tin Service:\nKi·ªÉm tra th√¥ng tin Task:\nTa c√≥ th·ªÉ th·∫•y 2 Task ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng.\nTi·∫øn h√†nh truy c·∫≠p Web v·ªõi ALB URL ƒë·ªÉ ki·ªÉm tra trang web.\nhttp://ecs-workshop-alb-653740503.ap-northeast-2.elb.amazonaws.com\nNh∆∞ v·∫≠y ·ª©ng d·ª•ng ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai th√†nh c√¥ng.\nSau khi t·∫°o ra c√°c th√†nh ph·∫ßn c∆° b·∫£n, ki·∫øn ‚Äã‚Äãtr√∫c hi·ªán t·∫°i c·ªßa c√°c Service ƒë√£ c·∫•u h√¨nh ƒë∆∞·ª£c hi·ªÉn th·ªã b√™n d∆∞·ªõi.\n"
},
{
	"uri": "http://localhost:1313/vi/3-prepare/3.4-updated_services/",
	"title": "C·∫≠p nh·∫≠t Services",
	"tags": [],
	"description": "",
	"content": "Trong ph·∫ßn n√†y ch√∫ng ta s·∫Ω c·∫≠p nh·∫≠t m·ªôt ECS Service. Quy tr√¨nh n√†y th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng trong c√°c t√¨nh hu·ªëng nh∆∞ thay ƒë·ªïi container image ho·∫∑c ƒëi·ªÅu ch·ªânh c·∫•u h√¨nh ·ª©ng d·ª•ng.\nEnvironment variables l√† m·ªôt trong nh·ªØng c∆° ch·∫ø ch√≠nh ƒë·ªÉ c·∫•u h√¨nh workload ch·∫°y trong container, b·∫•t k·ªÉ d√πng Orchestrator n√†o. Ch√∫ng ta s·∫Ω ti·∫øn h√†nh thay ƒë·ªïi c·∫•u h√¨nh c·ªßa UI Service ƒë·ªÉ s·ª≠ d·ª•ng c√°c bi·∫øn m√¥i tr∆∞·ªùng m·ªõi.\nDocker Image kh√¥ng th·ªÉ thay ƒë·ªïi sau khi ƒë∆∞·ª£c build, v√¨ v·∫≠y bi·∫øn m√¥i tr∆∞·ªùng l√† c√°ch ƒë∆°n gi·∫£n v√† linh ho·∫°t ƒë·ªÉ c·∫•u h√¨nh v√† ƒëi·ªÅu ch·ªânh h√†nh vi ·ª©ng d·ª•ng khi container ƒëang ch·∫°y.\nTrong tr∆∞·ªùng h·ª£p n√†y, s·∫Ω s·ª≠ d·ª•ng bi·∫øn RETAIL_UI_THEME, bi·∫øn n√†y s·∫Ω thay ƒë·ªïi m√†u giao di·ªán m·∫∑c ƒë·ªãnh c·ªßa ·ª©ng d·ª•ng.\nKhai b√°o bi·∫øn trong Task Definition Bi·∫øn m√¥i tr∆∞·ªùng trong ECS task definition ƒë∆∞·ª£c khai b√°o d∆∞·ªõi d·∫°ng c·∫∑p name‚Äìvalue, v√≠ d·ª•:\n\u0026#34;environment\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_UI_THEME\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;green\u0026#34; } ] Ti·∫øp theo s·∫Ω ti·∫øn h√†nh c·∫≠p nh·∫≠t file json retail-store-ecs-ui-updated-taskdef.json theo bi·∫øn m√¥i tr∆∞·ªùng m·ªõi.\n{ \u0026#34;family\u0026#34;: \u0026#34;retail-store-ecs-ui\u0026#34;, \u0026#34;executionRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskExecutionRole\u0026#34;, \u0026#34;taskRoleArn\u0026#34;: \u0026#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskRole\u0026#34;, \u0026#34;networkMode\u0026#34;: \u0026#34;awsvpc\u0026#34;, \u0026#34;requiresCompatibilities\u0026#34;: [ \u0026#34;FARGATE\u0026#34; ], \u0026#34;cpu\u0026#34;: \u0026#34;1024\u0026#34;, \u0026#34;memory\u0026#34;: \u0026#34;2048\u0026#34;, \u0026#34;runtimePlatform\u0026#34;: { \u0026#34;cpuArchitecture\u0026#34;: \u0026#34;X86_64\u0026#34;, \u0026#34;operatingSystemFamily\u0026#34;: \u0026#34;LINUX\u0026#34; }, \u0026#34;containerDefinitions\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;public.ecr.aws/aws-containers/retail-store-sample-ui:1.2.3\u0026#34;, \u0026#34;portMappings\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;application\u0026#34;, \u0026#34;containerPort\u0026#34;: 8080, \u0026#34;hostPort\u0026#34;: 8080, \u0026#34;protocol\u0026#34;: \u0026#34;tcp\u0026#34;, \u0026#34;appProtocol\u0026#34;: \u0026#34;http\u0026#34; } ], \u0026#34;essential\u0026#34;: true, \u0026#34;linuxParameters\u0026#34;: { \u0026#34;initProcessEnabled\u0026#34;: true }, \u0026#34;environment\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;RETAIL_UI_THEME\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;green\u0026#34; } ], \u0026#34;healthCheck\u0026#34;: { \u0026#34;command\u0026#34;: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -f http://localhost:8080/actuator/health || exit 1\u0026#34; ], \u0026#34;interval\u0026#34;: 10, \u0026#34;timeout\u0026#34;: 5, \u0026#34;retries\u0026#34;: 3, \u0026#34;startPeriod\u0026#34;: 60 }, \u0026#34;logConfiguration\u0026#34;: { \u0026#34;logDriver\u0026#34;: \u0026#34;awslogs\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;awslogs-group\u0026#34;: \u0026#34;retail-store-ecs-tasks\u0026#34;, \u0026#34;awslogs-region\u0026#34;: \u0026#34;$AWS_REGION\u0026#34;, \u0026#34;awslogs-stream-prefix\u0026#34;: \u0026#34;ui-service\u0026#34; } } } ] } Sau ƒë√≥, s·ª≠ d·ª•ng l·ªánh register-task-definition ƒë·ªÉ ƒëƒÉng k√Ω task definition m·ªõi:\naws ecs register-task-definition \\ --cli-input-json file://retail-store-ecs-ui-updated-taskdef.json ECS task definition l√† b·∫•t bi·∫øn (immutable), nghƒ©a l√† kh√¥ng th·ªÉ ch·ªânh s·ª≠a sau khi ƒë√£ t·∫°o. Thay v√†o ƒë√≥, l·ªánh tr√™n s·∫Ω t·∫°o m·ªôt revision m·ªõi, l√† b·∫£n sao c·ªßa task definition c≈© nh∆∞ng ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t c√°c tham s·ªë m·ªõi.\nKi·ªÉm tra c√°c revision c·ªßa Task Definition C√≥ th·ªÉ ki·ªÉm tra xem hi·ªán t·∫°i c√≥ bao nhi√™u revision b·∫±ng l·ªánh:\naws ecs list-task-definitions --family-prefix retail-store-ecs-ui --sort DESC --max-items 2 K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã c√°c revision c·ªßa task definition UI:\n{ \u0026#34;taskDefinitionArns\u0026#34;: [ \u0026#34;arn:aws:ecs:us-west-2:XXXXXXXXXXXX:task-definition/retail-store-ecs-ui:2\u0026#34;, \u0026#34;arn:aws:ecs:us-west-2:XXXXXXXXXXXX:task-definition/retail-store-ecs-ui:1\u0026#34; ] } Ho·∫∑c c√≥ th·ªÉ ki·ªÉm tra tr·ª±c ti·∫øp tr√™n AWS Console:\nC·∫≠p nh·∫≠t ECS Service ƒë·ªÉ s·ª≠ d·ª•ng revision m·ªõi Ti·∫øp theo, c·∫≠p nh·∫≠t ECS service ƒë·ªÉ d√πng task definition m·ªõi:\naws ecs update-service --cluster retail-store-ecs-cluster --service ui --task-definition retail-store-ecs-ui Ki·ªÉm tra k·∫øt qu·∫£ "
},
{
	"uri": "http://localhost:1313/vi/4-express-mode/",
	"title": "Express Mode",
	"tags": [],
	"description": "",
	"content": "\rB·∫°n ph·∫£i ho√†n th√†nh c√°c ch∆∞∆°ng sau tr∆∞·ªõc khi th·ª±c hi·ªán lab n√†y: 3. Chu·∫©n b·ªã\nTrong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu Amazon ECS Express Mode ‚Äî m·ªôt gi·∫£i ph√°p tri·ªÉn khai container ƒë∆∞·ª£c ƒë∆°n gi·∫£n h√≥a, cho ph√©p developer kh·ªüi ch·∫°y c√°c ·ª©ng d·ª•ng container h√≥a c√≥ t√≠nh High Availability v√† Scalability ch·ªâ v·ªõi m·ªôt l·ªánh duy nh·∫•t.\nB·∫±ng c√°ch t·ª± ƒë·ªông h√≥a vi·ªác thi·∫øt l·∫≠p h·∫° t·∫ßng v√† tu√¢n th·ªß c√°c best practices c·ªßa AWS, ECS Express Mode lo·∫°i b·ªè s·ª± ph·ª©c t·∫°p c·ªßa container orchestration, trong khi v·∫´n gi·ªØ quy·ªÅn truy c·∫≠p ƒë·∫ßy ƒë·ªß v√†o c√°c kh·∫£ nƒÉng c·ªßa Amazon ECS khi c·∫ßn.\nƒêi·ªÅu n√†y gi√∫p c√°c nh√≥m ph√°t tri·ªÉn t·∫≠p trung v√†o vi·ªác x√¢y d·ª±ng ·ª©ng d·ª•ng, thay v√¨ ph·∫£i qu·∫£n l√Ω c√°c th√†nh ph·∫ßn h·∫° t·∫ßng nh∆∞ load balancing, auto-scaling v√† networking.\nL·ª£i √≠ch c·ªßa Amazon ECS Express Mode Tri·ªÉn khai ƒë∆°n gi·∫£n: Tri·ªÉn khai v·ªõi c√°c c·∫•u h√¨nh m·∫∑c ƒë·ªãnh s·∫µn s√†ng cho production ch·ªâ b·∫±ng m·ªôt l·ªánh.\nKh√¥ng gi·ªõi h·∫°n kh·∫£ nƒÉng: V·∫´n c√≥ to√†n quy·ªÅn truy c·∫≠p v√†o c√°c t√†i nguy√™n AWS b√™n d∆∞·ªõi khi c·∫ßn.\nT·ªëi ∆∞u chi ph√≠: Chia s·∫ª Application Load Balancer gi·ªØa c√°c service ƒë·ªÉ gi·∫£m chi ph√≠.\nH·∫° t·∫ßng minh b·∫°ch: T·∫•t c·∫£ t√†i nguy√™n ƒë·ªÅu hi·ªÉn th·ªã r√µ r√†ng v√† c√≥ th·ªÉ truy c·∫≠p trong t√†i kho·∫£n AWS c·ªßa b·∫°n.\n"
},
{
	"uri": "http://localhost:1313/vi/5-managed-instances/",
	"title": "ECS Managed Instances",
	"tags": [],
	"description": "",
	"content": "Amazon ECS Managed Instances l√† m·ªôt t√πy ch·ªçn compute ƒë∆∞·ª£c qu·∫£n l√Ω ho√†n to√†n, gi√∫p lo·∫°i b·ªè g√°nh n·∫∑ng qu·∫£n l√Ω h·∫° t·∫ßng trong khi v·∫´n cung c·∫•p quy·ªÅn truy c·∫≠p v√†o h·ªá sinh th√°i EC2 phong ph√∫, bao g·ªìm:\nLinh ho·∫°t l·ª±a ch·ªçn instance type Truy c·∫≠p reserved capacity C·∫•u h√¨nh b·∫£o m·∫≠t v√† observability n√¢ng cao B·∫±ng c√°ch chuy·ªÉn giao c√°c t√°c v·ª• v·∫≠n h√†nh cho AWS, ECS Managed Instances gi√∫p b·∫Øt ƒë·∫ßu nhanh h∆°n, gi·∫£m t·ªïng chi ph√≠ s·ªü h·ªØu (TCO).\nL·ª£i √≠ch c·ªßa Amazon ECS Managed Instances TƒÉng t·ªëc ƒë·ªïi m·ªõi (Accelerate innovation) : Giao vi·ªác qu·∫£n l√Ω h·∫° t·∫ßng v√† v√° l·ªói (patching) cho AWS, t·ª´ ƒë√≥ gi·∫£m ƒë√°ng k·ªÉ overhead v·∫≠n h√†nh.\nC·∫£i thi·ªán hi·ªáu nƒÉng v√† ƒë·ªô s·∫µn s√†ng (Improve performance and availability) : N√¢ng cao hi·ªáu nƒÉng v√† t√≠nh s·∫µn s√†ng nh·ªù linh ho·∫°t ch·ªçn instance type ph√π h·ª£p v·ªõi t·ª´ng workload v√† t·∫≠n d·ª•ng reserved capacity.\nT·ªëi ∆∞u chi ph√≠ (Optimize costs) : T·ªëi ∆∞u chi ph√≠ th√¥ng qua c·∫•u h√¨nh instance t·ª± ƒë·ªông, qu·∫£n l√Ω capacity v√† ph√¢n b·ªï workload th√¥ng minh.\nN√¢ng cao b·∫£o m·∫≠t ·ª©ng d·ª•ng (Improve application security) : Cho ph√©p c·∫•u h√¨nh b·∫£o m·∫≠t v√† observability n√¢ng cao cho ·ª©ng d·ª•ng.\nH√£y xem AWS Documentation ƒë·ªÉ bi·∫øt th√™m th√¥ng tin v·ªÅ Amazon ECS Managed Instances.\n"
},
{
	"uri": "http://localhost:1313/vi/3-prepare/3.5-enable_ecs_exec/",
	"title": "Enable ECS Exec",
	"tags": [],
	"description": "",
	"content": "Trong ph·∫ßn n√†y ch√∫ng ta s·∫Ω k√≠ch ho·∫°t t√≠nh nƒÉng ECS Exec ƒë·ªÉ c√≥ th·ªÉ ch·∫°y l·ªánh ho·∫∑c m·ªü shell tr·ª±c ti·∫øp v√†o container ƒëang ch·∫°y tr√™n EC2 instance ho·∫∑c Fargate.\nVi·ªác b·∫≠t ECS Exec mang l·∫°i nhi·ªÅu l·ª£i √≠ch cho v·∫≠n h√†nh h·ªá th·ªëng (operational management) v√† ƒë·∫∑c bi·ªát t·ªët cho b·∫£o m·∫≠t. T√≠nh nƒÉng n√†y cho ph√©p truy c·∫≠p c√≥ ki·ªÉm so√°t v√†o container ƒëang ch·∫°y trong ECS task, gi√∫p troubleshoot m·ªôt c√°ch an to√†n, c√≥ audit, m√† kh√¥ng c·∫ßn SSH v√†o host.\nB·∫±ng c√°ch t·∫≠n d·ª•ng IAM policies v√† IAM roles, c√≥ th·ªÉ ki·ªÉm so√°t ch·∫∑t ch·∫Ω ai ƒë∆∞·ª£c ph√©p th·ª±c thi l·ªánh b√™n trong container, t·ª´ ƒë√≥ n√¢ng cao t∆∞ th·∫ø b·∫£o m·∫≠t t·ªïng th·ªÉ (security posture) c·ªßa h·ªá th·ªëng.\nNgo√†i ra, m·ªçi l·ªánh ƒë∆∞·ª£c th·ª±c thi th√¥ng qua ECS Exec ƒë·ªÅu ƒë∆∞·ª£c ghi log v√†o CloudWatch, gi√∫p t·∫°o audit trail ph·ª•c v·ª• m·ª•c ƒë√≠ch gi√°m s√°t v√† tu√¢n th·ªß (compliance).\nSet IAM Role cho User ƒê√¢y l√† b∆∞·ªõc thi·∫øt l·∫≠p quy·ªÅn cho User ƒë·ªÉ c√≥ th·ªÉ s·ª≠ d·ª•ng ECS Exec. N·∫øu th·ª±c hi·ªán theo b√†i lab n√†y th√¨ ch√∫ng ta ƒë√£ c·∫•u h√¨nh User v·ªõi quy·ªÅn AdministratorAccess, n√™n c√≥ th·ªÉ b·ªè qua b∆∞·ªõc n√†y.\nTi·∫øn h√†nh Policy v·ªõi c√°c quy·ªÅn sau:\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;ecs:ExecuteCommand\u0026#34;, \u0026#34;ecs:DescribeTasks\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:ecs:${AWS_REGION}:${ACCOUNT_ID}:task/retail-store-ecs-cluster/*\u0026#34;, \u0026#34;arn:aws:ecs:${AWS_REGION}:${ACCOUNT_ID}:cluster/*\u0026#34; ] } ] } Th√™m json tr√™n v√†o file ecs-exec-command-policy.json v√† ch·∫°y l·ªánh sau:\naws iam put-role-policy --role-name $(aws sts get-caller-identity --query \u0026#39;Arn\u0026#39; | cut -d\u0026#39;/\u0026#39; -f2) --policy-name AmazonECSExecCommand --policy-document file://ecs-exec-command-policy.json Set IAM Role cho ECS Task Role ECS Exec y√™u c·∫ßu task IAM role ƒë·ªÉ giao ti·∫øp v·ªõi AWS Systems Manager (SSM).\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;ssmmessages:CreateControlChannel\u0026#34;, \u0026#34;ssmmessages:CreateDataChannel\u0026#34;, \u0026#34;ssmmessages:OpenControlChannel\u0026#34;, \u0026#34;ssmmessages:OpenDataChannel\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; } ] } Th√™m json tr√™n v√†o file ecs-exec-task-role-policy.json v√† ch·∫°y l·ªánh sau:\naws iam put-role-policy --role-name retailStoreEcsTaskRole --policy-name AmazonECSExecTaskRolePolicy --policy-document file://ecs-exec-task-role-policy.json Ki·ªÉm tra l·∫°i Policy c·ªßa role v·ª´a t·∫°o\naws iam list-role-policies --role-name retailStoreEcsTaskRole --query \u0026#39;PolicyNames[0]\u0026#39; --output text Ki·ªÉm tra quy·ªÅn c·ªßa role b·∫±ng l·ªánh sau:\naws iam get-role-policy --role-name retailStoreEcsTaskRole --policy-name AmazonECSExecTaskRolePolicy Chu·∫©n b·ªã m√¥i tr∆∞·ªùng C√†i ƒë·∫∑t c√°c c√¥ng c·ª• c·∫ßn thi·∫øt:\nAWS CLI. Session Manager plugin cho AWS CLI. Ch√∫ng ta ƒë√£ th·ª±c hi·ªán c√†i ƒë·∫∑t AWS CLI ·ªü ph·∫ßn T·∫°o User v√† t·∫°o Access Key. Ti·∫øp theo ch√∫ng ta s·∫Ω c√†i ƒë·∫∑t Session Manager plugin cho AWS CLI.\nLinux: curl \u0026#34;https://s3.amazonaws.com/session-manager-downloads/plugin/latest/ubuntu_64bit/session-manager-plugin.deb\u0026#34; -o \u0026#34;session-manager-plugin.deb\u0026#34; sudo dpkg -i session-manager-plugin.deb MacOS: curl \u0026#34;https://s3.amazonaws.com/session-manager-downloads/plugin/latest/mac/session-manager-plugin.pkg\u0026#34; -o \u0026#34;session-manager-plugin.pkg\u0026#34; sudo installer -pkg session-manager-plugin.pkg -target / sudo ln -s /usr/local/sessionmanagerplugin/bin/session-manager-plugin /usr/local/bin/session-manager-plugin Windows: https://s3.amazonaws.com/session-manager-downloads/plugin/latest/windows/SessionManagerPluginSetup.exe Ch·∫°y l·ªánh sau ƒë·ªÉ ki·ªÉm tra Session Manager plugin ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t th√†nh c√¥ng:\nsession-manager-plugin Enable ECS Exec tr√™n Service C·∫≠p nh·∫≠t UI Service ƒë·ªÉ b·∫≠t ECS Exec b·∫±ng c√°ch s·ª≠ d·ª•ng flag --enable-execute-command:\naws ecs update-service \\ --cluster retail-store-ecs-cluster \\ --service ui \\ --task-definition retail-store-ecs-ui \\ --enable-execute-command --force-new-deployment Ki·ªÉm tra ARN c·ªßa ECS task c√≥ b·∫≠t ECS Exec Ch·∫°y l·ªánh sau ƒë·ªÉ ch·ªçn m·ªôt UI task ƒëang ch·∫°y v√† c√≥ enableExecuteCommand = true:\nECS_EXEC_TASK_ARN=$(aws ecs list-tasks --cluster retail-store-ecs-cluster \\ --service-name ui --query \u0026#39;taskArns[]\u0026#39; --output text | \\ xargs -n1 aws ecs describe-tasks --cluster retail-store-ecs-cluster --tasks | \\ jq -r \u0026#39;.tasks[] | select(.enableExecuteCommand == true) | .taskArn\u0026#39; | \\ head -n 1) Ki·ªÉm tra k·∫øt qu·∫£ b·∫±ng c√°ch ch·∫°y l·ªánh echo:\necho $ECS_EXEC_TASK_ARN K·∫øt n·ªëi t·ªõi ECS Task Ti·∫øn h√†nh k·∫øt n·ªëi t·ªõi ECS Task b·∫±ng c√°ch ch·∫°y l·ªánh sau:\nif [ -z \u0026#34;${ECS_EXEC_TASK_ARN}\u0026#34; ]; then echo \u0026#34;ECS_EXEC_TASK_ARN is not correctly configured!\u0026#34; else aws ecs execute-command \\ --cluster retail-store-ecs-cluster \\ --task $ECS_EXEC_TASK_ARN \\ --container application \\ --interactive \\ --command \u0026#34;/bin/bash\u0026#34; fi Ch√∫ng ta s·∫Ω th·∫•y Output nh∆∞ b√™n d∆∞·ªõi:\nThe Session Manager plugin was installed successfully. Use the AWS CLI to start a session. Starting session with SessionId: ecs-execute-command-vvdysulqbcz2txr2d262sw2s64 bash-5.2# "
},
{
	"uri": "http://localhost:1313/vi/6-auto-scaling/",
	"title": "Auto Scaling",
	"tags": [],
	"description": "",
	"content": "V√¨ m·ªôt Fargate instance t∆∞∆°ng ·ª©ng v·ªõi m·ªôt ECS task, n√™n b·∫°n c·∫ßn ch·ªâ ƒë·ªãnh CPU v√† memory c·ªßa task khi t·∫°o task definition. Do ƒë√≥, vi·ªác right-size c√°c Fargate tasks l√† r·∫•t quan tr·ªçng ƒë·ªÉ ƒë·∫£m b·∫£o ch√∫ng c√≥ th·ªÉ th·ª±c hi·ªán nhi·ªám v·ª• v·ªõi m·ª©c hi·ªáu nƒÉng mong mu·ªën.\nN·∫øu m·ªôt task g·∫∑p kh√≥ khƒÉn do CPU ho·∫∑c memory kh√¥ng ƒë·ªß, ƒëi·ªÅu n√†y cho th·∫•y task ch∆∞a ƒë∆∞·ª£c sizing ƒë√∫ng v√† c√≥ th·ªÉ c·∫ßn th√™m t√†i nguy√™n. C√≥ th·ªÉ ƒë√°nh gi√° ch√≠nh x√°c nhu c·∫ßu c·ªßa ·ª©ng d·ª•ng th√¥ng qua performance measurement, comprehensive load testing, ho·∫∑c theo d√µi s√°t c√°c key metrics.\nKhi ƒë√£ ch·∫Øc ch·∫Øn r·∫±ng c√°c task ƒë∆∞·ª£c sizing ph√π h·ª£p, c√≥ th·ªÉ scale horizontally b·∫±ng c√°ch tri·ªÉn khai th√™m c√°c task ƒë·ªÉ x·ª≠ l√Ω nhi·ªÅu request h∆°n. Horizontal scaling l√† ph∆∞∆°ng ph√°p ƒë∆∞·ª£c ∆∞u ti√™n ƒë·ªÉ scale c√°c workload cloud-native, containerized.\nService Auto Scaling Amazon ECS cung c·∫•p kh·∫£ nƒÉng t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh desired number of tasks trong service, t√≠nh nƒÉng n√†y ƒë∆∞·ª£c g·ªçi l√† Service Auto Scaling.\nECS Service Auto Scaling s·ª≠ d·ª•ng Application Auto Scaling ƒë·ªÉ cung c·∫•p ch·ª©c nƒÉng n√†y. ƒê·ªÉ auto scaling ho·∫°t ƒë·ªông hi·ªáu qu·∫£, metric ƒë∆∞·ª£c s·ª≠ d·ª•ng ph·∫£i l√† proportional metric. N·∫øu gi·ªØ nguy√™n s·ªë l∆∞·ª£ng task trong service v√† load tƒÉng g·∫•p ƒë√¥i, th√¨ gi√° tr·ªã metric c≈©ng ph·∫£i tƒÉng g·∫•p ƒë√¥i.\nProportional metric l√† metric tƒÉng/gi·∫£m t·ª∑ l·ªá thu·∫≠n v·ªõi t·∫£i (load) c·ªßa h·ªá th·ªëng.\nTrong b·ªëi c·∫£nh ECS khi s·ª≠ d·ª•ng EC2 instances, c≈©ng c·∫ßn xem x√©t vi·ªác s·ª≠ d·ª•ng capacity providers ƒë·ªÉ qu·∫£n l√Ω capacity c·ªßa EC2 instances b√™n c·∫°nh ECS Service Auto Scaling. Tuy nhi√™n, v√¨ ph·∫ßn lab n√†y ch·ªß y·∫øu t·∫≠p trung v√†o Fargate, n√™n ch√∫ng ta s·∫Ω kh√¥ng ƒëi s√¢u v√†o ECS capacity providers trong ph·∫ßn n√†y.\n"
},
{
	"uri": "http://localhost:1313/vi/7-networking/",
	"title": "Networking",
	"tags": [],
	"description": "",
	"content": "·ª®ng d·ª•ng hi·ªán t·∫°i ƒë∆∞·ª£c x√¢y d·ª±ng t·ª´ nhi·ªÅu th√†nh ph·∫ßn ph√¢n t√°n (microservices) giao ti·∫øp v·ªõi nhau. V√≠ d·ª•, th√†nh ph·∫ßn UI giao ti·∫øp th√¥ng qua API v·ªõi th√†nh ph·∫ßn Checkout, th√†nh ph·∫ßn n√†y l·∫°i ƒë∆∞·ª£c li√™n k·∫øt v·ªõi m·ªôt l·ªõp l∆∞u tr·ªØ b·ªÅn v·ªØng s·ª≠ d·ª•ng Redis, nh∆∞ ƒë∆∞·ª£c minh h·ªça trong s∆° ƒë·ªì ki·∫øn tr√∫c b√™n d∆∞·ªõi. ƒê·ªìng th·ªùi, c·∫£ UI v√† Checkout ƒë·ªÅu giao ti·∫øp th√¥ng qua API v·ªõi d·ªãch v·ª• Orders, d·ªãch v·ª• n√†y s·ª≠ d·ª•ng PostgreSQL l√†m l·ªõp l∆∞u tr·ªØ d·ªØ li·ªáu.\nTrong ph·∫ßn n√†y ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ ECS Networking v√† c√°ch n√≥ ho·∫°t ƒë·ªông li√™n quan ƒë·∫øn Fargate.\n"
},
{
	"uri": "http://localhost:1313/vi/8-observability/",
	"title": "Observability",
	"tags": [],
	"description": "",
	"content": "Observability "
},
{
	"uri": "http://localhost:1313/vi/9-security/",
	"title": "Security",
	"tags": [],
	"description": "",
	"content": "Security "
},
{
	"uri": "http://localhost:1313/vi/10-deployments/",
	"title": "Deployments",
	"tags": [],
	"description": "",
	"content": "Deployments "
},
{
	"uri": "http://localhost:1313/vi/11-storage/",
	"title": "Storage",
	"tags": [],
	"description": "",
	"content": "Storage "
},
{
	"uri": "http://localhost:1313/vi/12-cost-optimizations/",
	"title": "Cost Optimizations",
	"tags": [],
	"description": "",
	"content": "Cost Optimizations "
},
{
	"uri": "http://localhost:1313/vi/13-clean-up/",
	"title": "Clean Up",
	"tags": [],
	"description": "",
	"content": "Clean Up "
},
{
	"uri": "http://localhost:1313/vi/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://localhost:1313/vi/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]