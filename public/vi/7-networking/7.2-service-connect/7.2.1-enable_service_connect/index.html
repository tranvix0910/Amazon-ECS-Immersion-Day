<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="http://localhost:1313/images/favicon.png" type="image/png">

    <title>Enable Service Connect :: TRIỂN KHAI ỨNG DỤNG TRÊN AMAZON ELASTIC CONTAINER SERVICE</title>

    
    <link href="http://localhost:1313/css/nucleus.css?1768702295" rel="stylesheet">
    <link href="http://localhost:1313/css/fontawesome-all.min.css?1768702295" rel="stylesheet">
    <link href="http://localhost:1313/css/hybrid.css?1768702295" rel="stylesheet">
    <link href="http://localhost:1313/css/featherlight.min.css?1768702295" rel="stylesheet">
    <link href="http://localhost:1313/css/perfect-scrollbar.min.css?1768702295" rel="stylesheet">
    <link href="http://localhost:1313/css/auto-complete.css?1768702295" rel="stylesheet">
    <link href="http://localhost:1313/css/atom-one-dark-reasonable.css?1768702295" rel="stylesheet">
    <link href="http://localhost:1313/css/theme.css?1768702295" rel="stylesheet">
    <link href="http://localhost:1313/css/hugo-theme.css?1768702295" rel="stylesheet">
    
    <link href="http://localhost:1313/css/theme-workshop.css?1768702295" rel="stylesheet">
    
    

    <script src="http://localhost:1313/js/jquery-3.3.1.min.js?1768702295"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="http://localhost:1313/vi/7-networking/7.2-service-connect/7.2.1-enable_service_connect/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://localhost:1313/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="http://localhost:1313/js/lunr.min.js?1768702295"></script>
<script type="text/javascript" src="http://localhost:1313/js/auto-complete.js?1768702295"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/localhost:1313\/\/vi";
    
</script>
<script type="text/javascript" src="http://localhost:1313/js/search.js?1768702295"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduction/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/1-introduction/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-fundamentals/" title="Các khái niệm cơ bản" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/2-fundamentals/">
           <b> 2. </b> Các khái niệm cơ bản
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-fundamentals/2.1-ecs_cluster/" title="Amazon ECS Cluster" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/2-fundamentals/2.1-ecs_cluster/">
           <b> 2.1. </b> Amazon ECS Cluster
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-fundamentals/2.2-ecs_service/" title="Amazon ECS Service" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/2-fundamentals/2.2-ecs_service/">
           <b> 2.2. </b> Amazon ECS Service
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-fundamentals/2.3-ecs_task/" title="Amazon ECS Task" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/2-fundamentals/2.3-ecs_task/">
           <b> 2.3. </b> Amazon ECS Task
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-fundamentals/2.4-ecs_task_definition/" title="Amazon ECS Task Definition" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/2-fundamentals/2.4-ecs_task_definition/">
           <b> 2.4. </b> Amazon ECS Task Definition
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-prepare/" title="Chuẩn bị" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/3-prepare/">
           <b> 3. </b> Chuẩn bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-prepare/3.1-user_accesskey/" title="Tạo User &amp; Access Key" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/3-prepare/3.1-user_accesskey/">
           <b> 3.1. </b> Tạo User &amp; Access Key
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-prepare/3.2-cluster-task_definitions/" title="Tạo Cluster &amp; Task Definition" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/3-prepare/3.2-cluster-task_definitions/">
           <b> 3.2. </b> Tạo Cluster &amp; Task Definition
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-prepare/3.3-services/" title="Services" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/3-prepare/3.3-services/">
           <b> 3.3. </b> Services
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-prepare/3.4-updated_services/" title="Cập nhật Services" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/3-prepare/3.4-updated_services/">
           <b> 3.4. </b> Cập nhật Services
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-prepare/3.5-enable_ecs_exec/" title="Enable ECS Exec" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/3-prepare/3.5-enable_ecs_exec/">
           <b> 3.5. </b> Enable ECS Exec
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-express-mode/" title="Express Mode" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/4-express-mode/">
           <b> 4. </b> Express Mode
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/4-express-mode/4.1-setup_deploy/" title="Express Mode Setup &amp; Deployment" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/4-express-mode/4.1-setup_deploy/">
           <b> 4.1. </b> Express Mode Setup &amp; Deployment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-express-mode/4.2-update/" title="Express Mode Update" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/4-express-mode/4.2-update/">
           <b> 4.2. </b> Express Mode Update
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-managed-instances/" title="ECS Managed Instances" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/5-managed-instances/">
           <b> 5. </b> ECS Managed Instances
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/5-managed-instances/5.1-enable/" title="Enable ECS Managed Instances" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/5-managed-instances/5.1-enable/">
           <b> 5.1. </b> Enable ECS Managed Instances
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-managed-instances/5.2-deploy/" title="Triển khai với Managed Instances" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/5-managed-instances/5.2-deploy/">
           <b> 5.2. </b> Triển khai với Managed Instances
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-managed-instances/5.3-managed/" title="Managed Instances Infrastructure" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/5-managed-instances/5.3-managed/">
           <b> 5.3. </b> Managed Instances Infrastructure
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-auto-scaling/" title="Auto Scaling" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/6-auto-scaling/">
           <b> 6. </b> Auto Scaling
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/6-auto-scaling/6.1-sas/" title="Service Auto Scaling" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/6-auto-scaling/6.1-sas/">
           <b> 6.1. </b> Service Auto Scaling
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/6-auto-scaling/6.2-target_tracking_scaling/" title="Target Tracking Scaling" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/6-auto-scaling/6.2-target_tracking_scaling/">
           <b> 6.2. </b> Target Tracking Scaling
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/6-auto-scaling/6.3-scheduled_scaling/" title="Scheduled Scaling" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/6-auto-scaling/6.3-scheduled_scaling/">
           <b> 6.3. </b> Scheduled Scaling
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/7-networking/" title="Networking" class="dd-item 
        parent
        
        
        ">
      <a href="http://localhost:1313/vi/7-networking/">
           <b> 7. </b> Networking
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/7-networking/7.1-network_mode/" title="Amazon ECS Network Mode" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/7-networking/7.1-network_mode/">
           <b> 7.1. </b> Amazon ECS Network Mode
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/7-networking/7.2-service-connect/" title="ECS Service Connect" class="dd-item 
        parent
        
        
        ">
      <a href="http://localhost:1313/vi/7-networking/7.2-service-connect/">
           <b> 7.2. </b> ECS Service Connect
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/7-networking/7.2-service-connect/7.2.1-enable_service_connect/" title="Enable Service Connect" class="dd-item 
        
        active
        
        ">
      <a href="http://localhost:1313/vi/7-networking/7.2-service-connect/7.2.1-enable_service_connect/">
           <b> 7.2.1. </b> Enable Service Connect
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/8-observability/" title="Observability" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/8-observability/">
           <b> 8. </b> Observability
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/9-security/" title="Security" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/9-security/">
           <b> 9. </b> Security
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/10-deployments/" title="Deployments" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/10-deployments/">
           <b> 10. </b> Deployments
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/11-storage/" title="Storage" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/11-storage/">
           <b> 11. </b> Storage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/12-cost-optimizations/" title="Cost Optimizations" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/12-cost-optimizations/">
           <b> 12. </b> Cost Optimizations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/13-clean-up/" title="Clean Up" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/vi/13-clean-up/">
           <b> 13. </b> Clean Up
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://localhost:1313/7-networking/7.2-service-connect/7.2.1-enable_service_connect/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://localhost:1313/vi/7-networking/7.2-service-connect/7.2.1-enable_service_connect/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    <b>Authors</b> <br>
    <ul>
        <li><a href="http://linkedin.com/in/tranvix0910" style="color:orange;">Trần Vĩ</a></li>
    </ul>
</left>

<left>
    
    <b>Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7836256&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" alt="web counter" border="0" /> <br>
    <b><a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total Cloud Journey" alt="web counter" border="0" />
</left>

<left>
    <br>
    <br>
    <b>Last Updated</b> <br>
    <i><font color=orange>20-01-2025</font></i>
</left>

<left>
    <br>
    <br>
    <b>Team</b> <br>
    <i><a href="https://www.linkedin.com/in/jotaguy" style="color:orange">Gia Hưng</a></i>
</left>


<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='http://localhost:1313/vi/'>Workshop Amazon Elastic Container Service & AWS Fargate</a> > <a href='http://localhost:1313/vi/7-networking/'>Networking</a> > <a href='http://localhost:1313/vi/7-networking/7.2-service-connect/'>ECS Service Connect</a> > Enable Service Connect
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Enable Service Connect
            </h1>
          

        



	<p>Trong phần này, chúng ta sẽ kích hoạt ECS Service Connect trong cluster bằng cách triển khai ba microservices bổ sung mà UI service sẽ giao tiếp cùng:</p>
<p><img alt="AWS ECS Service Connect Architecture" src="http://localhost:1313/images/7-networking/7.2-service-connect/7.2.1-enable_service_connect/1.png"></p>
<h4 id="tạo-security-group-cho-các-service">Tạo Security Group Cho Các Service</h4>
<p>Tạo Security Group cho các service như sau:</p>
<ul>
<li>
<p>VPC ID được lấy từ VPC mà chúng ta đã tạo trong phần trước.</p>
</li>
<li>
<p><strong>Orders Service</strong>: <code>orders-sg</code></p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ec2 create-security-group <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --group-name orders-sg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --description <span style="color:#e6db74">&#34;Orders ECS Service SG&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --vpc-id <span style="color:#e6db74">${</span>VPC_ID<span style="color:#e6db74">}</span>
</span></span></code></pre></div><ul>
<li><strong>Checkout Service</strong>: <code>checkout-sg</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ec2 create-security-group <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --group-name checkout-sg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --description <span style="color:#e6db74">&#34;Checkout ECS Service SG&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --vpc-id <span style="color:#e6db74">${</span>VPC_ID<span style="color:#e6db74">}</span>
</span></span></code></pre></div><ul>
<li><strong>Catalog Service</strong>: <code>catalog-sg</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ec2 create-security-group <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --group-name catalog-sg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --description <span style="color:#e6db74">&#34;Catalog ECS Service SG&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --vpc-id <span style="color:#e6db74">${</span>VPC_ID<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p><img alt="Security Group Created" src="http://localhost:1313/images/7-networking/7.2-service-connect/7.2.1-enable_service_connect/2.png"></p>
<p>Lấy các ID trên và cấu hình Inbound rules cho các Security Group như sau:</p>
<ul>
<li>Orders Service nhận traffic từ UI Service và Checkout Service.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ec2 authorize-security-group-ingress <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --group-id <span style="color:#e6db74">${</span>ORDERS_SG_ID<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --protocol tcp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --port <span style="color:#ae81ff">8080</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --source-group <span style="color:#e6db74">${</span>UI_SG_ID<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws ec2 authorize-security-group-ingress <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --group-id <span style="color:#e6db74">${</span>ORDERS_SG_ID<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --protocol tcp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --port <span style="color:#ae81ff">8080</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --source-group <span style="color:#e6db74">${</span>CHECKOUT_SG_ID<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p><img alt="Orders Service Inbound Rules" src="http://localhost:1313/images/7-networking/7.2-service-connect/7.2.1-enable_service_connect/3.png"></p>
<ul>
<li>Checkout Service nhận traffic từ UI Service.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ec2 authorize-security-group-ingress <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --group-id <span style="color:#e6db74">${</span>CHECKOUT_SG_ID<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --protocol tcp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --port <span style="color:#ae81ff">8080</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --source-group <span style="color:#e6db74">${</span>UI_SG_ID<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p><img alt="Checkout Service Inbound Rules" src="http://localhost:1313/images/7-networking/7.2-service-connect/7.2.1-enable_service_connect/4.png"></p>
<ul>
<li>Catalog Service nhận traffic từ UI Service.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ec2 authorize-security-group-ingress <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --group-id <span style="color:#e6db74">${</span>CATALOG_SG_ID<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --protocol tcp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --port <span style="color:#ae81ff">8080</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --source-group <span style="color:#e6db74">${</span>UI_SG_ID<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p><img alt="Catalog Service Inbound Rules" src="http://localhost:1313/images/7-networking/7.2-service-connect/7.2.1-enable_service_connect/5.png"></p>
<h4 id="deploy-orders-service">Deploy Orders Service</h4>
<p>Tạo ECS task definition cho Orders service. Chúng ta sẽ làm tương tự với UI Service bằng cách sử dụng file json <code>retail-store-ecs-order-taskdef.json</code> với nội dung như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;family&#34;</span>: <span style="color:#e6db74">&#34;retail-store-ecs-orders&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;executionRoleArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::${ACCOUNT_ID}:role/ordersEcsTaskExecutionRole&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;taskRoleArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskRole&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;networkMode&#34;</span>: <span style="color:#e6db74">&#34;awsvpc&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;requiresCompatibilities&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;FARGATE&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cpu&#34;</span>: <span style="color:#e6db74">&#34;1024&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;memory&#34;</span>: <span style="color:#e6db74">&#34;2048&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;runtimePlatform&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cpuArchitecture&#34;</span>: <span style="color:#e6db74">&#34;X86_64&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;operatingSystemFamily&#34;</span>: <span style="color:#e6db74">&#34;LINUX&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;containerDefinitions&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;application&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;public.ecr.aws/aws-containers/retail-store-sample-orders:1.2.3&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;cpu&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;portMappings&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;application&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;containerPort&#34;</span>: <span style="color:#ae81ff">8080</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;hostPort&#34;</span>: <span style="color:#ae81ff">8080</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;protocol&#34;</span>: <span style="color:#e6db74">&#34;tcp&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;appProtocol&#34;</span>: <span style="color:#e6db74">&#34;http&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;essential&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;linuxParameters&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;initProcessEnabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;healthCheck&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;command&#34;</span>: [
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;CMD-SHELL&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;curl -f http://localhost:8080/actuator/health || exit 1&#34;</span>
</span></span><span style="display:flex;"><span>                ],
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;retries&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;startPeriod&#34;</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;environment&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_ORDERS_PERSISTENCE_PROVIDER&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;postgres&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_ORDERS_MESSAGING_PROVIDER&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;in-memory&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;secrets&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_ORDERS_PERSISTENCE_ENDPOINT&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;valueFrom&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:ssm:${AWS_REGION}:${ACCOUNT_ID}:parameter/retail-store-ecs/orders/db-endpoint-postgres&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_ORDERS_PERSISTENCE_NAME&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;valueFrom&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-orders-db:dbname::&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_ORDERS_PERSISTENCE_USERNAME&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;valueFrom&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-orders-db:username::&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_ORDERS_PERSISTENCE_PASSWORD&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;valueFrom&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-orders-db:password::&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;logConfiguration&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;logDriver&#34;</span>: <span style="color:#e6db74">&#34;awslogs&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;awslogs-group&#34;</span>: <span style="color:#e6db74">&#34;retail-store-ecs-tasks&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;awslogs-region&#34;</span>: <span style="color:#e6db74">&#34;$AWS_REGION&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;awslogs-stream-prefix&#34;</span>: <span style="color:#e6db74">&#34;orders-service&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Đăng ký task definition:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecs register-task-definition <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cli-input-json file://retail-store-ecs-order-taskdef.json
</span></span></code></pre></div><p><img alt="Order Task Definition" src="http://localhost:1313/images/7-networking/7.2-service-connect/7.2.1-enable_service_connect/6.png"></p>
<p>Dùng lệnh sau để tạo Orders service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecs create-service <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cluster retail-store-ecs-cluster <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --service-name orders <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --task-definition retail-store-ecs-orders <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --desired-count <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --launch-type FARGATE <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --enable-execute-command <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --network-configuration <span style="color:#e6db74">&#34;awsvpcConfiguration={subnets=[subnet-0b742ee8bbf495219, subnet-0317d1d968b9963d0], securityGroups=[sg-069f1465934b99e2a],assignPublicIp=DISABLED}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --service-connect-configuration <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;enabled&#34;: true,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;namespace&#34;: &#34;retailstore.local&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;services&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;portName&#34;: &#34;application&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;discoveryName&#34;: &#34;orders&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;clientAliases&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#34;port&#34;: 80,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#34;dnsName&#34;: &#34;orders&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }&#39;</span>
</span></span></code></pre></div><p>Lưu ý: khi tạo service, ta chỉ định <code>--service-connect-configuration</code>, thao tác này sẽ:</p>
<ul>
<li>
<p>Kích hoạt Service Connect.</p>
</li>
<li>
<p>Chỉ định namespace dùng chung cho tất cả services.</p>
</li>
<li>
<p>Cấu hình Service Connect services được cung cấp bởi ECS service này, bao gồm alias và port.</p>
</li>
</ul>
<p><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/networking-connecting-services.html#networking-connecting-services-serviceconnect">Tham khảo thêm trong AWS Documentation</a>.</p>
<h4 id="deploy-checkout-service">Deploy Checkout Service</h4>
<p>Tạo ECS task definition cho Checkout service. Tương tự như trên chúng ta sẽ tạo task definition với file json <code>retail-store-ecs-checkout-taskdef.json</code> với nội dung như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;family&#34;</span>: <span style="color:#e6db74">&#34;retail-store-ecs-checkout&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;executionRoleArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::${ACCOUNT_ID}:role/checkoutEcsTaskExecutionRole&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;taskRoleArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskRole&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;networkMode&#34;</span>: <span style="color:#e6db74">&#34;awsvpc&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;requiresCompatibilities&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;FARGATE&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cpu&#34;</span>: <span style="color:#e6db74">&#34;1024&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;memory&#34;</span>: <span style="color:#e6db74">&#34;2048&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;runtimePlatform&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cpuArchitecture&#34;</span>: <span style="color:#e6db74">&#34;X86_64&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;operatingSystemFamily&#34;</span>: <span style="color:#e6db74">&#34;LINUX&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;containerDefinitions&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;application&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;public.ecr.aws/aws-containers/retail-store-sample-checkout:1.2.3&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;portMappings&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;application&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;containerPort&#34;</span>: <span style="color:#ae81ff">8080</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;hostPort&#34;</span>: <span style="color:#ae81ff">8080</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;protocol&#34;</span>: <span style="color:#e6db74">&#34;tcp&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;appProtocol&#34;</span>: <span style="color:#e6db74">&#34;http&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;essential&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;linuxParameters&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;initProcessEnabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;environment&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_CHECKOUT_PERSISTENCE_PROVIDER&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;redis&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                 {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_CHECKOUT_ENDPOINTS_ORDERS&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;http://orders&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;secrets&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_CHECKOUT_PERSISTENCE_REDIS_URL&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;valueFrom&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:ssm:${AWS_REGION}:${ACCOUNT_ID}:parameter/retail-store-ecs/checkout/redis-endpoint&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;healthCheck&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;command&#34;</span>: [
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;CMD-SHELL&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;curl -f http://localhost:8080/health || exit 1&#34;</span>
</span></span><span style="display:flex;"><span>                ],
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;retries&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;startPeriod&#34;</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;logConfiguration&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;logDriver&#34;</span>: <span style="color:#e6db74">&#34;awslogs&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;awslogs-group&#34;</span>: <span style="color:#e6db74">&#34;retail-store-ecs-tasks&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;awslogs-region&#34;</span>: <span style="color:#e6db74">&#34;$AWS_REGION&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;awslogs-stream-prefix&#34;</span>: <span style="color:#e6db74">&#34;checkout-service&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Đăng ký task definition:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecs register-task-definition <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cli-input-json file://retail-store-ecs-checkout-taskdef.json
</span></span></code></pre></div><p>Dùng lệnh sau để tạo Checkout Service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecs create-service <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cluster retail-store-ecs-cluster <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --service-name checkout <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --task-definition retail-store-ecs-checkout <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --desired-count <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --launch-type FARGATE <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --enable-execute-command <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --network-configuration <span style="color:#e6db74">&#34;awsvpcConfiguration={subnets=[subnet-0b742ee8bbf495219, subnet-0317d1d968b9963d0], securityGroups=[sg-037956d78913fda63],assignPublicIp=DISABLED}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --service-connect-configuration <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;enabled&#34;: true,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;namespace&#34;: &#34;retailstore.local&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;services&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;portName&#34;: &#34;application&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;discoveryName&#34;: &#34;checkout&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;clientAliases&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#34;port&#34;: 80,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#34;dnsName&#34;: &#34;checkout&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }&#39;</span>
</span></span></code></pre></div><h4 id="deploy-catalog-service">Deploy Catalog Service</h4>
<p>Tạo Task Definition cho Catalog Service. Tạo task definition với file json <code>retail-store-ecs-catalog-taskdef.json</code> với nội dung như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;family&#34;</span>: <span style="color:#e6db74">&#34;retail-store-ecs-catalog&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;executionRoleArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::${ACCOUNT_ID}:role/catalogEcsTaskExecutionRole&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;taskRoleArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::${ACCOUNT_ID}:role/retailStoreEcsTaskRole&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;networkMode&#34;</span>: <span style="color:#e6db74">&#34;awsvpc&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;requiresCompatibilities&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;FARGATE&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;cpu&#34;</span>: <span style="color:#e6db74">&#34;1024&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;memory&#34;</span>: <span style="color:#e6db74">&#34;2048&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;runtimePlatform&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cpuArchitecture&#34;</span>: <span style="color:#e6db74">&#34;X86_64&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;operatingSystemFamily&#34;</span>: <span style="color:#e6db74">&#34;LINUX&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;containerDefinitions&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;application&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;public.ecr.aws/aws-containers/retail-store-sample-catalog:1.2.3&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;portMappings&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;application&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;containerPort&#34;</span>: <span style="color:#ae81ff">8080</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;hostPort&#34;</span>: <span style="color:#ae81ff">8080</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;protocol&#34;</span>: <span style="color:#e6db74">&#34;tcp&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;appProtocol&#34;</span>: <span style="color:#e6db74">&#34;http&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;essential&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;linuxParameters&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;initProcessEnabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;environment&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_CATALOG_PERSISTENCE_DB_NAME&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;catalog&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_CATALOG_PERSISTENCE_PROVIDER&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;mysql&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;secrets&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_CATALOG_PERSISTENCE_ENDPOINT&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;valueFrom&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:ssm:${AWS_REGION}:${ACCOUNT_ID}:parameter/retail-store-ecs/catalog/db-endpoint-mysql&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_CATALOG_PERSISTENCE_PASSWORD&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;valueFrom&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-catalog-db:password::&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_CATALOG_PERSISTENCE_USER&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;valueFrom&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:secretsmanager:${AWS_REGION}:${ACCOUNT_ID}:secret:retail-store-ecs-catalog-db:username::&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;logConfiguration&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;logDriver&#34;</span>: <span style="color:#e6db74">&#34;awslogs&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;options&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;awslogs-group&#34;</span>: <span style="color:#e6db74">&#34;retail-store-ecs-tasks&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;awslogs-region&#34;</span>: <span style="color:#e6db74">&#34;${AWS_REGION}&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;awslogs-stream-prefix&#34;</span>: <span style="color:#e6db74">&#34;catalog-service&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;healthCheck&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;command&#34;</span>: [
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;CMD-SHELL&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;curl -f http://localhost:8080/health || exit 1&#34;</span>
</span></span><span style="display:flex;"><span>                ],
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;retries&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;startPeriod&#34;</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Đăng ký task definition:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecs register-task-definition <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cli-input-json file://retail-store-ecs-catalog-taskdef.json
</span></span></code></pre></div><p>Dùng lệnh sau để tạo Catalog Service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecs create-service <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cluster retail-store-ecs-cluster <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --service-name catalog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --task-definition retail-store-ecs-catalog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --desired-count <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --launch-type FARGATE <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --enable-execute-command <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --network-configuration <span style="color:#e6db74">&#34;awsvpcConfiguration={subnets=[</span><span style="color:#e6db74">${</span>PRIVATE_SUBNET1<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">${</span>PRIVATE_SUBNET2<span style="color:#e6db74">}</span><span style="color:#e6db74">], securityGroups=[</span>$CATALOG_SG_ID<span style="color:#e6db74">],assignPublicIp=DISABLED}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --service-connect-configuration <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;enabled&#34;: true,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;namespace&#34;: &#34;retailstore.local&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;services&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;portName&#34;: &#34;application&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;discoveryName&#34;: &#34;catalog&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;clientAliases&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#34;port&#34;: 80,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#34;dnsName&#34;: &#34;catalog&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }&#39;</span>
</span></span></code></pre></div><p>Chờ các Service được tạo xong, tiếp theo, cập nhật cấu hình UI Service để nó có thể tương tác với các microservices vừa triển khai. Các environment variables sau cần được thêm vào UI Task Definition:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;environment&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_UI_ENDPOINTS_ORDERS&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;http://orders&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_UI_ENDPOINTS_CHECKOUT&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;http://checkout&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RETAIL_UI_ENDPOINTS_CATALOG&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;http://catalog&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>Chạy script sau để in ra UI Task Definition:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat retail-store-ecs-ui-connect-taskdef.json | jq
</span></span></code></pre></div><p>Đăng ký Task Definition mới cho UI:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecs register-task-definition --cli-input-json file://retail-store-ecs-ui-connect-taskdef.json
</span></span></code></pre></div><p>Cập nhật UI Service với Task Definition mới và Service Connect configuration. Đồng thời bật Service Connect access logs để thu thập telemetry chi tiết cho từng request.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecs update-service <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --cluster retail-store-ecs-cluster <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --service ui <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --task-definition retail-store-ecs-ui <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --force-new-deployment <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --desired-count <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --service-connect-configuration <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;enabled&#34;: true,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;namespace&#34;: &#34;retailstore.local&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;logConfiguration&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;logDriver&#34;: &#34;awslogs&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;options&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;awslogs-group&#34;: &#34;&#39;</span>$SERVICE_CONNECT_LOG_GROUP_NAME<span style="color:#e6db74">&#39;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;awslogs-region&#34;: &#34;&#39;</span>$AWS_REGION<span style="color:#e6db74">&#39;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;awslogs-stream-prefix&#34;: &#34;ui-service-connect-logs&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;accessLogConfiguration&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;format&#34;: &#34;JSON&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;includeQueryParameters&#34;: &#34;ENABLED&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;services&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;portName&#34;: &#34;application&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;discoveryName&#34;: &#34;ui&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;clientAliases&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#34;port&#34;: 80,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#34;dnsName&#34;: &#34;ui&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }&#39;</span>
</span></span></code></pre></div>




<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="http://localhost:1313/vi/7-networking/7.2-service-connect/" title="ECS Service Connect"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="http://localhost:1313/vi/8-observability/" title="Observability" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="http://localhost:1313/js/clipboard.min.js?1768702295"></script>
    <script src="http://localhost:1313/js/perfect-scrollbar.min.js?1768702295"></script>
    <script src="http://localhost:1313/js/perfect-scrollbar.jquery.min.js?1768702295"></script>
    <script src="http://localhost:1313/js/jquery.sticky.js?1768702295"></script>
    <script src="http://localhost:1313/js/featherlight.min.js?1768702295"></script>
    <script src="http://localhost:1313/js/highlight.pack.js?1768702295"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="http://localhost:1313/js/modernizr.custom-3.6.0.js?1768702295"></script>
    <script src="http://localhost:1313/js/learn.js?1768702295"></script>
    <script src="http://localhost:1313/js/hugo-learn.js?1768702295"></script>

    <link href="http://localhost:1313/mermaid/mermaid.css?1768702295" rel="stylesheet" />
    <script src="http://localhost:1313/mermaid/mermaid.js?1768702295"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
